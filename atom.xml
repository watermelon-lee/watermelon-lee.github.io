<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Watermelon</title>
  
  <subtitle>远远和元老大的小窝</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://watermelon-lee.github.io/"/>
  <updated>2018-06-11T12:36:00.351Z</updated>
  <id>https://watermelon-lee.github.io/</id>
  
  <author>
    <name>watermelon-lee</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>代理模式</title>
    <link href="https://watermelon-lee.github.io/2018/06/11/DesignPattern3/"/>
    <id>https://watermelon-lee.github.io/2018/06/11/DesignPattern3/</id>
    <published>2018-06-11T11:51:19.000Z</published>
    <updated>2018-06-11T12:36:00.351Z</updated>
    
    <content type="html"><![CDATA[<h1 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h1><p><em>代理模式(Proxy)为其他对象提供了一种代理以控制对这个对象的访问.</em><br><a id="more"></a></p><h2 id="代理模式结构"><a href="#代理模式结构" class="headerlink" title="代理模式结构"></a>代理模式结构</h2><p>在一些情况下,客户不可以直接引用到一个对象,而代理对象就可以在客户端和目标之间起到一个中介的作用.<br><img src="../../../../img/Design/proxy.png" alt="代理模式"><br>以打官司为例子.我们需要一个代理,就是律师来表达我们的想法.<br>首先创建一个公共接口:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package Proxy;</span><br><span class="line"></span><br><span class="line">public interface Subject &#123;</span><br><span class="line">    void express();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后是代理类律师:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package Proxy;</span><br><span class="line"></span><br><span class="line">public class Lawyer implements Subject &#123;</span><br><span class="line">    Person person;</span><br><span class="line"></span><br><span class="line">    public Lawyer() &#123;</span><br><span class="line">        this.person = new Person();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void express() &#123;</span><br><span class="line">        System.out.println(&quot;我的受理人情况如下:&quot;);</span><br><span class="line">        person.express();</span><br><span class="line">        System.out.println(&quot;发言完毕&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后是受理人:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package Proxy;</span><br><span class="line"></span><br><span class="line">public class Person implements Subject &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void express() &#123;</span><br><span class="line">        System.out.println(&quot;当时不在场,没有犯罪&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>测试类Court:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package Proxy;</span><br><span class="line"></span><br><span class="line">public class Court &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        Lawyer lawyer=new Lawyer();</span><br><span class="line">        lawyer.express();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以发现,在法庭上并没有访问到受理人,有代理类律师为他发言.代理类就是真实对象的代表.  </p><p>代理模式的应用场景：<br>如果已有的方法在使用的时候需要对原有的方法进行改进，此时有两种办法：  </p><p>1、修改原有的方法来适应。这样违反了“对扩展开放，对修改关闭”的原则。</p><p>2、就是采用一个代理类调用原有的方法，且对产生的结果进行控制。这种方法就是代理模式。</p><p>使用代理模式，可以将功能划分的更加清晰，有助于后期维护.</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;代理模式&quot;&gt;&lt;a href=&quot;#代理模式&quot; class=&quot;headerlink&quot; title=&quot;代理模式&quot;&gt;&lt;/a&gt;代理模式&lt;/h1&gt;&lt;p&gt;&lt;em&gt;代理模式(Proxy)为其他对象提供了一种代理以控制对这个对象的访问.&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="DesignPattern" scheme="https://watermelon-lee.github.io/tags/DesignPattern/"/>
    
  </entry>
  
  <entry>
    <title>策略模式</title>
    <link href="https://watermelon-lee.github.io/2018/06/10/DesignPattern2/"/>
    <id>https://watermelon-lee.github.io/2018/06/10/DesignPattern2/</id>
    <published>2018-06-10T02:14:41.000Z</published>
    <updated>2018-06-10T03:49:40.134Z</updated>
    
    <content type="html"><![CDATA[<h1 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h1><p>它定义了算法家族,分别封装起来,让他们之间可以相互替换,此模式让算法的变化,不会影响到使用算法的客户.<br><a id="more"></a><br><img src="../../../../img/Design/strategy.png" alt="策略模式"><br>这个模式涉及到三个角色：</p><p>　　●　　环境(Context)角色：持有一个Strategy的引用。</p><p>　　●　　抽象策略(Strategy)角色：这是一个抽象角色，通常由一个接口或抽象类实现。此角色给出所有的具体策略类所需的接口。</p><p>　　●　　具体策略(ConcreteStrategy)角色：包装了相关的算法或行为。<br>以商场购物为例子,有三种收费方式,一种是正常原价,一种是打8折,一种是每满300-100.</p><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><p>策略接口:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">public interface Strategy &#123;</span><br><span class="line">    double acceptCash(double money);//收取现金,参数为原价,返回为折后价</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>子类:<br>8折:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">public class DiscountStrategy implements Strategy&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public double acceptCash(double money) &#123;</span><br><span class="line">        return money*0.8;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>满减:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">public class MinusStrategy implements Strategy &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public double acceptCash(double money) &#123;</span><br><span class="line">        return money-((int)money/300)*100;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>原价:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">public class NormalStrategy implements Strategy&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public double acceptCash(double money) &#123;</span><br><span class="line">        return money;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Context:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">public class Context &#123;</span><br><span class="line">    private Strategy strategy;</span><br><span class="line"></span><br><span class="line">    public Context(Strategy strategy) &#123;</span><br><span class="line">        this.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getResult(double money)&#123;</span><br><span class="line">        return strategy.acceptCash(money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>编写客户端:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;请输入需要的折扣方式:8折,满300-100或原价&quot;);</span><br><span class="line">        Scanner scanner=new Scanner(System.in);</span><br><span class="line">        String strategy=scanner.nextLine();</span><br><span class="line">        Context context=null;</span><br><span class="line">        switch (strategy)&#123;</span><br><span class="line">            case &quot;8折&quot;:</span><br><span class="line">                context=new Context(new DiscountStrategy());</span><br><span class="line">                break;</span><br><span class="line">            case &quot;满300-100&quot;:</span><br><span class="line">                context=new Context(new MinusStrategy());</span><br><span class="line">                break;</span><br><span class="line">            case &quot;原价&quot;:</span><br><span class="line">                context=new Context(new NormalStrategy());</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;请输入金额&quot;);</span><br><span class="line">        double price=scanner.nextDouble();</span><br><span class="line">        scanner.nextLine();</span><br><span class="line">        double result=context.getResult(price);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>输入:8折<br>    100<br>输出:80.0  </p><p>但是这样子客户端十分庞大冗杂,在客户端进行判断,以后每次改变折扣还需要对客户端进行修改,所以我们使用使用策略与简单工厂结合.改进Context类.<br>CashContext:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">public class CashContext &#123;</span><br><span class="line">    private Strategy concreteStrategy;</span><br><span class="line"></span><br><span class="line">    public CashContext(String strategy)&#123;</span><br><span class="line">        switch (strategy)&#123;</span><br><span class="line">            case &quot;8折&quot;:</span><br><span class="line">                concreteStrategy=new DiscountStrategy();</span><br><span class="line">                break;</span><br><span class="line">            case &quot;满300-100&quot;:</span><br><span class="line">                concreteStrategy=new MinusStrategy();</span><br><span class="line">                break;</span><br><span class="line">            case &quot;原价&quot;:</span><br><span class="line">                concreteStrategy=new NormalStrategy();</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public double getResult(double money)&#123;</span><br><span class="line">        return concreteStrategy.acceptCash(money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>NewClient:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package Strategy;</span><br><span class="line"></span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class NewClient &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;请输入需要的折扣方式:8折,满300-100或原价&quot;);</span><br><span class="line">        Scanner scanner=new Scanner(System.in);</span><br><span class="line">        String strategy=scanner.nextLine();</span><br><span class="line">        CashContext cashContext=new CashContext(strategy);</span><br><span class="line">        System.out.println(&quot;请输入金额&quot;);</span><br><span class="line">        double price=scanner.nextDouble();</span><br><span class="line">        scanner.nextLine();</span><br><span class="line">        double result=cashContext.getResult(price);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>使用两者结合之后,客户端只需调用一个CashContext类即可,相比之前需要调用多个类,是客户端与收费算法彻底分离,降低了耦合.</p><h1 id="认识策略模式"><a href="#认识策略模式" class="headerlink" title="认识策略模式:"></a>认识策略模式:</h1><ul><li>策略模式的重心不是如何实现算法，而是如何组织、调用这些算法，从而让程序结构更灵活，具有更好的维护性和扩展性。</li><li>策略模式一个很大的特点就是各个策略算法的平等性。对于一系列具体的策略算法，大家的地位是完全一样的，正因为这个平等性，才能实现算法之间可以相互替换。所有的策略算法在实现上也是相互独立的，相互之间是没有依赖的。所以可以这样描述这一系列策略算法：策略算法是相同行为的不同实现</li><li>运行期间，策略模式在每一个时刻只能使用一个具体的策略实现对象，虽然可以动态地在不同的策略实现中切换，但是同时只能使用一个。</li><li>经常见到的是，所有的具体策略类都有一些公有的行为。这时候，就应当把这些公有的行为放到共同的抽象策略角色Strategy类里面。当然这时候抽象策略角色必须要用Java抽象类实现，而不能使用接口。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;策略模式&quot;&gt;&lt;a href=&quot;#策略模式&quot; class=&quot;headerlink&quot; title=&quot;策略模式&quot;&gt;&lt;/a&gt;策略模式&lt;/h1&gt;&lt;p&gt;它定义了算法家族,分别封装起来,让他们之间可以相互替换,此模式让算法的变化,不会影响到使用算法的客户.&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="DesignPattern" scheme="https://watermelon-lee.github.io/tags/DesignPattern/"/>
    
  </entry>
  
  <entry>
    <title>设计模式</title>
    <link href="https://watermelon-lee.github.io/2018/06/09/DesignPattern/"/>
    <id>https://watermelon-lee.github.io/2018/06/09/DesignPattern/</id>
    <published>2018-06-09T13:16:36.000Z</published>
    <updated>2018-06-10T02:18:44.189Z</updated>
    
    <content type="html"><![CDATA[<p>最近学习了体系结构这门课程,主要学习了一些设计模式.期末考试快到了,做一个学习总结.<br>所写的部分参照了&lt;大话设计模式&gt;,&lt;Java与模式&gt;与<a href="https://blog.csdn.net/zhangerqing/article/details/8194653" target="_blank" rel="noopener">博客Java之美之设计模式</a><br><a id="more"></a></p><h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><p>设计模式（Design pattern）是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结.重要的不是将来需不需要用到这些模式,而是通过这些模式找到”封装变化”,”对象间松散耦合”,”针对接口编程”的感觉,设计出易维护,易扩展,易复用,灵活性好的程序.  </p><h2 id="设计模式分类"><a href="#设计模式分类" class="headerlink" title="设计模式分类"></a>设计模式分类</h2><p>总体来说设计模式分为三大类：  </p><p>创建型模式，共五种：工厂方法模式、抽象工厂模式、单例模式、建造者模式、原型模式。  </p><p>结构型模式，共七种：适配器模式、装饰器模式、代理模式、外观模式、桥接模式、组合模式、享元模式。  </p><p>行为型模式，共十一种：策略模式、模板方法模式、观察者模式、迭代子模式、责任链模式、命令模式、备忘录模式、状态模式、访问者模式、中介者模式、解释器模式。  </p><p>其实还有两类：并发型模式和线程池模式。  </p><h2 id="6大设计原则"><a href="#6大设计原则" class="headerlink" title="6大设计原则"></a>6大设计原则</h2><p>1、开闭原则（Open Close Principle）<br>开闭原则就是说对扩展开放，对修改关闭。在程序需要进行拓展的时候，不能去修改原有的代码，实现一个热插拔的效果。所以一句话概括就是：为了使程序的扩展性好，易于维护和升级。想要达到这样的效果，我们需要使用接口和抽象类.<br>2、里氏代换原则（Liskov Substitution Principle）<br>里氏代换原则(Liskov Substitution Principle LSP)面向对象设计的基本原则之一。 里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。 LSP是继承复用的基石，只有当衍生类可以替换掉基类，软件单位的功能不受到影响时，基类才能真正被复用，而衍生类也能够在基类的基础上增加新的行为。里氏代换原则是对“开-闭”原则的补充。实现“开-闭”原则的关键步骤就是抽象化。而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范.<br>3、依赖倒转原则（Dependence Inversion Principle）<br>这个是开闭原则的基础，具体内容：真对接口编程，依赖于抽象而不依赖于具体。<br>4、接口隔离原则（Interface Segregation Principle）<br>使用多个隔离的接口，比使用单个接口要好。还是一个降低类之间的耦合度的意思，从这儿我们看出，其实设计模式就是一个软件的设计思想，从大型软件架构出发，为了升级和维护方便。所以上文中多次出现：降低依赖，降低耦合。<br>5、迪米特法则（最少知道原则）（Demeter Principle）<br>为什么叫最少知道原则，就是说：一个实体应当尽量少的与其他实体之间发生相互作用，使得系统功能模块相对独立。<br>6、合成复用原则（Composite Reuse Principle）<br>原则是尽量使用合成/聚合的方式，而不是使用继承。<br>聚合表示一种弱拥有关系,体现A可以包含对象B,B对象不是A对象的一部分.<br>合成是一种强拥有关系,体现了严格的整体与部分关系,部分和整体的生命周期一样.  </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近学习了体系结构这门课程,主要学习了一些设计模式.期末考试快到了,做一个学习总结.&lt;br&gt;所写的部分参照了&amp;lt;大话设计模式&amp;gt;,&amp;lt;Java与模式&amp;gt;与&lt;a href=&quot;https://blog.csdn.net/zhangerqing/article/details/8194653&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;博客Java之美之设计模式&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="DesignPattern" scheme="https://watermelon-lee.github.io/tags/DesignPattern/"/>
    
  </entry>
  
  <entry>
    <title>简单工厂模式</title>
    <link href="https://watermelon-lee.github.io/2018/06/09/DesignPattern1/"/>
    <id>https://watermelon-lee.github.io/2018/06/09/DesignPattern1/</id>
    <published>2018-06-09T12:56:19.000Z</published>
    <updated>2018-06-10T02:41:41.968Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h1><h2 id="普通工厂模式"><a href="#普通工厂模式" class="headerlink" title="普通工厂模式"></a>普通工厂模式</h2><p>建立一个工厂类,对实现了同一个接口或类的类进行实例创建.<br><a id="more"></a><br>以计算器为例子.<br><img src="../../../../img/Design/factory.png" alt="工厂模式"><br>父类:Operate:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package SimpleFactory;</span><br><span class="line"></span><br><span class="line">public class OperateClass &#123;</span><br><span class="line">    private double number1;</span><br><span class="line">    private double number2;</span><br><span class="line"></span><br><span class="line">    public double getNumber1() &#123;</span><br><span class="line">        return number1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setNumber1(double number1) &#123;</span><br><span class="line">        this.number1 = number1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getNumber2() &#123;</span><br><span class="line">        return number2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setNumber2(double number2) &#123;</span><br><span class="line">        this.number2 = number2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getResult()&#123;return 0;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>子类:<br>Plus:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package SimpleFactory;</span><br><span class="line"></span><br><span class="line">public class Plus extends OperateClass &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public double getResult() &#123;</span><br><span class="line">        return getNumber1()+getNumber2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Minus:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package SimpleFactory;</span><br><span class="line"></span><br><span class="line">public class Minus extends OperateClass &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public double getResult() &#123;</span><br><span class="line">        return getNumber1()-getNumber2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Multiply:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package SimpleFactory;</span><br><span class="line"></span><br><span class="line">public class Multiply extends OperateClass &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public double getResult() &#123;</span><br><span class="line">        return getNumber1()*getNumber2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>工厂类:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package SimpleFactory;</span><br><span class="line"></span><br><span class="line">public class OperateFactory &#123;</span><br><span class="line">    public OperateClass createOperate(String type)&#123;</span><br><span class="line">        if(type.equals(&quot;plus&quot;))&#123;</span><br><span class="line">            return new Plus();</span><br><span class="line">        &#125;else if (type.equals(&quot;minus&quot;))&#123;</span><br><span class="line">            return new Minus();</span><br><span class="line">        &#125;else if(type.equals(&quot;multiply&quot;))&#123;</span><br><span class="line">            return new Multiply();</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            return new OperateClass();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>测试:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package SimpleFactory;</span><br><span class="line"></span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;请输入符号:plus,minus,multiply&quot;);</span><br><span class="line">        Scanner scanner=new Scanner(System.in);</span><br><span class="line">        String type=scanner.nextLine();</span><br><span class="line">        OperateClass operate=new OperateFactory().createOperate(type);</span><br><span class="line">        operate.setNumber1(scanner.nextInt());</span><br><span class="line">        scanner.nextLine();</span><br><span class="line">        operate.setNumber2(scanner.nextInt());</span><br><span class="line">        System.out.println(operate.getResult());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>输入:plus<br>    15<br>    20<br>输出:35  </p><h2 id="多个工厂方法模式"><a href="#多个工厂方法模式" class="headerlink" title="多个工厂方法模式:"></a>多个工厂方法模式:</h2><p>上面的普通工厂模式,如传入错误的Type,则无法创建正确的对象.工厂模式则提供多个工厂方法,分别创建对象.<br>工厂类:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package SimpleFactory;</span><br><span class="line"></span><br><span class="line">public class MethodOperateFactory &#123;</span><br><span class="line">    public OperateClass createPlus() &#123;</span><br><span class="line">        return new Plus();</span><br><span class="line">    &#125;</span><br><span class="line">    public OperateClass createMinus()&#123;</span><br><span class="line">        return new Minus();</span><br><span class="line">    &#125;</span><br><span class="line">    public OperateClass createMultiply()&#123;</span><br><span class="line">        return new Multiply();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="静态工厂方法模式"><a href="#静态工厂方法模式" class="headerlink" title="静态工厂方法模式"></a>静态工厂方法模式</h3><p>将上面的工厂中的方法设置为静态,即可不需要创建实例,直接调用.</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>工厂模式适合出现了大量产品需要创建,并且有共同的接口或者父类的场景.</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简单工厂模式&quot;&gt;&lt;a href=&quot;#简单工厂模式&quot; class=&quot;headerlink&quot; title=&quot;简单工厂模式&quot;&gt;&lt;/a&gt;简单工厂模式&lt;/h1&gt;&lt;h2 id=&quot;普通工厂模式&quot;&gt;&lt;a href=&quot;#普通工厂模式&quot; class=&quot;headerlink&quot; title=&quot;普通工厂模式&quot;&gt;&lt;/a&gt;普通工厂模式&lt;/h2&gt;&lt;p&gt;建立一个工厂类,对实现了同一个接口或类的类进行实例创建.&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="DesignPattern" scheme="https://watermelon-lee.github.io/tags/DesignPattern/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis学习总结3</title>
    <link href="https://watermelon-lee.github.io/2018/06/08/Mybatis3/"/>
    <id>https://watermelon-lee.github.io/2018/06/08/Mybatis3/</id>
    <published>2018-06-08T13:04:52.000Z</published>
    <updated>2018-06-09T03:14:48.605Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Mybatis事务管理与缓存机制"><a href="#Mybatis事务管理与缓存机制" class="headerlink" title="Mybatis事务管理与缓存机制"></a>Mybatis事务管理与缓存机制</h1><p>数据库的事务管理是一个重要的点,合理的利用缓存可以加快查询速度,提升性能<br><a id="more"></a></p><p>#Mybaits事务管理</p><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>事务是一步或者几步操作组成的逻辑执行单元,这些基本操作作为一个整体的执行单元,要么全部执行,要么全部不执行.<br>事务具有4个特性(ACID)</p><ul><li>原子性(Atomicity)事务应用中的最小执行单位,具有不可分割的特征.</li><li>一致性(Consustency)事务执行的结果必须是数据库从一种状态变为另一种一致性状态.</li><li>隔离性(Isolation)各个事务的执行互不干扰,任意事物的内部操作对其他并发的事务都是隔离的.</li><li>持久性(Durability)事务一旦提交,对数据所做的改变需要要永久的记录到永久存储器中,即保存到物理数据库.</li></ul><h3 id="Transaction接口"><a href="#Transaction接口" class="headerlink" title="Transaction接口"></a>Transaction接口</h3><p>Mybatis事务transaction接口有两个实现类,分别是org.apache.ibatis.transaction.jdbc.JdbcTransaction与org.apache.ibatis.transaction.managed.ManagedTransaction.还设计了TransactionFactory与其两个实现类JdbcTransactionFactory与ManagedTransactionFactory用来获取事务的实例对象.<br>对于事务而言,有以下具体动作:创建(Create),提交(Commit),回滚(Rollback),关闭(Close).对应的Mybatis将事务抽象成为Transaction接口(源码):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package org.apache.ibatis.transaction;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">public interface Transaction &#123;</span><br><span class="line">    Connection getConnection() throws SQLException;</span><br><span class="line"></span><br><span class="line">    void commit() throws SQLException;</span><br><span class="line"></span><br><span class="line">    void rollback() throws SQLException;</span><br><span class="line"></span><br><span class="line">    void close() throws SQLException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Mybatis事务管理有两种方式:</p><ul><li>使用JDBC事务管理机制:即利用java,sql.Connection对象完成事务的提交(commit),回滚(rollback)和关闭(close)</li><li>使用MANAGED的事务管理机制:对于这种机制,Mybatis自身不会去实现事务管理,而是让容器例如JBOSS等来实现事务管理.</li></ul><h3 id="事务的配置与使用"><a href="#事务的配置与使用" class="headerlink" title="事务的配置与使用"></a>事务的配置与使用</h3><h4 id="事务的配置"><a href="#事务的配置" class="headerlink" title="事务的配置"></a>事务的配置</h4><p>在使用Mybatis时,需要在Mybatis根配置文件Mybatis-Config.xml中配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">       &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">           &lt;!-- 配置事务管理 ，采用JDBC管理事务--&gt;</span><br><span class="line">           &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">           &lt;!-- POOLED是mybatis的 数据源 --&gt;</span><br><span class="line">           &lt;!-- JNDI是基于tomcat的数据源 --&gt;</span><br><span class="line">           &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">               &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driverClassName&#125;&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">           &lt;/dataSource&gt;</span><br><span class="line">       &lt;/environment&gt;</span><br><span class="line">   &lt;/environments&gt;</span><br></pre></td></tr></table></figure></p><p><environment>元素定义了连接数据库的类型,而<transactionmanager>子元素的type属性决定了我们使用什么事务管理机制.</transactionmanager></environment></p><h3 id="JdbcTransaction"><a href="#JdbcTransaction" class="headerlink" title="JdbcTransaction"></a>JdbcTransaction</h3><p>JdbcTransaction可以直接使用JDBC的提交和回滚事务管理机制.即使用java.sql.Connection上的commit与rollback功能来完成实务操作,相当于对java.sql.Connection的再次封装.JdbcTransaction源码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="line">// (powered by Fernflower decompiler)</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">package org.apache.ibatis.transaction.jdbc;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import org.apache.ibatis.logging.Log;</span><br><span class="line">import org.apache.ibatis.logging.LogFactory;</span><br><span class="line">import org.apache.ibatis.session.TransactionIsolationLevel;</span><br><span class="line">import org.apache.ibatis.transaction.Transaction;</span><br><span class="line">import org.apache.ibatis.transaction.TransactionException;</span><br><span class="line"></span><br><span class="line">public class JdbcTransaction implements Transaction &#123;</span><br><span class="line">    private static final Log log = LogFactory.getLog(JdbcTransaction.class);</span><br><span class="line">    protected Connection connection;//获取数据库连接</span><br><span class="line">    protected DataSource dataSource;//获取数据源</span><br><span class="line">    protected TransactionIsolationLevel level;//隔离级别</span><br><span class="line">    protected boolean autoCommmit;//是否自动提交</span><br><span class="line"></span><br><span class="line">    public JdbcTransaction(DataSource ds, TransactionIsolationLevel desiredLevel, boolean desiredAutoCommit) &#123;</span><br><span class="line">        this.dataSource = ds;</span><br><span class="line">        this.level = desiredLevel;</span><br><span class="line">        this.autoCommmit = desiredAutoCommit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public JdbcTransaction(Connection connection) &#123;</span><br><span class="line">        this.connection = connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Connection getConnection() throws SQLException &#123;</span><br><span class="line">        if (this.connection == null) &#123;</span><br><span class="line">            this.openConnection();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return this.connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void commit() throws SQLException &#123;</span><br><span class="line">        if (this.connection != null &amp;&amp; !this.connection.getAutoCommit()) &#123;</span><br><span class="line">            if (log.isDebugEnabled()) &#123;</span><br><span class="line">                log.debug(&quot;Committing JDBC Connection [&quot; + this.connection + &quot;]&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            this.connection.commit();//提交</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void rollback() throws SQLException &#123;</span><br><span class="line">        if (this.connection != null &amp;&amp; !this.connection.getAutoCommit()) &#123;</span><br><span class="line">            if (log.isDebugEnabled()) &#123;</span><br><span class="line">                log.debug(&quot;Rolling back JDBC Connection [&quot; + this.connection + &quot;]&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            this.connection.rollback();//回滚</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void close() throws SQLException &#123;</span><br><span class="line">        if (this.connection != null) &#123;</span><br><span class="line">            this.resetAutoCommit();</span><br><span class="line">            if (log.isDebugEnabled()) &#123;</span><br><span class="line">                log.debug(&quot;Closing JDBC Connection [&quot; + this.connection + &quot;]&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            this.connection.close();//关闭</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>从上面可以发现JdbcTransaction就是使用java.sql.Connection的commit与rollback等完成实务操作.<br>采用JDBC访问数据库的基本步骤：<br>    A.载入JDBC驱动程序<br>    B.定义连接URL<br>    C.建立连接<br>    D.创建Statement对象<br>    E.执行查询或更新<br>    F.结果处理<br>    G.关闭连接<br>以前写的项目中JDBC使用env配置(在context.xml中配置好数据源,然后在listener中初始化DadaSource读取该数据源文件,完成了连接信息的隔离,可以不用上面的A,B步骤使用DriverManager.getConnection(url,username,password))的操作:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = null;</span><br><span class="line">        PreparedStatement stmt = null;</span><br><span class="line">        SQLException ex = null;</span><br><span class="line">        boolean exist = false;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn = dataSource.getConnection();</span><br><span class="line">            stmt = conn.prepareStatement(&quot;SELECT COUNT(1) FROM  account WHERE name=?&quot;);</span><br><span class="line">            stmt.setString(1, account.getName());</span><br><span class="line">            ResultSet rs = stmt.executeQuery();</span><br><span class="line">            if (rs.next()) &#123;</span><br><span class="line">                exist = (rs.getInt(1) == 1);//确认有无查询结果</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            ex = e;</span><br><span class="line">        &#125; finally &#123;//最后记得关闭连接</span><br><span class="line">            if (stmt != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    stmt.close();</span><br><span class="line">                &#125; catch (SQLException e) &#123;</span><br><span class="line">                    if (ex == null) &#123;</span><br><span class="line">                        ex = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (conn != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; catch (SQLException e) &#123;</span><br><span class="line">                    if (ex == null) &#123;</span><br><span class="line">                        ex = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (ex != null) &#123;</span><br><span class="line">                throw new RuntimeException(ex);</span><br><span class="line">            &#125;</span><br><span class="line">            return exist;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><h4 id="ManagedTransaction"><a href="#ManagedTransaction" class="headerlink" title="ManagedTransaction"></a>ManagedTransaction</h4><p>源码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="line">// (powered by Fernflower decompiler)</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">package org.apache.ibatis.transaction.managed;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line">import org.apache.ibatis.logging.Log;</span><br><span class="line">import org.apache.ibatis.logging.LogFactory;</span><br><span class="line">import org.apache.ibatis.session.TransactionIsolationLevel;</span><br><span class="line">import org.apache.ibatis.transaction.Transaction;</span><br><span class="line"></span><br><span class="line">public class ManagedTransaction implements Transaction &#123;</span><br><span class="line">    private static final Log log = LogFactory.getLog(ManagedTransaction.class);</span><br><span class="line">    private DataSource dataSource;</span><br><span class="line">    private TransactionIsolationLevel level;</span><br><span class="line">    private Connection connection;</span><br><span class="line">    private boolean closeConnection;</span><br><span class="line"></span><br><span class="line">    public ManagedTransaction(Connection connection, boolean closeConnection) &#123;</span><br><span class="line">        this.connection = connection;</span><br><span class="line">        this.closeConnection = closeConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ManagedTransaction(DataSource ds, TransactionIsolationLevel level, boolean closeConnection) &#123;</span><br><span class="line">        this.dataSource = ds;</span><br><span class="line">        this.level = level;</span><br><span class="line">        this.closeConnection = closeConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Connection getConnection() throws SQLException &#123;</span><br><span class="line">        if (this.connection == null) &#123;</span><br><span class="line">            this.openConnection();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return this.connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void commit() throws SQLException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void rollback() throws SQLException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void close() throws SQLException &#123;</span><br><span class="line">        if (this.closeConnection &amp;&amp; this.connection != null) &#123;</span><br><span class="line">            if (log.isDebugEnabled()) &#123;</span><br><span class="line">                log.debug(&quot;Closing JDBC Connection [&quot; + this.connection + &quot;]&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            this.connection.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    ......</span><br></pre></td></tr></table></figure></p><p>可以看到在提交与回滚的时候,函数总没有任何操作,即什么都不做,交给容器来操作管理.</p><p>##　Mybatis缓存机制<br>Mybatis缓存为两个级别,一级缓存是SqlSession级别的缓存,二级缓存是mapper级别的缓存,可以多个SqlSession共享.</p><h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><p>在操作数据库时就需要构造SqlSession对象,在其中有一个HashMap用于存储缓存数据.<br>一级缓存的作用域是SqlSession范围的,当在同一个SqlSession中执行两次相同sql语句是,第一次执行会将数据库查询到的语句写入到缓存,第二次就会直接从缓存中获取,不再去数据库底层查询,提高查询效率.如果数据库执行了DML操作(insert,update,delete),并且提交到了数据库(SqlSession.commit()),Mybatis会清空SqlSession中的一级缓存,目的是为了保证缓存中都是最新的信息,避免脏读.<br>当一个SqlSession结束之后(close),其中的一级缓存就不存在了.Mybatis默认开启一级缓存.</p><h3 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h3><p>二级缓存是mapper级别的缓存.使用二级缓存是,多个SqlSession使用同一个mapper的sql语句操作数据库.得到的数据会在二级缓存区域,也是使用HashMap存储.<br>二级缓存有多个SqlSession共享,作用域是mapper的同一个namespace,不同的SqlSession执行相同namespace中的sql语句,第一次会将数据库中查询的语句写到缓存中,第二次会直接在缓存中获取.当同样的执行insert,update与delete之后,缓存会清空.<br>Mybatis没有默认开启二级缓存,需要在setting全局参数中配置开启二级缓存.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>然后在Mapper.xml中创建缓存:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache eviction=&quot;LRU&quot; flushInterval=&quot;6000&quot; size=&quot;512&quot; readOnly=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>以上配置创建了一个LRU(最近最少使用策略)缓存,每隔60s刷新,最大存储512个对象,返回的对象是只读.<br>cache元素用来开启当前mapper的namespace下的二级缓存.元素有以下属性:</p><ul><li>flushInterval:刷新间隔,毫秒为单位.默认不设置,没有刷新间隔,只有当调用调用语句时刷新.</li><li>size:缓存数目.默认为1024</li><li>readOnly:只读.只读缓存会给所有调用者返回缓存对象的实例,因此这些对象不可修改.可读写的缓存会返回缓存对象的拷贝(通过序列化),这会降低速度,但是更为安全.默认为false.</li><li>eviction:收回策略,默认为LRU:<br>  1.LRU:最经最少使用策略,移除最长时间不被使用的<br>  2.FIFI:先进先出策略.按对象进入的缓存顺序来移除他们.<br>  3.SOFT:软引用策略.移除基于垃圾收集器状态和软引用规则的对象.<br>  4.WEAK:弱引用策略,g更积极的移除垃圾收集器状态与弱引用规则的对象.<br>最重要的是readonly=ture， 说明cache对象只读，update的时候，cache不会更新！那么换个角度来说，其实代表了发生任何insert，update，delete操作的时候，会全量清理cache数据，确保一致性。如果readonly=false的时候，就比较好玩了，更新数据会写入新的cache，并且DO对象要实现序列化.<br>使用二级缓存是注意与查询结果映射的Java对象必须实现序列化,yi应为二级缓存数据不一定只在内存中,还有可能放在硬盘或者远程服务器上.  .<br>还可以在select语句中设置userCache=”false”来禁止使用二级缓存,保证每次查询都是最新结果.  </li></ul><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>在实验的时候,发现每次控制台每次输出都是 Cache Hit Ratio [com.mapper.EmployeeDao]: 0.0.表示缓存中命中几率为0.原来是我在每次查询完之后没有进行提交(session.commit().),而是在最后才提交.导致缓存中一开始并没有写入查询出来的数据,而是到最后总提交之后缓存中才有数据.以后记得每次操作完之后马上提交.</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Mybatis事务管理与缓存机制&quot;&gt;&lt;a href=&quot;#Mybatis事务管理与缓存机制&quot; class=&quot;headerlink&quot; title=&quot;Mybatis事务管理与缓存机制&quot;&gt;&lt;/a&gt;Mybatis事务管理与缓存机制&lt;/h1&gt;&lt;p&gt;数据库的事务管理是一个重要的点,合理的利用缓存可以加快查询速度,提升性能&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Mybatis" scheme="https://watermelon-lee.github.io/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis学习总结2</title>
    <link href="https://watermelon-lee.github.io/2018/06/07/Mybatis2/"/>
    <id>https://watermelon-lee.github.io/2018/06/07/Mybatis2/</id>
    <published>2018-06-07T13:59:58.000Z</published>
    <updated>2018-06-08T14:29:40.900Z</updated>
    
    <content type="html"><![CDATA[<h1 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h1><p>Mybaits的一个强大特性,可以根据不同的条件来拼接SQL语句.<br><a id="more"></a><br>创建一个数据表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#employee</span><br><span class="line">CREATE TABLE employee(</span><br><span class="line">  id INT(11) PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">  loginName VARCHAR(18),</span><br><span class="line">  password VARCHAR(18),</span><br><span class="line">  name VARCHAR(18) DEFAULT NULL,</span><br><span class="line">  sex VARCHAR(4) DEFAULT&apos;男&apos;,</span><br><span class="line">  age INT(11) DEFAULT NULL ,</span><br><span class="line">  phone VARCHAR(19),</span><br><span class="line">  sal DOUBLE,</span><br><span class="line">  state VARCHAR(12)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO employee(loginName, password, name, sex, age, phone, sal, state) VALUES (&apos;jack&apos;,&apos;123&apos;,&apos;杰克&apos;,&apos;nv&apos;,12,&apos;123456789&apos;,9041.22,&apos;active&apos;);</span><br><span class="line">INSERT INTO employee(loginName, password, name, sex, age, phone, sal, state) VALUES (&apos;wade&apos;,&apos;123&apos;,&apos;韦德&apos;,&apos;男&apos;,32,&apos;786868686&apos;,123.22,&apos;active&apos;);</span><br><span class="line">INSERT INTO employee(loginName, password, name, sex, age, phone, sal, state) VALUES (&apos;kobe&apos;,&apos;123&apos;,&apos;科比&apos;,&apos;男&apos;,124,&apos;123411223&apos;,234.22,&apos;active&apos;);</span><br><span class="line">INSERT INTO employee(loginName, password, name, sex, age, phone, sal, state) VALUES (&apos;james&apos;,&apos;123&apos;,&apos;詹姆斯&apos;,&apos;男&apos;,54,&apos;123444312&apos;,9041.22,&apos;Inactive&apos;);</span><br></pre></td></tr></table></figure></p><p>创建对应的实体类:Employee<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">public class Employee &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String loginName;</span><br><span class="line">    private String password;</span><br><span class="line">    private String name;</span><br><span class="line">    private String sex;</span><br><span class="line">    private int age;</span><br><span class="line">    private String phone;</span><br><span class="line">    private double sal;</span><br><span class="line">    private String state;</span><br><span class="line">    //省略setter与getter</span><br></pre></td></tr></table></figure></p><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>使用if可动态的包含where子句的条件的一部分,如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectWithIf1&quot; resultType=&quot;employee&quot;&gt;</span><br><span class="line">        SELECT * FROM employee WHERE state=&apos;active&apos;</span><br><span class="line">        &lt;!--加上选择条件,如果传来的参数有id,则加上id条件查询--&gt;</span><br><span class="line">        &lt;if test=&quot;id!=null&quot;&gt;AND id=#&#123;id&#125;&lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></p><p>如果有多个搜索条件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectWithIf2&quot; resultType=&quot;employee&quot;&gt;</span><br><span class="line">        SELECT * FROM employee WHERE state=&apos;active&apos;</span><br><span class="line">        &lt;if test=&quot;loginName!=null and password !=null&quot;&gt;</span><br><span class="line">            AND loginName=#&#123;loginName&#125; AND password=#&#123;password&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></p><h2 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose(when,otherwise)"></a>choose(when,otherwise)</h2><p>从我们想用的条件中选择其中一个,注意只会选择一个,先满足的先选择<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Choose,when,otherwise 只会选择一个,先符合的先选择--&gt;</span><br><span class="line">    &lt;select id=&quot;selectWithChoose&quot; resultType=&quot;employee&quot;&gt;</span><br><span class="line">        SELECT * FROM employee WHERE state=&apos;active&apos;</span><br><span class="line">        &lt;choose&gt;</span><br><span class="line">            &lt;when test=&quot;id!=null&quot;&gt;</span><br><span class="line">                AND id=#&#123;id&#125;</span><br><span class="line">            &lt;/when&gt;</span><br><span class="line">            &lt;when test=&quot;loginName!=null and password!=null&quot;&gt;</span><br><span class="line">                and loginName=#&#123;loginName&#125; AND password=#&#123;password&#125;</span><br><span class="line">            &lt;/when&gt;</span><br><span class="line">            &lt;otherwise&gt;</span><br><span class="line">                AND sex=&apos;男&apos;</span><br><span class="line">            &lt;/otherwise&gt;</span><br><span class="line">        &lt;/choose&gt;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure></p><h2 id="where"><a href="#where" class="headerlink" title="where"></a>where</h2><p>当where的条件不一定会有一个满足时,则可能会执行sql语句如:select * from employee where,这样显然是错误的句子.我么需要使用where元素解决.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--where 在不确定是否一定有条件传入,使用where,若有,则加上条件,如没有,则不加入--&gt;</span><br><span class="line">   &lt;select id=&quot;selectWithWhere&quot; resultType=&quot;employee&quot;&gt;</span><br><span class="line">       SELECT * FROM employee</span><br><span class="line">       &lt;where&gt;</span><br><span class="line">           &lt;if test=&quot;state!=null&quot;&gt;</span><br><span class="line">               SELECT state=#&#123;state&#125;</span><br><span class="line">           &lt;/if&gt;</span><br><span class="line">           &lt;if test=&quot;sex!=null&quot;&gt;</span><br><span class="line">               SELECT sex=#&#123;sex&#125;</span><br><span class="line">           &lt;/if&gt;</span><br><span class="line">       &lt;/where&gt;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure></p><p>这样,只有当有一个即以上的if条件成立时,才会插入where子句,否则执行select * from employee.</p><h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>使用set关键字动态包含需要跟新的列.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--使用set动态更新语句--&gt;</span><br><span class="line">    &lt;update id=&quot;updateWithSet&quot; parameterType=&quot;employee&quot;&gt;</span><br><span class="line">        UPDATE employee</span><br><span class="line">        &lt;set&gt;</span><br><span class="line">            &lt;if test=&quot;loginName!=null&quot;&gt;loginName=#&#123;loginName&#125;,&lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;password!=null&quot;&gt;password=#&#123;password&#125;,&lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;name!=null&quot;&gt;name=#&#123;name&#125;,&lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;sex!=null&quot;&gt;sex=#&#123;sex&#125;,&lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;age!=null&quot;&gt;age=#&#123;age&#125;,&lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;sal!=null&quot;&gt;sal=#&#123;sal&#125;,&lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;phone!=null&quot;&gt;phone=#&#123;phone&#125;,&lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;state!=null&quot;&gt;state=#&#123;state&#125;&lt;/if&gt;</span><br><span class="line">        &lt;/set&gt;</span><br><span class="line"></span><br><span class="line">        WHERE id=#&#123;id&#125;</span><br><span class="line">    &lt;/update&gt;</span><br></pre></td></tr></table></figure></p><p>set元素会自动前置SET关键字,并且去除无关的逗号.</p><h2 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h2><p>在SQL查询时,通常需要惊进行集合便利,通常发生在构建IN条件语句的时候.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--foreach遍历集合--&gt;</span><br><span class="line">   &lt;!--sql语句为SELECT * FROM employee WHERE id IN ( ? , ? , ? )--&gt;</span><br><span class="line">   &lt;select id=&quot;selectWithForeach&quot; resultType=&quot;employee&quot;&gt;</span><br><span class="line">       SELECT * FROM employee WHERE id IN</span><br><span class="line">       &lt;foreach collection=&quot;list&quot; index=&quot;index&quot; item=&quot;item&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">           #&#123;item&#125;</span><br><span class="line">       &lt;/foreach&gt;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure></p><p>注意定义open,separator,close属性,否则生成sql语句为<code>SELECT * FROM employee WHERE id IN ? ? ?</code>,而我们需要的是<code>SELECT * FROM employee WHERE id IN ( ? , ? , ? )</code>.</p><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>bind元素可以创建一个变量,并绑定到上下文中.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectWithBind&quot; resultType=&quot;employee&quot;&gt;</span><br><span class="line">       &lt;bind name=&quot;var&quot; value=&quot;&apos;%&apos;+_parameter.getName()+&apos;%&apos;&quot;/&gt;</span><br><span class="line">       SELECT * FROM employee WHERE loginName LIKE  #&#123;var&#125;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure></p><p>使用_parameter可以获取你传入的javabean对象.然后调用getName()获取名字.生成sql语句<code>SELECT * FROM employee WHERE loginName LIKE ?</code> 查询参数为`Parameters: %a%(String)’,则可进行模糊查询.<br>自己也尝试了一下之间传参来进行模糊查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectWithBind2&quot; resultType=&quot;employee&quot;&gt;</span><br><span class="line">        SELECT * FROM employee WHERE loginName like #&#123;name&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure></p><p>这样在调用方法传参之前需要自己对模糊查询处理一下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name=&quot;o&quot;;</span><br><span class="line">List&lt;Employee&gt;employeeList1=employeeDao.selectWithBind2(&apos;%&apos;+name+&apos;%&apos;);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;动态SQL&quot;&gt;&lt;a href=&quot;#动态SQL&quot; class=&quot;headerlink&quot; title=&quot;动态SQL&quot;&gt;&lt;/a&gt;动态SQL&lt;/h1&gt;&lt;p&gt;Mybaits的一个强大特性,可以根据不同的条件来拼接SQL语句.&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Mybatis" scheme="https://watermelon-lee.github.io/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis学习总结1</title>
    <link href="https://watermelon-lee.github.io/2018/06/05/Mybatis/"/>
    <id>https://watermelon-lee.github.io/2018/06/05/Mybatis/</id>
    <published>2018-06-05T12:32:11.000Z</published>
    <updated>2018-06-07T13:15:00.931Z</updated>
    
    <content type="html"><![CDATA[<p>最近在细学Mybatis,写一下总结,一边日后回顾.<br><a id="more"></a></p><h1 id="Mybatis关系映射"><a href="#Mybatis关系映射" class="headerlink" title="Mybatis关系映射"></a>Mybatis关系映射</h1><h2 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h2><p>一对一映射比如每个学生对应与一个学生卡,使用外键来关联.以学生与班级来示例.<br>创建两个表:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE TABLE card(</span><br><span class="line">  id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">  code VARCHAR(19),</span><br><span class="line">  name VARCHAR(19)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE table student(</span><br><span class="line">  id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">  name VARCHAR(10),</span><br><span class="line">  age int,</span><br><span class="line">  class_id int,</span><br><span class="line">  FOREIGN KEY (class_id) REFERENCES class(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>然后创建两个实体类:<br>Card:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Card &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String code;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Card&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, code=&apos;&quot; + code + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Card() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Card(String code, String name) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCode(String code) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Student:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">public class Student &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    //测试一对一</span><br><span class="line">    private Card card;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Student&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, age=&quot; + age +</span><br><span class="line">                &quot;, card=&quot; + card +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Student() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Student(String name, int age, Card card) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">        this.card = card;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(int age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public card getCard() &#123;</span><br><span class="line">        return card;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCard(Card card) &#123;</span><br><span class="line">        this.card = card;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在Student中定义了一个Card类,用来表示该学生的班级.<br>然后创建Mybatis配置文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!--通过这个配置文件，完成mybatis与数据库的连接  --&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- 注意此配置文件内的元素的  --&gt;</span><br><span class="line">    &lt;!-- 引入database.properties文件 --&gt;</span><br><span class="line">    &lt;properties resource=&quot;jdbc.properties&quot;/&gt;</span><br><span class="line">    &lt;!-- 从target中的classes文件夹中读取文件,不用classpath--&gt;</span><br><span class="line">    &lt;!--配置mybatis的log实现为LOG4J  --&gt;</span><br><span class="line">    &lt;!-- 配置后，后台就会有sql语句的输出 --&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">    &lt;!-- 设置类的别名 --&gt;</span><br><span class="line">    &lt;typeAliases&gt;</span><br><span class="line">        &lt;!-- &lt;typeAlias alias=&quot;User&quot; type=&quot;com.wu.pojo.User&quot;/&gt; --&gt;</span><br><span class="line">        &lt;!-- 根据包取别名，把包下面的所有类都按类名来取别名 --&gt;</span><br><span class="line">        &lt;!-- 这用可以简化代码量 但是使用的是类名的小写 --&gt;</span><br><span class="line">        &lt;package name=&quot;com.domain&quot;/&gt;</span><br><span class="line">    &lt;/typeAliases&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;!-- 配置事务管理 ，采用JDBC管理事务--&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;!-- POOLED是mybatis的 数据源 --&gt;</span><br><span class="line">            &lt;!-- JNDI是基于tomcat的数据源 --&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driverClassName&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!-- pojo的映射文件UserMapper引入到配入到配置文件中 --&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!-- resource要写成路径 --&gt;</span><br><span class="line">        &lt;mapper resource=&quot;mapper/UserMapper.xml&quot;/&gt;</span><br><span class="line">        &lt;mapper resource=&quot;mapper/StudentMapper.xml&quot;/&gt;</span><br><span class="line">        &lt;mapper resource=&quot;mapper/CardMapper.xml&quot;/&gt;</span><br><span class="line">        &lt;!--&lt;package name=&quot;mapper&quot;/&gt;&amp;lt;!&amp;ndash; ???用处？？？ &amp;ndash;&amp;gt;--&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p><p>在创建两个实体类对应的映射文件:<br>CardMapper:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.mapper.CardDao&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;select&quot; parameterType=&quot;int&quot; resultType=&quot;Card&quot;&gt;</span><br><span class="line">        SELECT * FROM card WHERE id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>StudentMapper:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.mapper.StudentDao&quot;&gt;</span><br><span class="line">    &lt;!--定义用于映射的student的resultMap--&gt;</span><br><span class="line">   &lt;resultMap id=&quot;studentMap&quot; type=&quot;student&quot;&gt;</span><br><span class="line">       &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">       &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">       &lt;result property=&quot;age&quot; column=&quot;age&quot;/&gt;</span><br><span class="line">       &lt;!--定义一对一的映射关系--&gt;</span><br><span class="line">       &lt;association property=&quot;card&quot; column=&quot;card_id&quot;</span><br><span class="line">                    javaType=&quot;com.domain.Card&quot; select=&quot;com.mapper.CardDao.select&quot;/&gt;</span><br><span class="line">   &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--&lt;select id=&quot;selectCard&quot; parameterType=&quot;int&quot; resultType=&quot;card&quot;&gt;--&gt;</span><br><span class="line">        &lt;!--SELECT * FROM card WHERE id = #&#123;id&#125;--&gt;</span><br><span class="line">    &lt;!--&lt;/select&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;select&quot; resultMap=&quot;studentMap&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        SELECT * FROM student WHERE id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>应为Student中包含了Card对象,所以执行select时候返回的不只是Student对象,所以需要自己定义一个resultMap来映射返回类型.<br>关联映射使用<association>标签,其中的属性如下:</association></p><ul><li>property:返回类型Student中的Card属性名,对应于实体类Student中的Card</li><li>column:对应数据库中的列名,映射到id上.</li><li>JavaType:属性的类型名称,即Student实体类中card对应的类,即com.domain.Card</li><li>select:执行的查询语句,将使用column对应的id作为参数来进行查询,将数据封装到property所代表的类型对象中.<br>使用Dao接口代理对象访问Mybatis,该对象关联了SqlSession对象,可以直接通过该对象操作数据库.对应映射文件中的namespace.Dao接口的类名需要与mapper映射文件中namespace中定义的名字一致,此外Dao接口中的方法名与参数也要与mapper映射文件中定义的SQL操作语句的id名与parameterTpe一致.<br>StudentDao:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package com.mapper;</span><br><span class="line"></span><br><span class="line">import com.domain.Student;</span><br><span class="line"></span><br><span class="line">public interface StudentDao &#123;</span><br><span class="line">    Student select(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>这样便完成了Student到Card的一对一映射.<br>测试:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void OneToOne() &#123;</span><br><span class="line">    private SqlSession sqlSession;</span><br><span class="line">        InputStream inputStream=this.getClass().getResourceAsStream(&quot;mybatis/Mybatis-config.xml&quot;);//从target中的classes文件夹中读取文件</span><br><span class="line"></span><br><span class="line">        //初始化mybatis,创建SqlsessionFactory实例</span><br><span class="line">        private SqlSessionFactory sqlSessionFactory=new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">        //创建Session实例</span><br><span class="line">        sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        //获得mapper接口的代理</span><br><span class="line">        StudentDao studentDao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">        CardDao cardDao=sqlSession.getMapper(CardDao.class);</span><br><span class="line">        Card card=cardDao.select(1);</span><br><span class="line">        System.out.println(card);</span><br><span class="line">        //直接调用接口查询</span><br><span class="line">        Student student=studentDao.select(1);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h2><p>一个班级可以有许多学生,一个学生也只属于一个班级,则班级与学生就是一对多的关系.我们在数据库中使用主外键关联,外键应该在多的一方,也就是学生中,即多方维护关系.<br>创建学生student与班级clazz数据表,然后创建对应的实体类:<br>Clazz:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Clazz &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String code;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    //测试一对多</span><br><span class="line">    private List&lt;Student&gt; studentList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public List&lt;Student&gt; getStudentList() &#123;</span><br><span class="line">        return studentList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setStudentList(List&lt;Student&gt; studentList) &#123;</span><br><span class="line">        this.studentList = studentList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Clazz&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, code=&apos;&quot; + code + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, studentList=&quot; + studentList +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Clazz() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Clazz(String code, String name) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCode(String code) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Student:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">public class Student &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    //测试一对一</span><br><span class="line">    private Clazz clazz;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Student&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, age=&quot; + age +</span><br><span class="line">                &quot;, clazz=&quot; + clazz +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Student() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Student(String name, int age, Clazz clazz) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">        this.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(int age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Clazz getClazz() &#123;</span><br><span class="line">        return clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setClazz(Clazz clazz) &#123;</span><br><span class="line">        this.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后创建对应的映射文件,ClazzMapper:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.mapper.ClazzDao&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;select&quot; parameterType=&quot;int&quot; resultType=&quot;clazz&quot;&gt;</span><br><span class="line">        SELECT * FROM clazz WHERE id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=&quot;clazzMap&quot; type=&quot;clazz&quot;&gt;</span><br><span class="line">        &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;code&quot; column=&quot;code&quot;/&gt;</span><br><span class="line">        &lt;!--映射多对一 使用懒加载--&gt;</span><br><span class="line">        &lt;collection property=&quot;studentList&quot; column=&quot;id&quot;</span><br><span class="line">                    javaType=&quot;ArrayList&quot; ofType=&quot;student&quot;</span><br><span class="line">                    select=&quot;selectStudentWithClazzId&quot; fetchType=&quot;lazy&quot;&gt;</span><br><span class="line">            &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;age&quot; column=&quot;age&quot;/&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--根据班级Id查询学生--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;selectStudentWithClazzId&quot; parameterType=&quot;int&quot; resultType=&quot;student&quot;&gt;</span><br><span class="line">        SELECT * FROM student WHERE clazz_id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有班级信息--&gt;</span><br><span class="line">    &lt;select id=&quot;selectAll&quot; resultMap=&quot;clazzMap&quot;&gt;</span><br><span class="line">        SELECT * FROM clazz</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;selectClazzById&quot; parameterType=&quot;int&quot; resultMap=&quot;clazzMap&quot;&gt;</span><br><span class="line">        SELECT * FROM clazz WHERE id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>使用<collection>元素映射一对多的关联关系,其中select表示使用Column属性的id作为查询参数进行selectStudentWithClazzId查询.查询对象将封装到property对应的studentList对象中.<br>fetchType表示加载策略,有eager与lazy(急加载与懒加载).使用懒加载是,查询班级时候,不会立即查询其中所有学生,而是需要时在进行加载.fetch机制更多的是为了考虑性能,一般情况下,一对多集合对象,使用懒加载.<br>需要在Mybatis-config中配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">&lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;</span><br></pre></td></tr></table></figure></collection></p><p>lazyLoadingEnabled表示延迟加载的全局开关,开启时,所有对象都会懒加载.<br>aggressiveLazyLoading启用时,会是懒加载的元素懒加载,按需加载.</p><p>StudentMapper:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.mapper.StudentDao&quot;&gt;</span><br><span class="line">    &lt;!--定义用于映射的student的resultMap--&gt;</span><br><span class="line">   &lt;resultMap id=&quot;studentMap&quot; type=&quot;student&quot;&gt;</span><br><span class="line">       &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">       &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">       &lt;result property=&quot;age&quot; column=&quot;age&quot;/&gt;</span><br><span class="line">       &lt;!--定义一对一的映射关系--&gt;</span><br><span class="line">       &lt;association property=&quot;clazz&quot; column=&quot;clazz_id&quot;</span><br><span class="line">                    javaType=&quot;com.domain.Clazz&quot; select=&quot;com.mapper.ClazzDao.select&quot;/&gt;</span><br><span class="line">   &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--&lt;select id=&quot;selectClazz&quot; parameterType=&quot;int&quot; resultType=&quot;clazz&quot;&gt;--&gt;</span><br><span class="line">        &lt;!--SELECT * FROM clazz WHERE id = #&#123;id&#125;--&gt;</span><br><span class="line">    &lt;!--&lt;/select&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;select&quot; resultMap=&quot;studentMap&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        SELECT * FROM student WHERE id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>然后配置mapper对应的Dao接口,与前面一对一类似,然后进行测试即可.</p><h2 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h2><p>多对多在开发商城时十分常见,一个用户下订单订购商品,一个用户可以对应多个订单,一个订单对应一个用户,这是一对多.一个商品可以对应多个订单,一个订单也可对应多个商品.这是多对多.对于数据库的多对多关系,我们一般需要建立一个中间表来维护,中间表中的订单id作为外检参照订单表的id,中间表的商品id作为外检参照商品表的id.<br>首先创建数据表:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#创建用户表</span><br><span class="line">CREATE TABLE users(</span><br><span class="line">  id INT(8)  PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">  username VARCHAR(10)</span><br><span class="line">);</span><br><span class="line">#创建商品表</span><br><span class="line">CREATE TABLE goods(</span><br><span class="line">  id INT(8) PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">  name VARCHAR(10),</span><br><span class="line">  price DOUBLE</span><br><span class="line">);</span><br><span class="line">#创建订单表</span><br><span class="line">CREATE TABLE orders(</span><br><span class="line">  id INT(8) PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">  code VARCHAR(30),</span><br><span class="line">  user_id INT(8),</span><br><span class="line">  FOREIGN KEY (user_id) REFERENCES users(id)</span><br><span class="line">);</span><br><span class="line">#创建中间表,表示商品与订单多对多</span><br><span class="line">CREATE TABLE goods_order(</span><br><span class="line">  order_id INT,</span><br><span class="line">  goods_id INT,</span><br><span class="line">  amount INT,</span><br><span class="line">  PRIMARY KEY (order_id,goods_id),</span><br><span class="line">  FOREIGN KEY (order_id) REFERENCES orders(id),</span><br><span class="line">  FOREIGN KEY (goods_id) REFERENCES goods(id)</span><br><span class="line">);</span><br><span class="line">INSERT INTO users(username) VALUE(&quot;wade&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO goods(name,price) VALUES (&quot;basketball&quot;,246);</span><br><span class="line">INSERT INTO goods(name,price) VALUES (&quot;shoes&quot;,965);</span><br><span class="line">INSERT INTO goods(name,price) VALUES (&quot;cloth&quot;,426);</span><br><span class="line"></span><br><span class="line">INSERT INTO  orders(code, user_id) VALUES (&quot;001&quot;,1);</span><br><span class="line">INSERT INTO  orders(code, user_id) VALUES (&quot;002&quot;,1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO goods_order VALUES (1,1,2);</span><br><span class="line">INSERT INTO goods_order VALUES (1,2,4);</span><br><span class="line">INSERT INTO goods_order VALUES (1,3,2);</span><br><span class="line">INSERT INTO goods_order VALUES (2,2,2);</span><br><span class="line">INSERT INTO goods_order VALUES (2,1,6);</span><br></pre></td></tr></table></figure></p><p>首先创建实体类:<br>Users:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Users implements Serializable &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String userName;</span><br><span class="line">    //用户与订单是一对多</span><br><span class="line">    private List&lt;Orders&gt;ordersList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public List&lt;Orders&gt; getOrdersList() &#123;</span><br><span class="line">        return ordersList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOrdersList(List&lt;Orders&gt; ordersList) &#123;</span><br><span class="line">        this.ordersList = ordersList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserName(String userName) &#123;</span><br><span class="line">        this.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Users&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, userName=&apos;&quot; + userName + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, ordersList=&quot; + ordersList +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Orders:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Orders implements Serializable &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String code;</span><br><span class="line">    //订单与用户是多对一</span><br><span class="line">    private Users users;</span><br><span class="line">    //订单与商品是多对多</span><br><span class="line">    private List&lt;Goods&gt;goodsList;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCode(String code) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Users getUsers() &#123;</span><br><span class="line">        return users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUsers(Users users) &#123;</span><br><span class="line">        this.users = users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Goods&gt; getGoodsList() &#123;</span><br><span class="line">        return goodsList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGoodsList(List&lt;Goods&gt; goodsList) &#123;</span><br><span class="line">        this.goodsList = goodsList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Orders&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, code=&apos;&quot; + code + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, users=&quot; + users +</span><br><span class="line">                &quot;, goodsList=&quot; + goodsList +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Goods:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Orders implements Serializable &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String code;</span><br><span class="line">    //订单与用户是多对一</span><br><span class="line">    private Users users;</span><br><span class="line">    //订单与商品是多对多</span><br><span class="line">    private List&lt;Goods&gt;goodsList;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCode(String code) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Users getUsers() &#123;</span><br><span class="line">        return users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUsers(Users users) &#123;</span><br><span class="line">        this.users = users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Goods&gt; getGoodsList() &#123;</span><br><span class="line">        return goodsList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGoodsList(List&lt;Goods&gt; goodsList) &#123;</span><br><span class="line">        this.goodsList = goodsList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Orders&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, code=&apos;&quot; + code + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, users=&quot; + users +</span><br><span class="line">                &quot;, goodsList=&quot; + goodsList +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后定义映射文件:<br>UsersMapper:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.mapper.UsersDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=&quot;usersMap&quot; type=&quot;users&quot;&gt;</span><br><span class="line">        &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;userName&quot; column=&quot;username&quot;/&gt;</span><br><span class="line">        &lt;collection property=&quot;ordersList&quot; ofType=&quot;orders&quot; column=&quot;id&quot;</span><br><span class="line">                    javaType=&quot;ArrayList&quot; fetchType=&quot;lazy&quot; select=&quot;com.mapper.OrdersDao.selectOrdersByUserId&quot;&gt;</span><br><span class="line">            &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;code&quot; column=&quot;code&quot;/&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;selectUsersByUserId&quot; resultMap=&quot;usersMap&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        SELECT * FROM users WHERE id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>OrdersMapper:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.mapper.OrdersDao&quot;&gt;</span><br><span class="line">    &lt;resultMap id=&quot;ordersMap&quot; type=&quot;orders&quot; &gt;</span><br><span class="line">        &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;code&quot; column=&quot;code&quot;/&gt;</span><br><span class="line">        &lt;!--多对一映射 orders对应的users--&gt;</span><br><span class="line">        &lt;association property=&quot;users&quot; column=&quot;user_id&quot; javaType=&quot;users&quot; select=&quot;com.mapper.UsersDao.selectUsersByUserId&quot;&gt;</span><br><span class="line">            &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;userName&quot; column=&quot;username&quot;/&gt;</span><br><span class="line">        &lt;/association&gt;</span><br><span class="line">        &lt;!--多对多映射--&gt;</span><br><span class="line">        &lt;collection property=&quot;goodsList&quot; column=&quot;id&quot; javaType=&quot;ArrayList&quot;</span><br><span class="line">                    ofType=&quot;goods&quot; fetchType=&quot;lazy&quot; select=&quot;com.mapper.GoodsDao.selectGoodsByOrderId&quot;&gt;</span><br><span class="line">            &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">            &lt;result property=&quot;price&quot; column=&quot;price&quot;/&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询订单,有相同的列名需要用别名来区分,如users里面查询出来的id与orders里的id列名重复--&gt;</span><br><span class="line">    &lt;select id=&quot;selectOrdersByOrderId&quot; resultMap=&quot;ordersMap&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        SELECT u.*,o.id,code,user_id FROM users u,orders o WHERE u.id=user_id AND  o.id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!--根据用户id查询订单--&gt;</span><br><span class="line">    &lt;select id=&quot;selectOrdersByUserId&quot; parameterType=&quot;int&quot; resultType=&quot;orders&quot;&gt;</span><br><span class="line">        SELECT * FROM orders WHERE user_id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>GoddsMapper:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.mapper.GoodsDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--根据orderId将goods都查出--&gt;</span><br><span class="line">    &lt;select id=&quot;selectGoodsByOrderId&quot; parameterType=&quot;int&quot; resultType=&quot;goods&quot;&gt;</span><br><span class="line">          SELECT * FROM goods WHERE id IN (SELECT goods_id FROM goods_order WHERE order_id=#&#123;id&#125;)</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>然后创建映射Dao接口即可进行测试.</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><p>ORM是Object/Relation Mapping 即对象/关系数据库映射.ORM完成了面向对象的编程语言到面向关系的数据库映射.他将关系数据库包装成为一种对象模型.<br>使用ORM框架之后,应用程序不需要直接访问底层数据库,而是以面向对象的方式操纵持久话对象,而ORM框架将这些面向对象的操作转换为底层的SQL操作.<br>ORM有一下基本映射关系:</p><ul><li>数据表映射类</li><li>数据表的行映射实例</li><li>数据表的lies映射实例对象的属性</li></ul><h2 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h2><ul><li>Mybatis的PO十分简单,与普通的JavaBean没有区别,所以Mybatis是一种低入侵式设计.</li><li>SqlsessionFactory是Mybatis的关键对象,他是单个数据库映射关系经过编译之后的内存镜像.每个Mybatis的应用程序以一个SqlsessionFactory对象实例为核心.并且SqlsessionFactory是线程安全的,一旦被创建,应该在整个应用程序执行期间都存在.在应用程序运行期间不要多次创建,应当使用单例模式.如果想连接两个数据库,就需要分别创建两个SqlSessionFactory实例.SqlsessionFactory是创建Sqlsession的工厂.使用SqlsessionFactory.openSession()来创建.</li><li>SqlSession是Mybatis执行持久化操作的对象.他是应用程序与持久层之间执行交互操作的一个单线程对象.SqlSession对象完全包含了以数据库为北京的所有执行SQL操作方法,底层封装了JDBC连接,可以用SqlSession对象直接执行以映射的SQL语句.每个线程都应该有自己的SqlSession实例.SqlSession实例不可共享,非线程安全,不可以将SqlSession放在一个类的静态字段与实例字段中.使用完SqlSession需要关闭.</li></ul><p>与一对一是,在数据库中可以引入外键作为关联,一般是多方维护关系,即在多方中引入外检,然后在实体类中属性包含该关联类.比如Users与Orders是一对多关系,则在表Orders中有User_id属性,并且在实体类Orders中有Users属性,而Users中则包含List<orders>orderList.而多对多关系则引入联表,用于查询两者对应关系,如goods_orders,并在两者实体类中包含对应属性.  </orders></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在细学Mybatis,写一下总结,一边日后回顾.&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Mybatis" scheme="https://watermelon-lee.github.io/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>Maven</title>
    <link href="https://watermelon-lee.github.io/2018/05/30/Spring-Maven/"/>
    <id>https://watermelon-lee.github.io/2018/05/30/Spring-Maven/</id>
    <published>2018-05-30T14:26:21.000Z</published>
    <updated>2018-06-09T07:04:07.714Z</updated>
    
    <content type="html"><![CDATA[<p>自己对于Maven依赖一直有些迷糊,每次都是之间复制配置文件,还是需要有所了解,慢慢做一个总结<br><a id="more"></a></p><h1 id="Spring必要依赖"><a href="#Spring必要依赖" class="headerlink" title="Spring必要依赖"></a>Spring必要依赖</h1><p>总体上来说必须要有的一共是7个依赖:</p><ul><li>Spring核心依赖:spring-core,spring-beans,spring-context</li><li>SpringDao依赖:spring-jdbc,spring-tx</li><li>SPring web依赖:spring-web,spring-webmvc</li><li>Spring test依赖:spring-test</li></ul><h2 id="常见依赖的具体功能"><a href="#常见依赖的具体功能" class="headerlink" title="常见依赖的具体功能"></a>常见依赖的具体功能</h2><ul><li>spring-core:包含Spring框架基本核心工具类型.Spring其他的组件都需要使用这个包里面的类.外部依赖commons logging(Log4J)</li><li>spring-beans:所有应用都要用到,包含配置文件,创建和管理bean以及进行Inversion of Control/Dependency Injection(IOC/DI)相关操作的所有类.外部依赖spring-core</li><li>spring-aop:对使用Spring AOP特性是所需要的所有类进行支持.基于AOP的Spring特性如声明事务管理也包含在其中.外部依赖spring-core.soring-beans.</li><li>spring-context:为Spring核心提供了大量的扩展.可以找到Spring ApplicationContexttext所需的所有类,JDNI(Java Naming and Directory Interface)所需全部类.instrumentation组件以及校验Validation方面相关的类.</li><li>spring-dao:这个jar 文件包含Spring DAO、Spring Transaction 进行数据访问的所有类.为了使用声明型事务支持，还需在自己的应用里包含spring-aop.jar.外部依赖spring-core，spring-aop， spring-context.</li><li>spring-jdbc:这个jar 文件包含对Spring 对JDBC 数据访问进行封装的所有类.外部依赖spring-beans，spring-dao</li><li>spring-context-support:包含支持缓存Cache（ehcache）、JCA、JMX、 邮件服务（Java Mail、COS Mail）、任务计划Scheduling（Timer、Quartz）方面的类.以前的版本中应该是这个：spring-support.jar这个jar 文件包含支持UI模版（Velocity，FreeMarker，JasperReports），邮件服务，脚本服务(JRuby)，缓存Cache（EHCache），任务计划Scheduling（uartz）方面的类.</li><li>spring-web:这个jar 文件包含Web 应用开发时，用到Spring 框架时所需的核心类，包括自动载入Web Application Context 特性的类、Struts 与JSF 集成类、文件上传的支持类、Filter 类和大量工具辅助类.外部依赖spring-context, Servlet API.</li><li>spring-webmvc:这个jar 文件包含Spring MVC 框架相关的所有类.包括框架的Servlets，Web MVC框架，控制器和视图支持.当然，如果你的应用使用了独立的MVC 框架，则无需这个JAR 文件里的任何类.外部依赖spring-web.spring-support.</li><li>spring-orm:包含Spring对DAO特性集进行了扩展，使其支持iBATIS、JDO、OJB、TopLink，因为Hibernate已经独立成包了，现在不包含在这个包里了.这个jar文件里大部分的类都要依赖spring-dao.jar里的类，用这个包时你需要同时包含spring-dao.jar包.</li><li>spring-oxm:Spring 对Object/XMl的映射支持,可以让Java与XML之间来回切换.</li><li>spring-tx:以前是在这里org.springframework.transaction为JDBC、Hibernate、JDO、JPA、Beans等提供的一致的声明式和编程式事务管理支持.</li></ul><!-- Spring依赖 --><pre><code>&lt;!-- 1.Spring核心依赖 --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;</code></pre><!-- 2.Spring dao依赖 --><!-- spring-jdbc包括了一些如jdbcTemplate的工具类 --><pre><code>&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;!-- 3.Spring web依赖 --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-web&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;!-- 4.Spring test依赖：方便做单元测试和集成测试 --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-test&lt;/artifactId&gt;    &lt;version&gt;4.3.7.RELEASE&lt;/version&gt;</code></pre><p>　　<br><code>`</code></p><h1 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h1><p>要完成使用MyBatis访问MySQL数据库，需要添加一些依赖包，包含MyBatis3，连接驱动，JUnit，Log4j2等</p><dependency><br>  <groupid>org.mybatis</groupid><br>  <artifactid>mybatis</artifactid><br>  <version>3.4.7-SNAPSHOT</version><br></dependency><br>   <!-- junit.jar --><br><dependency><br>  <groupid>junit</groupid><br>  <artifactid>junit</artifactid><br>  <version>4.10</version><br>  </dependency><br><br><dependency><br>  <groupid>mysql</groupid><br>  <artifactid>mysql-connector-java</artifactid><br>  <version>5.1.29</version><br></dependency><h1 id="SSM必要依赖"><a href="#SSM必要依赖" class="headerlink" title="SSM必要依赖"></a>SSM必要依赖</h1><p>在别人<a href="https://maoyanting.github.io" target="_blank" rel="noopener">博客</a>找了一份</p><p><table></table></p><p><thead></thead></p><p><tr></tr></p><p><th style="text-align:left">依赖名</th></p><p><th>功能</th><br><br></p><p><tbody></tbody></p><p><tr></tr></p><p><td style="text-align:left"><strong>———测试—————</strong></td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left">junit</td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left"><strong>———日志—————</strong></td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left">slf4j-api</td></p><p><td>使用lSlf4j+logback组合</td><br></p><p><tr></tr></p><p><td style="text-align:left">logback-core</td></p><p><td>其余组合详见<a href="http://tech.lede.com/2017/02/06/rd/server/log4jSearch/" target="_blank" rel="noopener">日志工具现状调研</a>、<a href="http://www.ixirong.com/2016/03/13/intro-to-java-log/" target="_blank" rel="noopener">混乱的 Java 日志体系</a></td><br></p><p><tr></tr></p><p><td style="text-align:left">logback-classic(集成包)</td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left"><strong>———数据库—————</strong></td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left">mysql-connector-java</td></p><p><td>使用了c3p0，其余选择见<a href="http://blog.csdn.net/u012050416/article/details/50738892" target="_blank" rel="noopener">c3p0数据库连接池介绍+实例</a></td><br></p><p><tr></tr></p><p><td style="text-align:left">c3p0</td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left"><strong>———Mybatis—————</strong></td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left">mybatis</td></p><p><td>使用了mybatis-spring</td><br></p><p><tr></tr></p><p><td style="text-align:left">mybatis-spring</td></p><p><td>具体使用详见<a href="http://www.mybatis.org/spring/zh/index.html" target="_blank" rel="noopener">mybatis-spring(中文)</a>和<a href="http://www.mybatis.org/spring/factorybean.html" target="_blank" rel="noopener">mybatis-spring(English)</a></td><br></p><p><tr></tr></p><p><td style="text-align:left">mybatis-generator-core</td></p><p><td>辅助：自动生成Mapping的映射文件</td><br></p><p><tr></tr></p><p><td style="text-align:left"><strong>———Spring—————</strong></td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left">spring-webmvc</td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left">spring-test</td></p><p><td>配合junit使用，详见[<a href="http://www.cnblogs.com/rainisic/archive/2012/01/22/Spring_Test_Framework.html" target="_blank" rel="noopener">Spring Test 整合 JUnit 4 使用总结</a>]</td><br></p><p><tr></tr></p><p><td style="text-align:left">spring-tx</td></p><p><td>spring提供对事务的支持</td><br></p><p><tr></tr></p><p><td style="text-align:left"></td></p><p><td>其余可参考<a href="http://www.cnblogs.com/zhangminghui/p/3455782.html" target="_blank" rel="noopener">Spring3.2.2中相关Jar包的作用</a></td><br></p><p><tr></tr></p><p><td style="text-align:left"><strong>———Json—————</strong></td></p><p><td></td><br></p><p><tr></tr></p><p><td style="text-align:left">fastjson</td></p><p><td>ali的一个开源json软件</td><br></p><p><tr></tr></p><p><td style="text-align:left"></td><br><br><br><br>这里重点提一下spring-webmvc，这里导入的是4.3.13.RELEASE，同时，还会隐式导入:</p><ul><li>spring-beans</li><li>spring-context</li><li>spring-aop</li><li>spring-core</li><li>spring-web</li><li>spring-expression</li><li>commons-logging</li><li>spring-context-support</li><li>spring-oxm</li><li>javax.servlet-api<br>等依赖，所以，如果你导入了spring-webmvc，这些依赖就不需要重复写一遍了。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自己对于Maven依赖一直有些迷糊,每次都是之间复制配置文件,还是需要有所了解,慢慢做一个总结&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Maven" scheme="https://watermelon-lee.github.io/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC-Summary</title>
    <link href="https://watermelon-lee.github.io/2018/05/30/SpringMVC-Summary/"/>
    <id>https://watermelon-lee.github.io/2018/05/30/SpringMVC-Summary/</id>
    <published>2018-05-30T14:15:58.000Z</published>
    <updated>2018-06-03T01:58:00.260Z</updated>
    
    <content type="html"><![CDATA[<p>对自己所学的SpringMVC做一个总结<br><a id="more"></a></p><h1 id="web-xml配置"><a href="#web-xml配置" class="headerlink" title="web.xml配置"></a>web.xml配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># @Controller</span><br><span class="line">@Controller用来标记一个类，使用其标记的对象就是一个SpringMVC Controller对象，即一个控制类。Spring使用扫描机制查找应用程序中所有基于注解的控制类。分发处理器会扫描使用了该注解的类的方法，查看是否使用了@RequestMapping注解，而@RequestMapping才是真正的处理请求的处理器。为了保证使Spring能找到控制器，需要完成两节事情：</span><br><span class="line">* 在SpringMVC配置头文件引入Spring-context。</span><br><span class="line">* 使用&lt;context:component-scan base-package=“com.web”/&gt;元素，扫描指定的包，以便注册@Controller，@Service，@Repository，@Component等注解类成为Spring的Bean。</span><br><span class="line"># @RequestMapping&lt;br&gt;@RequestMapping用于注释一个类或者方法处理请求动作。常用属性有：</span><br><span class="line">* value：该属性将URL映射到具体的方法上。如`@RequestMapping（value=“/index”)public ModelAndView index()`.</span><br><span class="line">* method：制定该方法处理哪些HTTP请求方式`@RequestMapping（value=“/index”method=&quot;RequestMethod.GET&quot;)public ModelAndView index()`.</span><br><span class="line">* consumes:该属性处理请求的提交内容类型（Content-Type）。`@RequestMapping（value=“/index”method=&quot;RequestMethod.GET&quot; conmuses=“application/json”)public ModelAndView index()`.该方法表示处理request Content-Type为application/json类型的请求。</span><br><span class="line">* params：指定request中必须包含某些参数，才让该方法处理。`@RequestMapping（value=“/index”method=&quot;RequestMethod.GET&quot; conmuses=“application/json” params=“myParam=myValue”)public ModelAndView index()`。方法只处理含有名为“myParam”，值为“myValue”的请求。</span><br><span class="line"># 参数绑定注解&lt;br&gt;## @RequestParam注解</span><br><span class="line">可指定属性：</span><br><span class="line">* name：指定请求头绑定属性的名称</span><br><span class="line">* value：name属性名的别称&lt;br&gt;* required（true，false）：指定参数是否必须</span><br><span class="line">* defaultValue：如果没有传递参数使用的默认值,例如</span><br><span class="line">```@RequestMapping(value=&quot;/login&quot;)</span><br><span class="line">    public ModelAndView login(@RequestParam(&quot;userName&quot;)String userName,@RequestParam(value=&quot;birthday&quot;,required=&quot;false&quot;)Date birthday)&#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h2><p>使用该注解可以方便的获得URL中间的动态参数。@PathVariable只有一个属性value，表示绑定参数的名称。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    public ModelAndView list(@PathVariable(&quot;userId)Integer userId)&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a>@SessionAttributes</h2><p>将需要的对象转存到HttpSession对象中。在控制器类上标注。</p><h2 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a>@ModelAttribute</h2><p>如果希望将方法入参对象添加到模型当中，只需在入参前添加@ModelAttribute属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/login&quot;)</span><br><span class="line">public ModelAndView login(@ModelAttribute（“user”） User user)</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>则SpringMVC以user为键，将User对象放到模型当中，在对视图渲染前。SpringMVC还会将模型中的数据转储到视图的上下文中，并且暴露给视图。<br>此外，还可以在方法定义中使用。SpringMVC在先处理请求时，会先逐个调用标注了@ModelAttribute的方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@ModelAttribute(&quot;user&quot;)</span><br><span class="line">public User getUser() &#123;</span><br><span class="line">User user = new User();</span><br><span class="line">    user.setUserId(&quot;1001&quot;);</span><br><span class="line">        user.setUserName(&quot;&lt;&gt;&quot;);</span><br><span class="line">       return user;</span><br><span class="line">    &#125;</span><br><span class="line">    @RequestMapping(value = &quot;/handle62&quot;)</span><br><span class="line">    public String handle62(@ModelAttribute(&quot;user&quot;) User user) &#123;</span><br><span class="line">user.setUserName(&quot;tom&quot;);</span><br><span class="line">return &quot;/user/showUser&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在访问该控制器的任何方法之前，SpringMVC先执行标注了@ModelAttribute的方法，如getUser（），将返回值以user为键添加到模型中间。<br>然后执行handle62方法时候，模型数据会赋值给user入参，然后根据Http请求消息中的参数进一步填充覆盖user。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;对自己所学的SpringMVC做一个总结&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Spring" scheme="https://watermelon-lee.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring+SpringMVC+Hibernate实战项目</title>
    <link href="https://watermelon-lee.github.io/2018/05/30/Project1/"/>
    <id>https://watermelon-lee.github.io/2018/05/30/Project1/</id>
    <published>2018-05-30T05:25:47.000Z</published>
    <updated>2018-06-09T12:57:52.641Z</updated>
    
    <content type="html"><![CDATA[<p>自己写的一个社区/论坛的项目<a href="https://github.com/watermelon-lee/-" target="_blank" rel="noopener">ThisIsUsCommunity</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;自己写的一个社区/论坛的项目&lt;a href=&quot;https://github.com/watermelon-lee/-&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ThisIsUsCommunity&lt;/a&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Project" scheme="https://watermelon-lee.github.io/tags/Project/"/>
    
  </entry>
  
  <entry>
    <title>我的API文档</title>
    <link href="https://watermelon-lee.github.io/2018/05/20/JavaWebAPI/"/>
    <id>https://watermelon-lee.github.io/2018/05/20/JavaWebAPI/</id>
    <published>2018-05-20T01:24:19.000Z</published>
    <updated>2018-05-27T12:14:46.498Z</updated>
    
    <content type="html"><![CDATA[<p>把自己在编程中遇到的一些不会的API都记录下来<br><a id="more"></a></p><h1 id="Assert-断言"><a href="#Assert-断言" class="headerlink" title="Assert(断言)"></a>Assert(断言)</h1><p>属于org.springframework.util.Assert.是方法参数校验工具类.常用方法有:  </p><ul><li>notNull(Object object)<br>当 object 不为 null 时抛出异常，notNull(Object object, String message)方法允许您通过 message 定制异常信息。和 notNull() 方法断言规则相反的方法是 isNull(Object object)/isNull(Object object, String message)，它要求入参一定是 null；  </li><li>isTrue(boolean expression) / isTrue(boolean expression, String message)<br>当 expression 不为 true 抛出异常.  </li><li>notEmpty(Collection collection) / notEmpty(Collection collection, String message)<br>当集合未包含元素时抛出异常。<br>notEmpty(Map map) / notEmpty(Map map, String message) 和 notEmpty(Object[] array, String message) / notEmpty(Object[] array, String message) 分别对 Map 和 Object[] 类型的入参进行判断；  </li><li>hasLength(String text) / hasLength(String text, String message)  当 text 为 null 或长度为 0 时抛出异常；  </li><li>hasText(String text) / hasText(String text, String message)  text 不能为 null 且必须至少包含一个非空格的字符，否则抛出异常；  </li><li>isInstanceOf(Class clazz, Object obj) / isInstanceOf(Class type, Object obj, String message)  如果 obj 不能被正确造型为 clazz 指定的类将抛出异常；  </li><li>isAssignable(Class superType, Class subType) / isAssignable(Class superType, Class subType, String message)  subType 必须可以按类型匹配于 superType，否则将抛出异常；  <h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1></li><li>int indexOf(String str):返回指定子字符串在此字符串第一次出现的索引.</li><li>String toLowerCase():使用默认语言环境下的规则将此String中的所有字符转化为小写.</li><li>String subString(int beginIndex):返回一个行的字符串,他是该字符串的子串</li><li>equalsIgnoreCase（String s）：将此String与另一个String s比较，不考虑大小写<h1 id="Pattern"><a href="#Pattern" class="headerlink" title="Pattern"></a>Pattern</h1>正则表达式的编译表示形式。<br>指定为字符串的正则表达式必须首先被编译为此类的实例。然后，可将得到的模式用于创建 Matcher 对象，依照正则表达式，该对象可以与任意字符序列匹配。执行匹配所涉及的所有状态都驻留在匹配器中，所以多个匹配器可以共享同一模式。<br>因此，典型的调用顺序是<br>   Pattern p = Pattern.compile(“a<em>b”);<br>   Matcher m = p.matcher(“aaaaab”);<br>   boolean b = m.matches();<br>在仅使用一次正则表达式时，可以方便地通过此类定义 matches 方法。此方法编译表达式并在单个调用中将输入序列与其匹配。语句boolean b = Pattern.matches(“a</em>b”, “aaaaab”);等效于上面的三个语句，尽管对于重复的匹配而言它效率不高，因为它不允许重用已编译的模式。<br>此类的实例是不可变的，可供多个并发线程安全使用。Matcher 类的实例用于此目的则不安全。  <h2 id="正则表达式摘要"><a href="#正则表达式摘要" class="headerlink" title="正则表达式摘要"></a>正则表达式摘要</h2></li><li>\     反斜线字符</li><li>.     任何字符（与行结束符可能匹配也可能不匹配）</li><li>\d     数字：[0-9]</li><li>\D     非数字： [^0-9]</li><li>\s     空白字符：[ \t\n\x0B\f\r]</li><li>\S     非空白字符：[^\s]</li><li>\w     单词字符：[a-zA-Z_0-9]</li><li>\W     非单词字符：[^\w]<h2 id="常见方法"><a href="#常见方法" class="headerlink" title="常见方法"></a>常见方法</h2></li><li>static Pattern compile(String regex):将给定的正则表达式编译到模式中。</li><li>static Pattern compile(String regex, int flags):将给定的正则表达式编译到具有给定标志的模式中。</li><li>Matcher matcher(CharSequence input):创建匹配给定输入与此模式的匹配器。</li></ul><h1 id="Matcher"><a href="#Matcher" class="headerlink" title="Matcher"></a>Matcher</h1><p> 通过解释 Pattern 对 character sequence 执行匹配操作的引擎。<br>通过调用模式的 matcher 方法从模式创建匹配器。创建匹配器后，可以使用它执行三种不同的匹配操作：  </p><pre><code>matches 方法尝试将整个输入序列与该模式匹配。  lookingAt 尝试将输入序列从头开始与该模式匹配。  find 方法扫描输入序列以查找与该模式匹配的下一个子序列。  </code></pre><p>每个方法都返回一个表示成功或失败的布尔值。通过查询匹配器的状态可以获取关于成功匹配的更多信息。  </p><p>匹配器在其输入的子集（称为区域）中查找匹配项。默认情况下，此区域包含全部的匹配器输入。可通过 region 方法修改区域，通过 regionStart 和 regionEnd 方法查询区域。区域边界与某些模式构造交互的方式是可以更改的。有关此内容更多的信息，请参阅 useAnchoringBounds 和 useTransparentBounds。  </p><p>此类还定义使用新字符串替换匹配子序列的方法，需要时，可以从匹配结果计算出新字符串的内容。可以先后使用 appendReplacement 和 appendTail 方法将结果收集到现有的字符串缓冲区，或者使用更加便捷的 replaceAll 方法创建一个可以在其中替换输入序列中每个匹配子序列的字符串。  </p><p>匹配器的显式状态包括最近成功匹配的开始和结束索引。它还包括模式中每个捕获组捕获的输入子序列的开始和结束索引以及该子序列的总数。出于方便的考虑，还提供了以字符串的形式返回这些已捕获子序列的方法。  </p><p>匹配器的显式状态最初是未定义的；在成功匹配导致 IllegalStateException 抛出之前尝试查询其中的任何部分。每个匹配操作都将重新计算匹配器的显式状态。  </p><p>匹配器的隐式状态包括输入字符序列和添加位置，添加位置最初是零，然后由 appendReplacement 方法更新。  </p><p>可以通过调用匹配器的 reset() 方法来显式重置匹配器，如果需要新输入序列，则调用其 reset(CharSequence) 方法。重置匹配器将放弃其显式状态信息并将添加位置设置为零。  </p><p>此类的实例用于多个并发线程是不安全的。  </p><h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><p>Matcher     appendReplacement(StringBuffer sb, String replacement)<br>          实现非终端添加和替换步骤。<br>StringBuffer     appendTail(StringBuffer sb)<br>          实现终端添加和替换步骤。<br>  boolean     find()<br>          尝试查找与该模式匹配的输入序列的下一个子序列。<br> boolean     find(int start)<br>          重置此匹配器，然后尝试查找匹配该模式、从指定索引开始的输入序列的下一个子序列。  </p><h1 id="插话"><a href="#插话" class="headerlink" title="插话"></a>插话</h1><p>StringBuffer 字符串变量（线程安全）<br>StringBuilder 字符串变量（非线程安全）<br>简要的说， String 类型和 StringBuffer 类型的主要性能区别其实在于 String 是不可变的对象, 因此在每次对 String 类型进行改变的时候其实都等同于生成了一个新的 String 对象，然后将指针指向新的 String 对象，所以经常改变内容的字符串最好不要用 String ，因为每次生成对象都会对系统性能产生影响，特别当内存中无引用对象多了以后， JVM 的 GC 就会开始工作，那速度是一定会相当慢的。<br> 而如果是使用 StringBuffer 类则结果就不一样了，每次结果都会对 StringBuffer 对象本身进行操作，而不是生成新的对象，再改变对象引用。所以在一般情况下我们推荐使用 StringBuffer ，特别是字符串对象经常改变的情况下。  </p><h1 id="Query-Hibernate"><a href="#Query-Hibernate" class="headerlink" title="Query(Hibernate)"></a>Query(Hibernate)</h1><p>Query实例是通过调用Session.createQuery（）获得的(Query query=getSession().createQuery(hql)).<br>可以通过调用setMaxResults（），setFirstResult（）来选择结果集的特定页面<br>常用方法:<br>List     list()<br>          Return the query results as a List.<br>int     executeUpdate()<br>          Execute the update or delete statement.<br>Iterator     iterate()<br>          Return the query results as an Iterator.<br>Query     setFirstResult(int firstResult)<br>          Set the first row to retrieve(检索).<br>Query     setMaxResults(int maxResults)<br>          Set the maximum number of rows to retrieve.<br>Query     setParameter(int position, Object val)<br>          Bind a value to a JDBC-style query parameter.  </p><h1 id="List"><a href="#List" class="headerlink" title="List"></a>List</h1><ul><li>sublist(int i,int j):截取原list一段下来，但是只是快照，如果修改截取的部分list，原list也会相应的变化</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;把自己在编程中遇到的一些不会的API都记录下来&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="JavaWeb" scheme="https://watermelon-lee.github.io/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>HibernateJPA</title>
    <link href="https://watermelon-lee.github.io/2018/05/19/HibernateJPA/"/>
    <id>https://watermelon-lee.github.io/2018/05/19/HibernateJPA/</id>
    <published>2018-05-19T03:33:20.000Z</published>
    <updated>2018-05-19T12:06:46.397Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HibernateJPA注解"><a href="#HibernateJPA注解" class="headerlink" title="HibernateJPA注解"></a>HibernateJPA注解</h1><p>最近在写一个论坛的Demo,接触带了许多Hibernate的注解,不是很了解,做个笔记<br><a id="more"></a></p><h2 id="类级别注解"><a href="#类级别注解" class="headerlink" title="类级别注解"></a>类级别注解</h2><ul><li>@Entity(name=”Name”):映射实体类,name可选,对应数据库中的一个表.</li><li>@Table(name=”Name”,catalog=”Catalog”,schema=”Schema”):与@Entity配合使用,只能标注在实体类的class上,表示实体类对应的数据库表信息.Name可选，映射表的名称，若表名与实体类名相同，则name可省略。catalog可选，表示catalog名称，默认为Catalog(“”)。Schema可选，表示schema名称，默认为schma(“”)。 </li><li>@inheritance:参见<a href="https://blog.csdn.net/ack_finding/article/details/78691361" target="_blank" rel="noopener">博客</a></li><li>@cache:设置缓存策略,Hibernate提供了以下集中策略.<ol><li>CacheConcurrencyStrategy.NONE:不使用缓存.</li><li>CacheConcurrencyStrategy.READ_ONLY:只读模式,在此模式下,如果对数据进行了更新,就会产生异常.</li><li>CacheConcurrencyStrategy.REEAD_WRITE:读写模式,该模式在更新缓存的同时会对缓存里面的数据加锁,其他的事务如果去获取缓存,被锁发现了,就会直接去数据库查询.</li><li>CacheConcurrencyStrategy.NONSTRICT_READ_WRITE:不严格的读写模式,使用该模式不会对缓存数据加锁.</li><li>CacheConcurrencyStrategy.TRANSACTIONAL:事务模式,指缓存支持事务,当事务回滚时,缓存也能回滚,目前只支持JTA环境.<h2 id="属性级别注解"><a href="#属性级别注解" class="headerlink" title="属性级别注解"></a>属性级别注解</h2>可以在属性字段上添加,也可以在属性的get上添加</li></ol></li><li>@id:定义了映射到数据库表的主键属性.</li><li>@GeneratedValue(Strategy=””),用于定义主键生成策略.Strategy有一下策略:<ol><li>GenerationType.AUTO:根据底层数据库自动选择</li><li>GenerationType.INDENTITY:根据数据库的Identity字段生成</li><li>GenerationType.SEQUENCE:使用Sequence来决定主键取值</li><li>GenerationType.TABLE:使用指定表来决定主键取值</li></ol></li><li>@Column:将属性映射到列上,使用该注解来覆盖默认值.可选属性:<ol><li>name:表示数据库表中该字段的名称</li><li>Nullable:该字段是否可为空,默认为True`</li><li>Unique:该字段标示是否唯一,默认为False</li><li>Length:标示字段大小,只对String类型字段有效,默认255</li><li>Inserable:在ORM框架执行Insert操作时,该字段是否需要出现在Insert语句中,默认True</li><li>Updateable:在ORM执行更行操作是,该字段是都出现在Update语句中,默认为True.对于一经创建就不可以更改的字段，改属性非常有用，如对于birthday字段。</li></ol></li><li>@Basic(fetch=”Lazy”,optional=”true”):表示一个简单的属性到数据库字段的映射,对没有标记任何getXXX()的方法,默认为@Basic.fetch表示该属性的读取策略,有EAGER和LAZY.分别为主枝抓取和延迟加载.默认为EAGER.</li><li>@Transient:表示该属性并非一个到数据库表的字段的映射,ORM框架将忽略该属性.如果一个属性并非数据库表的字段映射,就务必将其标示为@Transient,否则,ORM框架默认其注解为@Basic</li></ul><h2 id="关系映射注解"><a href="#关系映射注解" class="headerlink" title="关系映射注解"></a>关系映射注解</h2><p>实体之间的映射关系有一对一,一对多,多对一,多对多.  </p><h3 id="一对一外键"><a href="#一对一外键" class="headerlink" title="一对一外键:"></a>一对一外键:</h3><p>@OneToOne(cascade=CascadeType.ALL,fetch=FetchType)<br>@JoinColumn(name=”pid”,unique=true)<br>注：保存时应该先保存外键对象，再保存主表对象.fetch标示抓取策略,默认为FetchType.LAZY.cascade标示级联操作策略.  </p><h3 id="多对一外键"><a href="#多对一外键" class="headerlink" title="多对一外键"></a>多对一外键</h3><p>@ManyToOne(cascade={CasecadeType.All},fetch=FetchType.EAGER)<br>@JoinColum(name=”cid”, referencedColumnName=”CID”) </p><p>###　多对多单向外键<br>@ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE}, mappedBy = “manBoards”, fetch = FetchType.LAZY)<br>private Set<user> users=new HashSet<user>();  </user></user></p><h3 id="Hibernate-CascadeType说明"><a href="#Hibernate-CascadeType说明" class="headerlink" title="Hibernate CascadeType说明"></a>Hibernate CascadeType说明</h3><p>CascadeType.PERSIST只有A类新增时，会级联B对象新增。若B对象在数据库存（跟新）在则抛异常（让B变为持久态） </p><p>CascadeType.MERGE指A类新增或者变化，会级联B对象（新增或者变化） </p><p>CascadeType.REMOVE只有A类删除时，会级联删除B类； </p><p>CascadeType.ALL包含所有； </p><p>CascadeType.REFRESH没用过。 </p><p>综上：大多数情况用CascadeType.MERGE就能达到级联跟新又不报错，用CascadeType.ALL时要斟酌下CascadeType.REMOVE  </p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;HibernateJPA注解&quot;&gt;&lt;a href=&quot;#HibernateJPA注解&quot; class=&quot;headerlink&quot; title=&quot;HibernateJPA注解&quot;&gt;&lt;/a&gt;HibernateJPA注解&lt;/h1&gt;&lt;p&gt;最近在写一个论坛的Demo,接触带了许多Hibernate的注解,不是很了解,做个笔记&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Hibernate" scheme="https://watermelon-lee.github.io/tags/Hibernate/"/>
    
  </entry>
  
  <entry>
    <title>我们这一年</title>
    <link href="https://watermelon-lee.github.io/2018/05/17/OneYear/"/>
    <id>https://watermelon-lee.github.io/2018/05/17/OneYear/</id>
    <published>2018-05-16T16:00:00.000Z</published>
    <updated>2018-05-18T10:57:17.804Z</updated>
    
    <content type="html"><![CDATA[<p>嗨,西瓜,有你的日子过得好快,我们也在一起一年了.<br><a id="more"></a><br>刚开始的认识始于一次偶然的问候,坐在前桌的你突然回头问我是不是湖南人(大概是我的塑普十分明显),后来问了别人才得知就在隔壁班的你竟也是老乡.之后便添加了你的好友.<br><img src="../../../../img/oneYear/2.jpg" alt="pic2"><br>相互熟悉也是始于一次偶然.没有人报名当人大代表,我就被导员拉去了.大概是需要收集一些同学们反映的问题,然后开会时提出来.想想当时还气的不行,又得浪费打游戏的时间去开一些莫名其妙的会.有天晚上打游戏时,你发了一个意见反馈给我,通过这次聊天,发现两人之间有好多相似的地方,有说不完的话.<br>后来相互熟悉,也觉得互有感觉,进过深思熟虑,终于决定勇敢的表达自己对你喜欢.当然,我成功了,原因的话,大概就是下图吧<br><img src="../../../../img/oneYear/1.jpg" alt="ShowMyLove"><br>和你在一起后生活也多了很多新奇的体验.我们一起在球场看露天电影,走遍校园里的大道与小巷,一路小跑的追逐晚霞,每晚自习完的一起锻炼,一起种星星,在路边走过看这肥肥跳跳滑稽的走路,当然,最后也带你体验了一下我玩了两年的游戏.最后虽然就在良乡呆了两个月,经历却比之前的两年更为丰富.暑假的成都之行也是十分的开心,带着一个每次出行都会做好计划,把行程安排的十分妥当的你体验了一下随意的旅行.<br><img src="../../../../img/oneYear/3.jpg" alt="pic3"><br><img src="../../../../img/oneYear/4.jpg" alt="pic4"><br><img src="../../../../img/oneYear/5.jpg" alt="pic5"><br><img src="../../../../img/oneYear/6.jpg" alt="pic6"><br><img src="../../../../img/oneYear/7.jpg" alt="pic7"><br>当然,我们也有经历一段tough time.大三上你交换去了台湾半年,我们就得经历一段好长时间的异地了.还记得一开始你对于那里各种不适应,找房子,遇到一些不善意的人,和棘手的事情.当然,有问题就找老大投诉,我也愿意听,你不开心的时候我都会在一旁安慰你.还好你可爱又明事理,大多时候都可以哄好你.我也曾失去过耐心,表现的很自私,这种时候我是一个糟糕的男朋友.即便如此,你也总是会包容我,你真挚的情感总是能拯救我,always,always.十分感激.除了那一丢丢不好的地方,台湾这种城市对你这样的文艺女孩也算是天堂啦.有各种集市,你喜欢的手账,文具店.充满了生活气息的巷子,道路上有机车飞驰的声音.好可惜没有和你一起在台湾,以后有机会的话就请大导游带我去玩耍啦.<br><img src="../../../../img/oneYear/10.png" alt="pic10"><br><img src="../../../../img/oneYear/8.jpg" alt="pic8"><br><img src="../../../../img/oneYear/9.jpg" alt="pic9"><br>这个学期,我们又在一起啦.当然,大三是比较忙碌的,很多时间也都泡在图书馆了.暑假开始我们也就要一起考研了.总觉得你是一个特别勇敢有梦想的人,为了自己的兴趣,选择跨考.虽然也许会很难,不过我很一直陪你.在图书馆看到你沉浸在自己喜欢的书籍与作业中,也就觉得这一切也都值得.<br>最后,你有时老是会问我喜欢你的什么,那么,杜致远<br>我喜欢你坐在单车后搂住我看在我背上的动作.<br>我喜欢你吃好吃的东西,眯起眼睛的样子,还有双颊塞满食物时,嘴角露出上扬的弧线.<br>我喜欢你看着窗外跳跳发呆的侧脸.<br>我喜欢你偶尔听着我放的音乐不自禁摇摆的身体.<br>我喜欢你遇见摄像头时候摆个姿势,露出的微笑.<br>我喜欢你就算不懂也陪在旁边和我一起看球的认真.<br>我喜欢你在我问你带有选择的问题时,你习惯的说出”随你”.<br>我喜欢你悄悄为我准备的突如其来的惊喜.<br>我喜欢你不时的在我的书上或者写给我的卡片上,那些鼓励我好好学习的话语.<br>我喜欢你看自己感兴趣的书时,认真的眼神.<br>我喜欢你每天的问候”早早”与”晚安”的可爱.<br>我喜欢你在完成图形学作业之后有些癫狂的庆祝动作.<br>我喜欢你在北湖教我认那些花草树木的模样.<br>我喜欢你为我们创作的那些可爱的头像.<br>我喜欢这样的你.<br>偶尔翻起生日时你送我的32页的小本本,总有许多感动.很幸运能够遇到这样的你,一直陪伴有些幼稚愚蠢的我.也许以后还会犯错,还会遇到苦难,还得麻烦你多多照顾~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;嗨,西瓜,有你的日子过得好快,我们也在一起一年了.&lt;br&gt;
    
    </summary>
    
      <category term="YuanYuan" scheme="https://watermelon-lee.github.io/categories/YuanYuan/"/>
    
    
      <category term="letter" scheme="https://watermelon-lee.github.io/tags/letter/"/>
    
  </entry>
  
  <entry>
    <title>两小无猜||天生一对 ?</title>
    <link href="https://watermelon-lee.github.io/2018/05/14/twins/"/>
    <id>https://watermelon-lee.github.io/2018/05/14/twins/</id>
    <published>2018-05-14T00:43:10.000Z</published>
    <updated>2018-05-14T15:27:12.074Z</updated>
    
    <content type="html"><![CDATA[<p>你们看起来好像一样可爱<br><a id="more"></a></p><h1 id="Bottle"><a href="#Bottle" class="headerlink" title="Bottle"></a>Bottle</h1><p><img src="../../../../img/twins/1.jpg" alt="Bottle">  </p><h1 id="Shoes"><a href="#Shoes" class="headerlink" title="Shoes"></a>Shoes</h1><p><img src="../../../../img/twins/2.jpg" alt="Shoes"><br><img src="../../../../img/twins/4.jpg" alt="Shoes"><br><img src="../../../../img/twins/5.jpg" alt="Shoes">  </p><h1 id="Satchel"><a href="#Satchel" class="headerlink" title="Satchel"></a>Satchel</h1><p><img src="../../../../img/twins/3.jpg" alt="Satchel">  </p><h1 id="Angel"><a href="#Angel" class="headerlink" title="Angel"></a>Angel</h1><p><img src="../../../../img/twins/6.jpg" alt="Angel">  </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;你们看起来好像一样可爱&lt;br&gt;
    
    </summary>
    
      <category term="home" scheme="https://watermelon-lee.github.io/categories/home/"/>
    
    
      <category term="twins" scheme="https://watermelon-lee.github.io/tags/twins/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu命令</title>
    <link href="https://watermelon-lee.github.io/2018/05/08/Linux-instructions/"/>
    <id>https://watermelon-lee.github.io/2018/05/08/Linux-instructions/</id>
    <published>2018-05-08T12:59:22.000Z</published>
    <updated>2018-06-08T06:14:15.813Z</updated>
    
    <content type="html"><![CDATA[<p>使用系统时总有好多命令不知道,查了然后又忘了,慢慢作个总结，把每次不记得的都写在这里吧。</p><ul><li>连接服务器：ssh <a href="mailto:root@39.107.93.107" target="_blank" rel="noopener">root@39.107.93.107</a></li><li>上传文件到服务器：类似：scp -r testprojectsystem.war <a href="mailto:root@39.107.93.107" target="_blank" rel="noopener">root@39.107.93.107</a>:/opt/tomcat/webapps/</li><li>mysql执行sql文件：进入mysql    Source fileAddress</li><li>查看mysql版本:mysql -V</li><li>查看端口lsof -i:8088</li><li>杀死使用该端口的进程:kill -9 PID号</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;使用系统时总有好多命令不知道,查了然后又忘了,慢慢作个总结，把每次不记得的都写在这里吧。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;连接服务器：ssh &lt;a href=&quot;mailto:root@39.107.93.107&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ro
      
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Ubuntu" scheme="https://watermelon-lee.github.io/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>远远的作品集</title>
    <link href="https://watermelon-lee.github.io/2018/05/05/YuanYuanPortfolio1/"/>
    <id>https://watermelon-lee.github.io/2018/05/05/YuanYuanPortfolio1/</id>
    <published>2018-05-05T14:54:26.000Z</published>
    <updated>2018-05-14T01:16:16.535Z</updated>
    
    <content type="html"><![CDATA[<p>涂涂画画<br><a id="more"></a></p><h1 id="远远的课堂作业"><a href="#远远的课堂作业" class="headerlink" title="远远的课堂作业"></a>远远的课堂作业</h1><h2 id="第一次作业"><a href="#第一次作业" class="headerlink" title="第一次作业"></a>第一次作业</h2><p><img src="../../../../img/Portfolio/1.jpg" alt="pic">  </p><h2 id="第二次作业"><a href="#第二次作业" class="headerlink" title="第二次作业"></a>第二次作业</h2><p><img src="../../../../img/Portfolio/2.jpg" alt="pic"><br><img src="../../../../img/Portfolio/3.jpg" alt="pic"><br><img src="../../../../img/Portfolio/4.jpg" alt="pic"><br><img src="../../../../img/Portfolio/5.jpg" alt="pic"><br><img src="../../../../img/Portfolio/6.jpg" alt="pic">  </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;涂涂画画&lt;br&gt;
    
    </summary>
    
      <category term="YuanYuan" scheme="https://watermelon-lee.github.io/categories/YuanYuan/"/>
    
    
      <category term="Portfolio" scheme="https://watermelon-lee.github.io/tags/Portfolio/"/>
    
  </entry>
  
  <entry>
    <title>Spring-MVC</title>
    <link href="https://watermelon-lee.github.io/2018/05/02/Spring-MVC/"/>
    <id>https://watermelon-lee.github.io/2018/05/02/Spring-MVC/</id>
    <published>2018-05-02T13:32:30.000Z</published>
    <updated>2018-05-13T04:00:08.638Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h1><p>Spring MVC是围绕DispatcherServlet这个核心展开的,他负责截获请求并将其分配给相应的处理器.Spring MVC框架包括注解驱动器控制器,请求以及相应控制器,视图解析,本地化解析,上传文件解析,异常处理解析以及表单绑定等.<br><a id="more"></a></p><h2 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a>体系结构</h2><p><img src="../../../../img/Spring/SpringMVCFramework.png" alt="SpringMVC体系结构">  </p><h3 id="配置DispatcherServlet"><a href="#配置DispatcherServlet" class="headerlink" title="配置DispatcherServlet"></a>配置DispatcherServlet</h3><p>DispatcherServlet负责接受Http请求并协调Spring MVC中各个组件2完成处理1请求的工作.和任何servlet一样,DispatcherServlet也需要在web.xml文件中配置.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;context-param&gt;</span><br><span class="line">   &lt;param-name&gt;contextConfigLocation&gt;&lt;/param-name&gt;</span><br><span class="line">   &lt;param-value&gt;/WEB-INF/applicationContext.xml&lt;/param-value&gt;</span><br><span class="line"> &lt;/context-param&gt;</span><br><span class="line"> &lt;listener&gt;</span><br><span class="line">   &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</span><br><span class="line"> &lt;/listener&gt;</span><br><span class="line"></span><br><span class="line"> &lt;servlet&gt;</span><br><span class="line">   &lt;servlet-name&gt;mvc&lt;/servlet-name&gt;</span><br><span class="line">   &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">   &lt;!-- 可以自定义servlet.xml配置文件的位置和名称，默认为WEB-INF目录下，名称为[&lt;servlet-name&gt;]-servlet.xml，如spring-servlet.xml</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">      &lt;param-value&gt;/WEB-INF/spring-servlet.xml&lt;/param-value&gt;&amp;nbsp; 默认</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">  --&gt;</span><br><span class="line">   &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line"> &lt;/servlet&gt;</span><br><span class="line"> &lt;servlet-mapping&gt;</span><br><span class="line">   &lt;servlet-name&gt;mvc&lt;/servlet-name&gt;</span><br><span class="line">   &lt;!--&lt;url-pattern&gt;*.html&lt;/url-pattern&gt;--&gt;</span><br><span class="line">   &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line"> &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></p><p>通过contextConfigLocation参数指定业务层Spring配置文件(多个使用逗号,)为/WEB-INF/applicationContext.xml.使用<servlet>标签配置了DispatcherServlet,名为mvc,它默认加载/WEB-INF/mvc-servlet,可使用<init-param>来指定文件,启动web层的Spring容器.通过<servlet-mapping>指定DispatcherServlet处理所有以.html结尾的请求.</servlet-mapping></init-param></servlet></p><h3 id="简单实例"><a href="#简单实例" class="headerlink" title="简单实例"></a>简单实例</h3><p>SpringMVC应用开发一般包括一下几个步骤:</p><ul><li>配置web.xml,指定业务层对应的Spring配置文件,定义DispatcherServlet.</li><li>编写处理请求的控制器.</li><li>编写视图对象(如jsp).</li><li>配置SpringMVC配置文件,是控制器,视图解析器生效.</li></ul><h4 id="配置web-xml"><a href="#配置web-xml" class="headerlink" title="配置web.xml"></a>配置web.xml</h4><p>代码在前面贴出来了</p><h4 id="编写处理请求的控制器"><a href="#编写处理请求的控制器" class="headerlink" title="编写处理请求的控制器"></a>编写处理请求的控制器</h4><p>SpringMVC通过@Controller注解就可以将POJO转化为处理请求的控制器,通过@RequestMapping为控制器指定处理哪些请求URL请求.我们定义UserController为处理的控制器:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Controller//标记成为处理请求的控制器</span><br><span class="line">@RequestMapping(&quot;/user&quot;)//处理来自/user的uri请求</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserService userService;//业务层</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/register&quot;)</span><br><span class="line">    public String register()&#123;</span><br><span class="line">        return &quot;user/register&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>首先使用@Controller对该类进行标注,使其成为一个可以处理Http请求的控制器,使用@RequestMapping对其标注,使其处理所有所有URI为/user的请求,相对于web根目录.然后在register方法上标注@RequestMapping来确定对应的URL请求.他返回了一个字符串”user/register”,代表了一个逻辑视图名,之后将由视图解析器解析为一个具体的视图对象,/WEB-INF/views/user/register.jsp.</p><h4 id="编写视图对象"><a href="#编写视图对象" class="headerlink" title="编写视图对象"></a>编写视图对象</h4><p>使用register.jsp作为一个试图对象:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://www.springframework.org/tags&quot; %&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: watermelon</span><br><span class="line">  Date: 18-5-1</span><br><span class="line">  Time: 下午9:59</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;新增用户&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;&lt;c:url value=&quot;/user.html&quot;/&gt;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;用户名:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;userName&quot;/&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;密码:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;input name=&quot;password&quot; type=&quot;password&quot;/&gt; &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;姓名:&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;&lt;input name=&quot;realName&quot; type=&quot;text&quot;/&gt; &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td colspan=&quot;2&quot;&gt;&lt;input value=&quot;注册&quot; type=&quot;submit&quot;/&gt; &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>register.jsp包含一个表单,将数据提交到/user.html.我们在UserController中添加一个createUser()方法,来处理表单的提交:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@RequestMapping(method = RequestMethod.POST)</span><br><span class="line">public ModelAndView createUser(User user)&#123;</span><br><span class="line">    userService.createUser(user);</span><br><span class="line">    ModelAndView modelAndView=new ModelAndView();</span><br><span class="line"></span><br><span class="line">    modelAndView.setViewName(&quot;user/createSuccess&quot;);</span><br><span class="line">    modelAndView.addObject(&quot;user&quot;,user);</span><br><span class="line">    return modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>该方法处理/user.html的请求并且请求方法为post.SpringMVC自动将表单中的数据按照参数名和User属性名匹配的方式进行绑定,将参数值填充到对应的User相应的属性中.调用业务层UserService处理业务,然后将user保存在ModelAndView对象,视图名为user/createUser,user作为模型数据将暴露给试图对象.</p><p>user对象代码如下,省略get,set:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    private String userId;</span><br><span class="line">    private String userName;</span><br><span class="line">    private String password;</span><br><span class="line">    private String realName;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>User中的参数名与Register.jsp表单页面中组件名字是一致的,这样SpringMVC即可自动填充属性.<br>视图解析器将user/createUser解析为/WEB-INF/views/user/createSuccess.jsp的视图对象.createSuccess.jsp视图可以访问到模型中的数据user.createSuccess.jsp如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@ page isELIgnored=&quot;false&quot; %&gt;</span><br><span class="line">&lt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;用户创建成功&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">恭喜，用户$&#123;user13.userName&#125;创建成功，用户姓名为为$&#123;user13.userRealName&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><h4 id="配置SpringMVC的配置文件"><a href="#配置SpringMVC的配置文件" class="headerlink" title="配置SpringMVC的配置文件"></a>配置SpringMVC的配置文件</h4><p>mvc-servlet.xml:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">       xmlns:util=&quot;http://www.springframework.org/schema/util&quot; xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd http://www.springframework.org/schema/tool http://www.springframework.org/schema/tool/spring-tool.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context:component-scan base-package=&quot;com.controller&quot;/&gt;</span><br><span class="line">    &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><br><span class="line">          p:prefix=&quot;/WEB-INF/views/&quot;</span><br><span class="line">          p:suffix=&quot;.jsp&quot;/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p><p>通过 &lt;context:component-scan base-package=”com.controller”/&gt; 扫描com.controller中的的所有类,对于标注了Spring标记的类生效.然后定义了一个视图解析器,将视图名解析为/WEB-INF/views/<viewname>.jsp的视图对象.</viewname></p><h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>将应用部署到web服务器中,输入localhost:/8088/mvc/user/register.html既可以访问注册页面,填写信息提交到localhost:8088/mvc/user.html,UserController控制器中的createUser()方法响应该请求,并导向createSuccess.jsp页面.<br>SpringMVC处理请求的过程如下图:<br><img src="../../../../img/Spring/SpringMVCHandle.png" alt="SpringMVC请求处理过程">  </p><ul><li>web应用服务器接收到一个新请求是，如果匹配DispatcherServlet的请求映射路径，web容器将该请求转发给DispatcherServlet进行处理</li><li>DispatcherServlet接收到请求后，将根据请求的信息及HandlerMapping的配置找到处理请求的处理器（Handler）</li><li>当DispatcherServlet根据HandlerMapping得到对应当前请求的Handler后，通过HandlerAdapter对Handler进行封装，以统一的适配器接口调用Handler</li><li>处理器完成业务逻辑的处理后将返回一个ModelAndView给DispatcherServlet，ModelAndView包含了视图逻辑名和模型数据信息</li><li>ModelAndView中包含的是“逻辑视图名”，而非真正的视图对象，DispatcherServlet借助ViewResolver完成逻辑视图名到真实视图名对象的解析工作</li><li>当得到真实的视图对象View后，DispatcherServlet就使用这个View对象对ModelAndView中的模型数据进行视图渲染</li><li>最终客户端得到的可能是HTML页面或者其他对象</li></ul><h2 id="注解驱动的控制器"><a href="#注解驱动的控制器" class="headerlink" title="注解驱动的控制器"></a>注解驱动的控制器</h2><h3 id="使用-RequestMapping映射请求"><a href="#使用-RequestMapping映射请求" class="headerlink" title="使用@RequestMapping映射请求"></a>使用@RequestMapping映射请求</h3><p>在POJO类定义出标记@Controller,在通过<a href="context:component-scan/" target="_blank" rel="noopener">context:component-scan/</a>扫描对应的类包,即可以使POJO类成为一个能处理HTTP请求的控制器.<br>在控制器的类定义以及方法定义处都可以标注@RequestMapping,类的定义处提供初步请求映射信息,类方法处提供详细的映射信息.DispatcherServlet截获请求后,通过控制器上的@RequestMapping提供的映射信息确定所对应的处理方法.总共包括4中映射关系,URL,请求参数,请求方法,请求头.<br>@RequestMapping使用value/path指定请求的URL,如@RequestMapping(“/user”),需要注意,@RequestMapping在类定义处指定的URL是相对于Web应用部署的路径.<br>除此之外,还可以使用请求方法,请求头参数,以及请求参数:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.POST, params = &quot;userId&quot;)</span><br><span class="line">public String test1(@RequestParam(&quot;userId&quot;) String userId) &#123;</span><br><span class="line">// do sth</span><br><span class="line">return &quot;user/test1&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/show&quot;, headers = &quot;content-type=text/*&quot;)</span><br><span class="line">public String test2(@RequestParam(&quot;userId&quot;) String userId) &#123;</span><br><span class="line">// do sth</span><br><span class="line">return &quot;user/test2&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>@RequestMapping的path,method,params以及headers分别表示请求的URL,请求方法,请求参数,报文头的映射条件,他们之间是与的关系.<br>params与headers支持简单的映射表达式,以params为说明,headers类似:</p><ul><li>params=”param1”表示请求必须包含名为param1的请求参数.</li><li>!param1表示请求不能包含名为param1的请求参数</li><li>“param1!=value1”包含名为param1的请求参数,但是其值不能value1</li><li>{“param1=value1”,”param2”}请求必须包含名为param1和param2的请求参数,且param1的值必须为value1</li></ul><h3 id="请求处理方法签名"><a href="#请求处理方法签名" class="headerlink" title="请求处理方法签名"></a>请求处理方法签名</h3><p>Spring MVC可以使用@RequestParam来绑定请求参数值,@CookieValue绑定请求中的cookie值,使用@RequestHeader绑定请求报文头的属性,使用表单对象绑定请求参数.</p><h4 id="使用-RequestParam来绑定请求参数值"><a href="#使用-RequestParam来绑定请求参数值" class="headerlink" title="使用@RequestParam来绑定请求参数值"></a>使用@RequestParam来绑定请求参数值</h4><p>@RequestParam有三个参数</p><ul><li>value:参数名</li><li>required:是否必须,默认为true,表示请求中必须包含有对应的参数名.如果不存在,抛出异常.</li><li>defaultValue:默认参数名.不推荐使用<br>例如:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/handle11&quot;)</span><br><span class="line">public String handle11(</span><br><span class="line">@RequestParam(value = &quot;userName&quot;, required = false) String userName,</span><br><span class="line">@RequestParam(&quot;age&quot;) int age) &#123;</span><br><span class="line">return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>上面的例子将userName和age的请求参数绑定到了handle11方法的参数上,并且自动完成类型转换.如果不存在age参数,抛出异常.</p><h3 id="使用表单-命令对象绑定请求参数"><a href="#使用表单-命令对象绑定请求参数" class="headerlink" title="使用表单/命令对象绑定请求参数"></a>使用表单/命令对象绑定请求参数</h3><p>使用命令/表单对象不需要实现任何接口,只需要一个包含若干属性的POJO.SpringMVC会按照请求参数名和表单对象属性名匹配的方式,自动为该对象填充属性.</p><h3 id="处理数据模型"><a href="#处理数据模型" class="headerlink" title="处理数据模型"></a>处理数据模型</h3><p>将数据模型暴露给视图是SpringMVC框架的重要工作,SPringMVC提供了多种输出模型数据:</p><ul><li>ModelAndView:当处理方法返回值为ModelAndView,方法体即可用该对象添加数据模型</li><li>@ModelAttribute:在方法的入参处标记该注解,入参的对象就会自动放到数据模型中.</li><li>Map和Model:方法入参为import org.springframework.ui.ModelMap或者java.util.Map,返回时,Map中的数据自动添加到模型中.</li><li>@SessionAttributes:将模型中的某个属性存到HttpSession中,以便多个请求键可以共享该属性</li></ul><h4 id="ModelAndView"><a href="#ModelAndView" class="headerlink" title="ModelAndView"></a>ModelAndView</h4><p>控制器处理的方法如果返回值为ModelAndView,则既包含了视图信息,又包含了数据模型信息,这样SpringMVC就可以对视图进行渲染.ModelAndView类似于一个Map&lt;String,Object&gt;对象.其包含的方法有:</p><ul><li>ModelAndView addObject(String attributeName,Object attributeValue)</li><li>ModelAndView addAllObjects(Map&lt;String,?&gt;modeMap)</li><li>void setView(View view):指定一个视图对象</li><li>void setViewName(String viewName):指定一个逻辑视图名</li></ul><h4 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a>@ModelAttribute</h4><p>如果希望将方法的入参对象添加到模型当中,只需要在入参前面添加@ModeAttribute注解.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/handle61&quot;)</span><br><span class="line">public String handle61(@ModelAttribute(&quot;user&quot;) User user) &#123;</span><br><span class="line">user.setUserId(&quot;1000&quot;);</span><br><span class="line">return &quot;/user/createSuccess&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>SpringMVC将请求消息绑定到User对象,在以user为键将User对象放到模型上.在对视图进行渲染前,SPringMVC还会进一步将模型中的数据转存到视图上下文,并且暴露给视图.<br>此外,还可以在方法的定义中使用@ModelAttribute注解.SpringMVC在调用目标方法前,<em>会先逐个调用在方法级别上标注了@ModelAttribute注解的方法,并将这些方法的返回值添加到模型中</em>.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@ModelAttribute(&quot;user&quot;)</span><br><span class="line">public User getUser() &#123;</span><br><span class="line">User user = new User();</span><br><span class="line">user.setUserId(&quot;1001&quot;);</span><br><span class="line">user.setUserName(&quot;&lt;&gt;&quot;);</span><br><span class="line">return user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/handle62&quot;)</span><br><span class="line">public String handle62(@ModelAttribute(&quot;user&quot;) User user) &#123;</span><br><span class="line">user.setUserName(&quot;tom&quot;);</span><br><span class="line">return &quot;/user/showUser&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>SpringMVC在访问任何UserController中的方法前,先执行标注了@ModelAttribute的方法gerUser(),并将其返回值以user为键,添加到模型中.<br>而在handle12方法中使用了键值为user的模型数据,所以SpringMVC会将模型中的属性值赋给入参user,然后在根据Http请求消息对user进行填充覆盖,得到一个整合版的user.</p><h4 id="Model和Map"><a href="#Model和Map" class="headerlink" title="Model和Map"></a>Model和Map</h4><p>SpringMVC在调用方法前会创造一个隐含的模型对象,作为模型数据的存储容器,称为”隐含模型”.如果处理方法入参为Model或者Map,SpringMVC会自动将隐含模型传递给这些入参.在方法体内,可以通过这个入参对象访问到模型的所有对象,也可以像模型中添加新的数据.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/handle63&quot;)</span><br><span class="line">public String handle63(ModelMap modelMap) &#123;</span><br><span class="line">User user = (User) modelMap.get(&quot;user&quot;);</span><br><span class="line">user.setUserName(&quot;tom&quot;);</span><br><span class="line">modelMap.addAttribute(&quot;testAttr&quot;, &quot;value1&quot;);</span><br><span class="line">return &quot;/user/showUser&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a>@SessionAttributes</h4><p>如果希望在多个模型中公用一个数据模型,则可以在控制器内标注一个@SessionAttributes,SpringMVC会将模型中对应的属性暂存到HttpSession中.但是在使用时需要添加一个标注@ModelAttribute(“xxx”)的方法,像隐含对象中添加一个xxx属性.否则抛出HttpSessionRequiredException异常.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Controller</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">@SessionAttributes(value=&quot;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">@ModelAttribute(&quot;user&quot;)//需要添加该方法,先向隐含模型中添加user属性,否则报错.</span><br><span class="line">public User getUser() &#123;</span><br><span class="line">User user = new User();</span><br><span class="line">user.setUserId(&quot;1001&quot;);</span><br><span class="line">user.setUserName(&quot;&lt;&gt;&quot;);</span><br><span class="line">return user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/handle71&quot;)</span><br><span class="line">public String handle71(@ModelAttribute(&quot;user&quot;) User user) &#123;</span><br><span class="line">user.setUserName(&quot;John&quot;);</span><br><span class="line">return &quot;redirect:handle72.html&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/handle72&quot;)</span><br><span class="line">public String handle72(ModelMap modelMap, SessionStatus sessionStatus) &#123;</span><br><span class="line">User user = (User) modelMap.get(&quot;user&quot;);</span><br><span class="line">if (user != null) &#123;</span><br><span class="line">user.setUserName(&quot;Jetty&quot;);</span><br><span class="line">sessionStatus.setComplete();</span><br><span class="line">&#125;</span><br><span class="line">return &quot;/user/showUser&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>探究一下报错的原理:<br>因为SpringMVC在对@ModelAttribute和@SessionAttributes处理有一个特定的流程:</p><ul><li>SPringMVC在调用处理方法前,在请求线程中自动创建一个隐含的模型对象</li><li>调用所有标志了@ModelAttribute的方法,将方法的返回值添加到隐含模型中</li><li>查看Session中是否有@SessionAttributes(“xxx”)所指定的xxx属性,若有,将其添加到隐含模型中.如果隐含模型已经有了该属性,则会覆盖该属性.</li><li>对标注了@ModelAttribute(“xxx)”处理方法的入参会按照如下处理流程:<br>  1.如果隐含模型中有名为xx的属性,则将其赋值给该入参,再用请求消息填充该入参对象直接返回,否侧下一步<br>  2.如果xxx是会话属性,即在类定义处标记了@SessionAttributes(“xxx”),则会从回话中获取该属性,将其赋值给入参,然后再用请求消息填充该入参.如果在会话中找不到,抛出异常HttpSessionRequiredException.否则转下一步<br>  3.如果在隐含模型中不存在xxx属性,xxx也不是会话属性,则创建入参对象的实例,然后在用请求消息填充.<br>因为我们对user标注了@SessionAttributes,而在隐含模型和Session中均无该属性,则会抛出异常.<br>所以我们只需要添加一个标注了@ModelAttribute(“user”)的方法,让其在隐含模型中添加user属性即可.<br>@SessionAttributes除了可以使用value指定属性名外,还可以使用types指定模型属性对象类型,两者联合使用为并集关系,可以指定多个属性或类型,中间用逗号隔开:</li><li>@SessionAttributes(types=”User.class):将所有User类型的属性添加到会话中</li><li>@SessionAttributes(value={“user1”,”user2”}, types=”Dept.class”):将名为user1,user2的模型属性添加到会话中,将所有类为Dept的模型属性添加到会话中</li></ul><h2 id="处理方法的数据绑定"><a href="#处理方法的数据绑定" class="headerlink" title="处理方法的数据绑定"></a>处理方法的数据绑定</h2><h3 id="数据绑定流程"><a href="#数据绑定流程" class="headerlink" title="数据绑定流程"></a>数据绑定流程</h3><p><img src="../../../../img/Spring/DataBinding.png" alt="数据绑定">  </p><p>数据绑定的核心部件是DataBinder，SpringMVC将ServletRequest对象以及处理方法的入参对象实例传递给DataBinder，DataBinder首先调用装配在Spring Web上下文中的ConversionService组件进行数据类型转换，数据格式转换等工作，将ServletRequest中的消息填充到对象，然后调用Validator组件对已经绑定的请求消息数据的入参进行合法性检验，最后生成的数据绑定BindingResult对象。BindingResultSet对象包含了完成数据绑定的入参对象，还包含相应的校验错误的对象。SpringMVC抽取BindingResult中的入参对象以及校验错误对象，将他们赋给处理方法的相应入参。</p><h3 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h3><p>Spring在核心模块添加了通用转换类型模块，位于org.springframework.core.convert包中.  </p><h4 id="ConversionService"><a href="#ConversionService" class="headerlink" title="ConversionService"></a>ConversionService</h4><p>ConversionService是Spring类型转化体系的核心接口,定义了以下4种方法.</p><ul><li>boolean canConvert(Class&lt;?&gt;sourceType,Class&lt;?&gt;targetType):判断是否可以将一个Java类转换为另一个Java类.</li><li>Boolean canConvert(TypeDescriptor sourceType,TypeDescriptor targetType):转换的类将以成员变量的方式出现在宿主类中.</li><li><t> T convert(Object source,Class<t> targetType):将原类型对象转化为目标类对象.</t></t></li><li>Object convert(Object source,TypeDescriptor sourceType,TypeDescriptor targetType):将原类型转换为目标类型,此时往往会用到所在宿主类的上下文信息.<br>可以利用org.springframework.context.support.ConversionServiceFactoryBean在Spring的上下文中定义一个ConversionService.可如下配置:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;/&gt;</span><br></pre></td></tr></table></figure></li></ul><p>该Factory穿件的ConverSionService内部已经包含了许多转换器,可以完成大部分类型的JAVA类转换.如果需要使用的自己的转换器,可以通过ConversionServiceFactory的converts属性注册自定义转换器.代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!--使用自定义转换器--&gt;</span><br><span class="line">&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.ConversionServiceFactoryBean&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;converters&quot;&gt;</span><br><span class="line">        &lt;list&gt;</span><br><span class="line">            &lt;bean class=&quot;com.domain.StringToUserConverter1&quot;/&gt;</span><br><span class="line">            &lt;bean class=&quot;com.domain.StringToUserConverter2&quot;/&gt;</span><br><span class="line">        &lt;/list&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure></p><h4 id="在SpringMVC中使用ConversionService"><a href="#在SpringMVC中使用ConversionService" class="headerlink" title="在SpringMVC中使用ConversionService"></a>在SpringMVC中使用ConversionService</h4><p>我们在处理User类型的入参时,希望将请求参数中格式为<username>:<password>:<realname>的字符串转换为user对象.这时我们需要自定义一个负责将String转为User对象的自定义转化器,需要实现Converter&lt;S,T&gt;接口:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line">public class StringToUserConverter implements Converter&lt;String,User&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public User convert(String s) &#123;</span><br><span class="line">        User user=new User();</span><br><span class="line">        if(s!=null)&#123;</span><br><span class="line">            String[] items=s.split(&quot;:&quot;);//将&lt;UserName&gt;:&lt;password&gt;:&lt;realName&gt;格式的串转为User对象</span><br><span class="line">            user.setUserName(items[0]);</span><br><span class="line">            user.setPassword(items[1]);</span><br><span class="line">            user.setRealName(items[2]);</span><br><span class="line">        &#125;</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></realname></password></username></p><p>然后,我们将其安装到Spring上下文中,如下所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:annotation-driven  conversion-service=&quot;conversionService&quot;/&gt;</span><br><span class="line"></span><br><span class="line">     &lt;!--使用自定义转换器--&gt;</span><br><span class="line">    &lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.ConversionServiceFactoryBean&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;converters&quot;&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;bean class=&quot;com.domain.StringToUserConverter&quot;/&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure></p><p>使用mvc命名空间&lt;mvc:annotation-driven /&gt;可以简化配置.默认创造一个DefaultAnnotationHandlerMapping和一个RequestMappingHandlerAdapter实例.此外,&lt;mvc:annotation-driven /&gt;标签还会注册一个默认的ConversionService,即FormattingConversionServiceFactoryBean,以满足大部分的转换需求.而我们自定义转换类时,则需要自己显示定义一个ConversionService覆盖其中的默认实现.通过设置其的conversion-service来实现.<br>装配好StringToUserConvert之后,就可以在控制器中使用该方法了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//自定义了StringToUserConverter转换器,则可以会自动处理请求如</span><br><span class="line">  // localhost://8080/mvc/user/handle12.html?user=tom:123456:jack</span><br><span class="line">  // @RequestParam自动将请求中的user绑定到函数参数中的user上</span><br><span class="line">  @RequestMapping(&quot;/handle12&quot;)</span><br><span class="line">  public String handle12(@RequestParam(&quot;user&quot;)User user,ModelMap modelMap)&#123;</span><br><span class="line">      modelMap.put(&quot;user&quot;,user);</span><br><span class="line">      return &quot;/user/showUser&quot;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h3 id="数据格式化"><a href="#数据格式化" class="headerlink" title="数据格式化"></a>数据格式化</h3><p>Spring使用转换器进行了原类到目标类的转换,但是并没有提供输入输出信息的格式化工作.例如,从客户端传来的数据,像日期,时间,数字,货币都有固定的格式.Spring使用了一个格式化框架,位于org.springframework.format包中.在Spring中使用FormattingConversionServiceFactoryBean,通过该工厂类,也可以实现自定义转换器,所以我们只需要在配置文件中修改一下,将ConversionServiceFactoryBean替换为FormattingConversionService类即可.此外 <a href="mvc:annotation-driven/" target="_blank" rel="noopener">mvc:annotation-driven/</a> 默认创建的ConversionService的实例就是FormattingConversionService.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> &lt;!--使用自定义转换器,将ConversionService换位FormattingConversionService--&gt;</span><br><span class="line">&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;converters&quot;&gt;</span><br><span class="line">        &lt;list&gt;</span><br><span class="line">            &lt;bean class=&quot;com.domain.StringToUserConverter&quot;/&gt;</span><br><span class="line">        &lt;/list&gt;</span><br><span class="line">    &lt;/property&gt;</span><br></pre></td></tr></table></figure></p><p>人后就可以使用注解驱动格式化实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class User&#123;</span><br><span class="line">    @DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)//将类似1997-11-15的字符串转化到Date类型的birthday中.</span><br><span class="line">    private Date birthday;</span><br><span class="line"></span><br><span class="line">    @NumberFormat(style= NumberFormat.Style.NUMBER,pattern = &quot;#,###&quot;)// 将类似4,512的字符串转化到int类型的salary中</span><br><span class="line">    private int salary;</span><br><span class="line">    .......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p> @DateTimeFormat 注解有3个互斥可选的属性：style，pattern和iso。属性style允许我们使用两个字符的字符串来表明怎样格式化日期和时间。第一个字符表明了日期的格式，第二个字符表明了时间的格式。下面的表格中列出了可用的选择以及相应的输出的例子：</p><ul><li>短格式（这是缺省值）     SS        8/30/64 11:24 AM</li><li>中等格式     MM       Aug 30,1964 11:24:41 AM</li><li>长格式     LL     August 30,1964 11:24:41 AM CDT</li><li>完整格式     FF       Sunday, August 30,1964 11:24:41 AM CDT</li><li>使用短横线省略日期或时间     M-     Aug 30,1964</li></ul><p>Pattern 属性允许我们使用自定义的日期/时间格式。该属性的值遵循java标准的date/time格式规范。缺省的该属性的值为空，也就是不进行特殊的格式化。如果需要带上时分秒pattern的值就是yyyy-MM-dd HH:mm:ss 这种格式  </p><p>最后，可以使用org.springframework.format.annotation.DateTimeFormat.ISO枚举值来使用ISO标准的日期/时间格式来格式化:</p><ul><li>DateTimeFormat.ISO.DATE       2000-10-31</li><li>DateTimeFormat.ISO.TIME       01:30:00.000-05:00（最后的是时区)</li><li>DateTimeFormat.ISO.DATE_TIME     2000-10-31 01:30:00.000-05:00.</li><li>DateTimeFormat.ISO.NONE     不进行ISO标准的格式化<br>类似@DateTimeFormat(iso = DateTimeFormat.ISO.DATE)</li></ul><h3 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h3><p>在业务逻辑执行前,必须保证数据是合法的,比如时间必须是过去的,工资必须是正数等.</p><h4 id="JSR-303注解"><a href="#JSR-303注解" class="headerlink" title="JSR-303注解"></a>JSR-303注解</h4><p>JSR-303通过在Bean属性上标注类似@NotNull的注解来对Bean进行校验.所有注释如下:  </p><ul><li>@Null    被注释的元素必须为 null</li><li>@NotNull    被注释的元素必须不为 null</li><li>@AssertTrue    被注释的元素必须为 true</li><li>@AssertFalse    被注释的元素必须为 false</li><li>@Min(value)    被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li><li>@Max(value)    被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li><li>@DecimalMin(value)    被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li><li>@DecimalMax(value)    被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li><li>@Size(max, min)    被注释的元素的大小必须在指定的范围内</li><li>@Digits (integer, fraction)    被注释的元素必须是一个数字，其值必须在可接受的范围内</li><li>@Past    被注释的元素必须是一个过去的日期</li><li>@Future    被注释的元素必须是一个将来的日期</li><li>@Pattern(value)    被注释的元素必须符合指定的正则表达式<br>Hibernate Validator也实现了JSR-303,并且还扩展了注解:  </li><li>@Email    被注释的元素必须是电子邮箱地址</li><li>@Length    被注释的字符串的大小必须在指定的范围内</li><li>@NotEmpty    被注释的字符串的必须非空</li><li>@Range    被注释的元素必须在合适的范围内</li></ul><h4 id="Spring校验框架"><a href="#Spring校验框架" class="headerlink" title="Spring校验框架"></a>Spring校验框架</h4><p>Spring通过DataBinder在进行数据绑定的同时,调用校验框架完成数据校验工作.SpringMVC中,可以直接通过注解驱动的方式进行数据校验.<br>Spring的org.springframework.validation是框架校验包的所在.LocalValidatorFactoryBean既实现了Spring的Validator接口,有实现的JSR-303的Validator的接口.需要在Spring中定义一个LocalValidatorFactoryBean.代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;validator&quot; class=&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;&gt;</span><br></pre></td></tr></table></figure></p><h4 id="SpringMVC的数据校验"><a href="#SpringMVC的数据校验" class="headerlink" title="SpringMVC的数据校验"></a>SpringMVC的数据校验</h4><p> &lt;mvc:annotation-driven /&gt; 会默认装配一个LocalValidatorFactoryBean,通过在处理入参的方法上标注@Valid注解,就可以让SpringMVC在完成数据绑定之后执行数据校验.<br>代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    private String userId;</span><br><span class="line"></span><br><span class="line">     //@Pattern(regexp = &quot;w&#123;4,30&#125;&quot;)//通过正则表达式校验,匹配4-30个班含数字,字母,下划线的字符</span><br><span class="line">    @Size(min = 6, max = 12, message = &quot;姓名必须大于6个字符，小于13个字符！&quot;)</span><br><span class="line">    private String userName;</span><br><span class="line"></span><br><span class="line">    @Size(min = 6, max = 16, message = &quot;密码必须大于6个字符，小于17个字符！&quot;)</span><br><span class="line">    //@Pattern(regexp = &quot;S&#123;6,30&#125;&quot;)//通过正则表达式校验,匹配6-30个非空字符</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    @Length(min = 2,max = 100)</span><br><span class="line">    private String realName;</span><br><span class="line"></span><br><span class="line">    @Past//表示时间值必须在过去</span><br><span class="line">    //@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span><br><span class="line">    @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)</span><br><span class="line">    private Date birthday;</span><br><span class="line"></span><br><span class="line">    @DecimalMin(value = &quot;1000&quot;)</span><br><span class="line">    @DecimalMax(value = &quot;10000&quot;)</span><br><span class="line">    @NumberFormat(style= NumberFormat.Style.NUMBER,pattern = &quot;#,###&quot;)</span><br><span class="line">    private int salary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在user类属性上标注了校验注解之后,我们可以在UserController中添加一个处理方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/handle13&quot;)</span><br><span class="line">    public String handle13(@Valid @ModelAttribute(&quot;user13&quot;)User user, BindingResult bindingResult)&#123;</span><br><span class="line">        if (bindingResult.hasErrors())&#123;//判断是否有错误</span><br><span class="line">            return &quot;/user/register3&quot;;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            return &quot;user/createSuccess&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/register3&quot;)</span><br><span class="line">    public String register3() &#123;</span><br><span class="line">//        User user=new User();//用于转换到form表单</span><br><span class="line">//        new ModelAndView(&quot;user13&quot;).addObject(user);</span><br><span class="line">        return &quot;/user/register3&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>在标注了JSR-303注解的表单/命令对象前标注一个@Valid,SpringMVC框架将在请求数据绑定到该入参之后,就会调用校验框架根据注解声明的校验规则进行校验.前一个表单/命令对象的结果保存在其后的入参中,这个保存校验结果的入参必须为BindResult或Errors类型.这两个都位于org.springframework.validation中.所以,需要校验的表单/命令对象和其绑定的结果对象或者错误对象是成对出现的,他们之间不予许出现其他的入参.</p><h4 id="获取校验结果"><a href="#获取校验结果" class="headerlink" title="获取校验结果"></a>获取校验结果</h4><p>在表单/命令对象类的属性上标注了校验注解之后,在处理方法对应的入参前面添加@Valid注解,SpringMVC就会走动实施校验并且将结果保存在被校验对象入参之后的BindingResult或Errors入参中.<br>BindingResult与Errors常用方法:</p><ul><li>boolean hasErrors():是都有校验错误</li><li>FieldError getFieldError(String Field):根据属性名获取对应的校验错误</li><li>List<fielderror>getFieldErrors:获取所有属性的校验错误</fielderror></li><li>Object getFieldValue(String field):获取属性值</li><li>int getErrorCount():获取错误数量</li></ul><h4 id="在页面中显式错误"><a href="#在页面中显式错误" class="headerlink" title="在页面中显式错误"></a>在页面中显式错误</h4><p>SpringMVC除了将错误保存到了BindingResult或Errors,还将所有对象保存到了隐含模型中,所以,他们始终可以在隐含模型中获取.隐含模型总的数据最后将通过HttpServletRequest的属性暴露给JSP视图.<br>首先,对SpringMVC从输出.输入层进行分析:<br><img src="../../../../img/Spring/SpringMVCDataFlowDiagram.png" alt="SpringMVCDataFlowDiagram">  </p><ol><li>Http报文到达Web服务器,Web服务器将其封装成为一个HttpServletRequest对象.</li><li>SpringMVC框架截获这个HttpServletRequest对象</li><li>SpringMVC创造一个隐含模型对象,作为处理本次请求的上下文数据存放处.</li><li>SpringMVC将HttpServletRequest对象数据绑定到处理方法入参对象中(表单/命令对象)</li><li>将错误信息绑定到隐含模型</li><li>将本次请求对象的隐含信息放到HttpServletRequest属性列表,将其暴露给视图对象</li><li>视图对象将已经存放在HttpServletRequest属性列表中的数据模型进行渲染</li><li>将渲染后的Http响应报文发送到客户端</li></ol><p>在JSP页面中可以使用Spring标签&lt;form:errors path=”propName”/&gt;显示错误信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: watermelon</span><br><span class="line">  Date: 18-5-4</span><br><span class="line">  Time: 下午8:15</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line">&lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;</span><br><span class="line">&lt;%@ taglib prefix=&quot;c&quot;      uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br><span class="line">&lt;%@ taglib prefix=&quot;fmt&quot;  uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; %&gt;</span><br><span class="line">&lt;jsp:useBean id=&quot;user13&quot; class=&quot;com.domain.User&quot; scope=&quot;request&quot;/&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;新增用户&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .errorClass&#123;color:red&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form:form modelAttribute=&quot;user13&quot;  action=&quot;/mvc/user/handle13.html&quot;&gt;</span><br><span class="line">    &lt;form:errors path=&quot;*&quot; cssClass=&quot;errorClass&quot; element=&quot;div&quot;/&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;用户名：&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;form:errors path=&quot;userName&quot; cssClass=&quot;errorClass&quot; element=&quot;div&quot;/&gt;</span><br><span class="line">                &lt;form:input path=&quot;userName&quot;  /&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;密码：&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;form:errors path=&quot;password&quot; cssClass=&quot;errorClass&quot;  element=&quot;div&quot;/&gt;</span><br><span class="line">                &lt;form:password path=&quot;password&quot; /&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;姓名：&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;form:errors  path=&quot;realName&quot; cssClass=&quot;errorClass&quot; element=&quot;div&quot;/&gt;</span><br><span class="line">                &lt;form:input path=&quot;realName&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;生日：&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;form:errors path=&quot;birthday&quot; cssClass=&quot;errorClass&quot; element=&quot;div&quot;/&gt;</span><br><span class="line">                &lt;form:input path=&quot;birthday&quot; /&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;工资：&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;form:errors path=&quot;salary&quot; cssClass=&quot;errorClass&quot; element=&quot;div&quot;/&gt;</span><br><span class="line">                &lt;form:input path=&quot;salary&quot; /&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=&quot;2&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;提交&quot;/&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/form:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>通过&lt;form:errors path=”*”/&gt;在顶部显示全部校验错误信息.使用&lt;form:errors path=”propName”/&gt;显示某个属性的检验错误信息.<br>需要注意的是,使用&lt;form:form modelAttribute=”user13”  action=”/mvc/user/handle13.html”&gt;,我们会从模型中调用user13属性.但是一开始报错Neither BindingResult nor plain target object for bean name ‘user13’ available as request attribute.查看博客后发现Spring:form标签源码是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object target = requestContext.getModelObject(beanName);</span><br><span class="line">if (target == null) &#123;</span><br><span class="line">throw new IllegalStateException(&quot;Neither BindingResult nor plain target object for bean name &apos;&quot; +</span><br><span class="line">beanName + &quot;&apos; available as request attribute&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>我直接对register3.html页面请求,此时,模型中没有user13属性,那么则会抛出异常.<br>所以,需要在页面上加入&lt;jsp:useBean id=”user13” class=”com.domain.User” scope=”request”/&gt;.<br><a href="jsp:userbean" target="_blank" rel="noopener">jsp:userbean</a>的执行原理是:”首先在指定的域范围内查找指定名称的JavaBean对象，如果存在则直接返回该JavaBean对象的引用，如果不存在则实例化一个新的JavaBean对象并将它以指定的名称存储到指定的域范围中。所以模型中会添加user13属性,则消除报错.</p><h2 id="视图与试图解析器"><a href="#视图与试图解析器" class="headerlink" title="视图与试图解析器"></a>视图与试图解析器</h2><p>请求处理方法在执行完成后,最后会返回一个ModelAndView对象.对弈那些返回String,View,ModelMap的处理方法,SpringMVC也会将他们包装成为一个ModelAndView对象,该对象包含了视图逻辑名和模型对象信息.SpringMVC借助视图解析器(ViewResolver)来得到最终的视图对象(View),这可能是我们常见的JSP视图,还可以是PDF,Excel,XML,JSON等等各种形式的视图.</p><h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>视图的作用是渲染数据模型,将模型里的数据以不同的方式呈现给用户.常见技术有JSP,还有Excel,PDF等等.<br>试图对象是一个Bean,通常情况下,视图对象是一个Bean.对于不同类型的视图,有不同的View实现类:<br><img src="../../../../img/Spring/SpringMVCView.png" alt="SpringMVCView">  </p><h3 id="视图解析器"><a href="#视图解析器" class="headerlink" title="视图解析器"></a>视图解析器</h3><p>SpringMVC中为逻辑视图名的解析提供了不同的策略,可以在SpringWeb上下文中配置一种或者多种不同的策略,并且指定他们的先后策略.<br><img src="../../../../img/Spring/SpringMVCViewResolver.png" alt="SpringMVCViewResolver"><br>用户可以选择一种或多种视图解析器,每一个解析器都有一个orderNo属性,可以用来指定优先级,数值越小优先级越大.<strong>SpringMVC会按照给定优先级的顺序使用视图解析器对视图进行解析,直到解析成功返回试图对象,否侧抛出ServletException</strong>.</p><h3 id="Spring表单标签"><a href="#Spring表单标签" class="headerlink" title="Spring表单标签"></a>Spring表单标签</h3><p>自己有时间看看,记一下</p><h3 id="输出Excel"><a href="#输出Excel" class="headerlink" title="输出Excel"></a>输出Excel</h3><p>输出Excel,需要扩展Spring的AbstractorXlsView,实现buildExcelDocument90方法,在方法中使用数据模型构建Excel文档.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class UserListExcelView extends AbstractXlsView&#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void buildExcelDocument(Map&lt;String, Object&gt; map, Workbook workbook, HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception &#123;</span><br><span class="line">        httpServletResponse.setHeader(&quot;Content-Disposition&quot;,&quot;attachment;filename=&quot;+new String(&quot;用户列表.xls&quot;.getBytes(),&quot;iso8859-1&quot;));//excel文档编码必须为iso-8859-1,否则乱码.attachment表示使用附件下载</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; users=(List&lt;User&gt;)map.get(&quot;userList&quot;);</span><br><span class="line">        HSSFSheet sheet=(HSSFSheet)workbook.createSheet(&quot;users&quot;);</span><br><span class="line">        HSSFRow hssfRow=sheet.createRow(0);</span><br><span class="line">        hssfRow.createCell(0).setCellValue(&quot;账号&quot;);</span><br><span class="line">        hssfRow.createCell(1).setCellValue(&quot;姓名&quot;);</span><br><span class="line">        hssfRow.createCell(2).setCellValue(&quot;生日&quot;);</span><br><span class="line"></span><br><span class="line">        int rowNum=1;</span><br><span class="line">        for (User user:users)&#123;</span><br><span class="line">            HSSFRow row=sheet.createRow(rowNum++);</span><br><span class="line">            row.createCell(0).setCellValue(user.getUserName());</span><br><span class="line">            row.createCell(1).setCellValue(user.getRealName());</span><br><span class="line">            String createDate= DateFormatUtils.format(user.getBirthday(),&quot;yyyy-MM-dd&quot;);</span><br><span class="line">            row.createCell(2).setCellValue(createDate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在mvc-servlet.xml文件中添加配置:<br>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输出excel--&gt;</span><br><span class="line">   &lt;bean class=&quot;org.springframework.web.servlet.view.BeanNameViewResolver&quot; p:order=&quot;10&quot;/&gt;</span><br><span class="line">   &lt;bean id=&quot;userListExcel&quot; class=&quot;com.controller.UserListExcelView&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>由于我们使得UserListExcelView代表的Excel视图对象是一个Bean,所以我们使用BeanNameViewResolver作为视图解析器.<br>在UserController中添加相应处理请求的方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/showUserListByXls&quot;)</span><br><span class="line">    public String showUserListInExcel(ModelMap mm) &#123;</span><br><span class="line">        Calendar calendar = new GregorianCalendar();</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; userList = new ArrayList&lt;User&gt;();</span><br><span class="line">        User user1 = new User();</span><br><span class="line">        user1.setUserName(&quot;tom&quot;);</span><br><span class="line">        user1.setRealName(&quot;汤姆&quot;);</span><br><span class="line">        calendar.set(1980, 1, 1);</span><br><span class="line">        user1.setBirthday(calendar.getTime());</span><br><span class="line">        User user2 = new User();</span><br><span class="line">        user2.setUserName(&quot;john&quot;);</span><br><span class="line">        user2.setRealName(&quot;约翰&quot;);</span><br><span class="line">        user2.setBirthday(calendar.getTime());</span><br><span class="line">        userList.add(user1);</span><br><span class="line">        userList.add(user2);</span><br><span class="line">        mm.addAttribute(&quot;userList&quot;, userList);</span><br><span class="line">        return &quot;userListExcel&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h3 id="输出JSON"><a href="#输出JSON" class="headerlink" title="输出JSON"></a>输出JSON</h3><p>SpringMVC的MappingJackson2JsonView借助jackson框架的ObjectMapper将数据模型转化为JSON格式输出.由于MappingJackson2JsonView也是一个Bean,所以可以使用BeanNameViewResolver进行解析,只需直接在配置文件配置即可:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输出json  用modekey指定输出模型中的哪些属性--&gt;</span><br><span class="line">    &lt;bean id=&quot;userListJson&quot; class=&quot;org.springframework.web.servlet.view.json.MappingJackson2JsonView&quot;</span><br><span class="line">          p:modelKey=&quot;userList&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>默认情况下,MappingJakson2JsonView会将模型中的所有数据全部输出为JSON,我么可以使用ModelKeys指定模型中输出那些方法.<br>在userController中添加一个方法返回userListJson逻辑视图名,使其被BeanNameViewResolver解析.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/showUserListByJson&quot;)</span><br><span class="line">    public String showUserListInJson(ModelMap mm) &#123;</span><br><span class="line">        Calendar calendar = new GregorianCalendar();</span><br><span class="line">        List&lt;User&gt; userList = new ArrayList&lt;User&gt;();</span><br><span class="line">        User user1 = new User();</span><br><span class="line">        user1.setUserName(&quot;tom&quot;);</span><br><span class="line">        user1.setRealName(&quot;汤姆&quot;);</span><br><span class="line">        calendar.set(1980, 1, 1);</span><br><span class="line">        user1.setBirthday(calendar.getTime());</span><br><span class="line">        User user2 = new User();</span><br><span class="line">        user2.setUserName(&quot;john&quot;);</span><br><span class="line">        user2.setRealName(&quot;约翰&quot;);</span><br><span class="line">        user2.setBirthday(calendar.getTime());</span><br><span class="line">        userList.add(user1);</span><br><span class="line">        userList.add(user2);</span><br><span class="line">        mm.addAttribute(&quot;userList&quot;, userList);</span><br><span class="line">        return &quot;userListJson&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>在浏览器输入localhost:8088/mvc/user/showUserListByJson.html杰克将模型中的userList属性对象以JSON格式出输出.</p><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>SpringMVC为文件上传提供了直接支持,使用MultipartResolver实现.实现类为:CommonsMultipartResolver.</p><h3 id="配置MultipartResolver"><a href="#配置MultipartResolver" class="headerlink" title="配置MultipartResolver"></a>配置MultipartResolver</h3><p>使用CommonsMultipartResolver配置一个Multipart:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span><br><span class="line">          p:defaultEncoding=&quot;UTF-8&quot;</span><br><span class="line">          p:maxUploadSize=&quot;524880&quot;</span><br><span class="line">          p:uploadTempDir=&quot;file:/home/watermelon/JavaWebDemo/mvc/src/main/resources/upload&quot;/&gt;</span><br><span class="line">    &lt;!-- 上传格式为UTF-8,默认为ISO-8859-1,文件上传大小为5mb,上传路径为resources下的upload文件夹--&gt;</span><br></pre></td></tr></table></figure></p><p>DefaultEncoding必须与JSP页面的pageEncoding相同,以便读取表单中的内容.uploadTempDir是上传过程中的临时文件夹,上传完毕后会自动清除临时文件夹中的内容.</p><h3 id="编写控制器与文件上传视图"><a href="#编写控制器与文件上传视图" class="headerlink" title="编写控制器与文件上传视图"></a>编写控制器与文件上传视图</h3><p>在UserController中添加用于处理上传图片的方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//文件上传</span><br><span class="line">   @RequestMapping(&quot;/uploadPage&quot;)</span><br><span class="line">   public String uploadPage()&#123;</span><br><span class="line">       return &quot;/user/uploadPage&quot;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   @RequestMapping(&quot;/upload&quot;)</span><br><span class="line">   public String upload(@RequestParam(&quot;name&quot;)String name, @RequestParam(&quot;file&quot;)MultipartFile file) throws Exception&#123;//上传文件自动保存到MultipartFile中</span><br><span class="line">       if(!file.isEmpty())&#123;</span><br><span class="line">           file.transferTo((new File(&quot;/home/watermelon/JavaWebDemo/mvc/src/main/resources/upload/&quot;+file.getOriginalFilename())));</span><br><span class="line">           return &quot;redirect:success.html&quot;;</span><br><span class="line">       &#125;else &#123;</span><br><span class="line">           return &quot;redirect:fail.html&quot;;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @RequestMapping(&quot;/success&quot;)</span><br><span class="line">   public String success()&#123;</span><br><span class="line">       return &quot;user/success&quot;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @RequestMapping(&quot;/fail&quot;)</span><br><span class="line">   public String fail()&#123;</span><br><span class="line">       return &quot;user/fail&quot;;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>SpringMVC会上传文件自动绑定到MultipartFile中,MultipartFile提供了获取上传文件内容,文件名等方法,具体如下:</p><ul><li>byte[] getBytes():获取文件数据.</li><li>String getContentType():获取文件MIME类型,如image/pjpeg,text/plain等</li><li>InputStream getInputStream():获取文件流</li><li>String getName():获取表单中文件组的名字</li><li>String getOriginalFilename():获取上传文件原名</li><li>long getSize():获取文件字节大小,单位为byte.</li><li>boolean isEmpty():是否有上传的文件</li><li>void transferTo(File dest):将上传文件保存到指定的目标文件中.</li></ul><p>负责上传文件的表单和一般的表单有一些区别,表单的编码类型必须是multipart.form-data类型:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: watermelon</span><br><span class="line">  Date: 18-5-5</span><br><span class="line">  Time: 下午3:07</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;上传文件&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;请选择上传文件&lt;/h1&gt;</span><br><span class="line">&lt;form method=&quot;post&quot; action=&quot;&lt;c:url value=&quot;/user/upload.html&quot;/&gt; &quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><h2 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h2><p>REST风格的资源URL不希望带有.html或者.do等后缀,希望使用如</p><ul><li>/user/tom:用户tom的资源</li><li>/forum.java:java论坛板块资源<br>我们只需将web.xml中的DispatcherServlet配置修改,将<url-pattern>*.html</url-pattern>改为<url-pattern>/</url-pattern>,使其可以捕获所有请求.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;mvc&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;mvc&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></li></ul><p>然后在mvc-servlet.xml中添加 &lt;mvc:default-servlet-handler /&gt; 即可.</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Spring-MVC&quot;&gt;&lt;a href=&quot;#Spring-MVC&quot; class=&quot;headerlink&quot; title=&quot;Spring MVC&quot;&gt;&lt;/a&gt;Spring MVC&lt;/h1&gt;&lt;p&gt;Spring MVC是围绕DispatcherServlet这个核心展开的,他负责截获请求并将其分配给相应的处理器.Spring MVC框架包括注解驱动器控制器,请求以及相应控制器,视图解析,本地化解析,上传文件解析,异常处理解析以及表单绑定等.&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Spring" scheme="https://watermelon-lee.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring-cache初探</title>
    <link href="https://watermelon-lee.github.io/2018/04/26/Spring-cache/"/>
    <id>https://watermelon-lee.github.io/2018/04/26/Spring-cache/</id>
    <published>2018-04-26T02:45:37.000Z</published>
    <updated>2018-04-30T14:38:06.062Z</updated>
    
    <content type="html"><![CDATA[<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>可以将缓存定义为一种存储机制,他将数据保存在某个地方,以一种更快的方式提供服务</p><h3 id="缓存命中率"><a href="#缓存命中率" class="headerlink" title="缓存命中率"></a>缓存命中率</h3><p>命中率=从缓存中读取的次数/(总读取次数{从缓存读取的次数+从慢速设备上读取的次数}),缓存策略一般命中率越高越好</p><h3 id="过期策略"><a href="#过期策略" class="headerlink" title="过期策略"></a>过期策略</h3><p>如果缓存满了,从缓存中移除数据的策略.常见的有LFU,LRU,FIFO  </p><ul><li>FIFO(first in first out):先进先出,先放入缓存的数据先移除</li><li>LRU(least recently used):最久未使用策略,即使用时间距离现在最久的那个数据被移除</li><li>LFU(least frequently used):最久最少使用策略,一定时间段内使用次数最少的那个数据被移除</li><li>TTL(time to live):存活期,即从缓存中创建时间点开始知道到期的一个时间点(不管在存活期内是否被访问过)</li><li>TTI(time ti idle):空闲期,数据多久没被访问就从缓存中移除<a id="more"></a><h3 id="使用Spring-Cache"><a href="#使用Spring-Cache" class="headerlink" title="使用Spring Cache"></a>使用Spring Cache</h3>首先自己自定义一个缓存,然后在将其与Spring Cache对比.<br>假如我们需要查询用户,为了避免多次访问数据库,我们会对其做一个缓存,以userId为键,userValue为值.当查询相同的userId时,程序直接从缓存中获取结果,否则更新缓存.<br>实体类User定义:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package com.cache.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class User implements Serializable&#123;</span><br><span class="line">    private String userId;</span><br><span class="line">    private String userName;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    public User(String userId) &#123;</span><br><span class="line">        this.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserId() &#123;</span><br><span class="line">        return userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserId(String userId) &#123;</span><br><span class="line">        this.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserName(String userName) &#123;</span><br><span class="line">        this.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(int age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>java缓存的对象与序列化是息息相关的,一般情况下,需要被缓存的实体类实现Serializable,只有实现了Serializable接口类,JVM才可以对其对象进行序列化.<br>接下来定义一个缓存管理器,负责实现缓存逻辑,支持对象的增加修改和删除,并支持泛型:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.cache.mycache;</span><br><span class="line"></span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line">public class CacheManager&lt;T&gt; &#123;</span><br><span class="line">    private Map&lt;String,T&gt; cache=new ConcurrentHashMap&lt;String, T&gt;();</span><br><span class="line"></span><br><span class="line">    public T getValue(Object key)&#123;</span><br><span class="line">        return cache.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addOrUpdateCache(String key,T value)&#123;</span><br><span class="line">        cache.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void evictCache(String key)&#123;//按键值清除缓存</span><br><span class="line">        cache.remove(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void evictCache()&#123;//清除所有缓存</span><br><span class="line">        cache.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在提供一个用户查询的服务类:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.cache.mycache;</span><br><span class="line"></span><br><span class="line">import com.cache.domain.User;</span><br><span class="line"></span><br><span class="line">public class UserService &#123;</span><br><span class="line">    private CacheManager&lt;User&gt; cacheManager;</span><br><span class="line"></span><br><span class="line">    public UserService()&#123;</span><br><span class="line">        //构造一个缓存器</span><br><span class="line">        cacheManager=new CacheManager&lt;User&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User getUserById(String userId)&#123;</span><br><span class="line">        //首先查询缓存</span><br><span class="line">        User result=cacheManager.getValue(userId);</span><br><span class="line">        if(result!=null)&#123;</span><br><span class="line">            System.out.println(&quot;get forum cache...&quot;+userId);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            result=getForumDb(userId);</span><br><span class="line">            if(result!=null)&#123;</span><br><span class="line">                //将数据查询结果更新到</span><br><span class="line">                cacheManager.addOrUpdateCache(userId,result);</span><br><span class="line">            &#125;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void reload()&#123;</span><br><span class="line">        cacheManager.evictCache();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private User getForumDb(String userId)&#123;</span><br><span class="line">        System.out.println(&quot;real querying db...&quot;+userId);</span><br><span class="line">        return new User(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>编写一个测试类:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.cache.mycache;</span><br><span class="line"></span><br><span class="line">import com.cache.domain.User;</span><br><span class="line">import com.cache.mycache.UserService;</span><br><span class="line"></span><br><span class="line">public class UserMain &#123;</span><br><span class="line">    public static void main(String[] a)&#123;</span><br><span class="line">        UserService userService=new UserService();</span><br><span class="line"></span><br><span class="line">        //开始查询账号</span><br><span class="line">        userService.getUserById(&quot;001&quot;);//第一次查询,从数据库查询</span><br><span class="line">        userService.getUserById(&quot;001&quot;);//第二次查询,从缓存返回</span><br><span class="line"></span><br><span class="line">        //重置缓存</span><br><span class="line">        userService.reload();</span><br><span class="line">        System.out.println(&quot;after reload&quot;);</span><br><span class="line"></span><br><span class="line">        userService.getUserById(&quot;001&quot;);//再次查询,从数据库返回</span><br><span class="line">        userService.getUserById(&quot;001&quot;);//缓存返回</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以得到结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">real querying db...001</span><br><span class="line">get forum cache...001</span><br><span class="line">after reload</span><br><span class="line">real querying db...001</span><br><span class="line">get forum cache...001</span><br></pre></td></tr></table></figure></p><p>可以看出缓存可以正常工作,但是这种方式十分不优雅,缓存代码与业务代码高度耦合,业务代码中包含了大量缓存逻辑控制代码,下面使用Spring Cache来改进上述代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.cache.simpleCache;</span><br><span class="line">import com.cache.domain.User;</span><br><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service(&quot;userServiceBean&quot;)</span><br><span class="line">public class UserServiceBySpringCache&#123;</span><br><span class="line"></span><br><span class="line">    //使用一个名为users的缓存</span><br><span class="line">    @Cacheable(cacheNames = &quot;users&quot;)</span><br><span class="line">    public User getUserById(String userId)&#123;</span><br><span class="line">        //方法内部不考虑缓存逻辑,直接实现</span><br><span class="line">        System.out.println(&quot;执行用户业务方法查找&quot;+userId);</span><br><span class="line">        return getForumDb(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private User getForumDb(String userId)&#123;</span><br><span class="line">        System.out.println(&quot;从数据库中查找&quot;+userId);</span><br><span class="line">        return new User(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>getUserById()方法标注了一个注解@Cacheable(cacheNames=”users”),当调用这个方法的时候,会先从缓存中匹配对象,如果存在,直接返回,如果不存在,则执行方法体内的逻辑,并且将返回值放入缓存中.对应缓存的key是userId,value就是userId对应的User对象.<br>在配置文件中配置支持注解缓存:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:cache=&quot;http://www.springframework.org/schema/cache&quot;</span><br><span class="line">       xmlns:p=&quot;http://www.springframework.org/schema/p&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;cache:annotation-driven/&gt;</span><br><span class="line">    &lt;context:component-scan base-package=&quot;com.cache.simpleCache&quot;/&gt;</span><br><span class="line">    &lt;!--&lt;bean id=&quot;cacheService&quot; class=&quot;com.cache.simpleCache.UserServiceBySpringCache&quot;/&gt;--&gt;</span><br><span class="line">    &lt;bean id=&quot;cacheManager&quot; class=&quot;org.springframework.cache.support.SimpleCacheManager&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;caches&quot;&gt;</span><br><span class="line">            &lt;set&gt;</span><br><span class="line">                &lt;bean class=&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot; p:name=&quot;default&quot;/&gt;</span><br><span class="line">                &lt;bean class=&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot; p:name=&quot;users&quot;/&gt;</span><br><span class="line">            &lt;/set&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p><p>Spring通过<a href="cache:annotation-driven/" target="_blank" rel="noopener">cache:annotation-driven/</a>就可以启动基于注解的缓存驱动,这个配置项默认了使用了一个名为cacheManager的缓存管理器.SimpleCacheManager是这个缓存管理器的默认实现,他通过对其属性caches的配置来实现刚刚自定义的缓存管理器逻辑.除了默认default缓存外,还自定义了一个名为users的缓存,使用了默认的内存存储方案concurrentMapCacheFactoryBean.接下来重写测试类,以观察结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.cache.simpleCache;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line">public class UserCacheMain &#123;</span><br><span class="line">    public static void main(String[] a)&#123;</span><br><span class="line">        ApplicationContext context=new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="line">        UserServiceBySpringCache userService=(UserServiceBySpringCache)context.getBean(&quot;userServiceBean&quot;);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;first query&quot;);</span><br><span class="line">        userService.getUserById(&quot;me&quot;);</span><br><span class="line">        System.out.println(&quot;second query&quot;);</span><br><span class="line">        userService.getUserById(&quot;me&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>结果为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">first query</span><br><span class="line">执行用户业务方法查找me</span><br><span class="line">从数据库中查找me</span><br><span class="line">second query</span><br></pre></td></tr></table></figure></p><p>可以看出使用Spring cache成功,我们仅仅在userServiceBySpringCache中的Service上注解了一个@Cacheable就实现了基本缓存方案.使用Spring Cache十分简单,只需要两个步骤:</p><ul><li>缓存定义:确定需要缓存的方法和缓存策略</li><li>配置缓存:配置缓存</li></ul><p>##　Spring Cache抽象</p><h3 id="注解缓存"><a href="#注解缓存" class="headerlink" title="注解缓存"></a>注解缓存</h3><h4 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h4><p>@Cacheable是最重要的注解,它指定了返回值是可以被缓存的.缓存名是必须提供的,可用引号,Value或者cacheNames属性来定义.此外还可以定义多个缓存,在该类表中使用逗号分隔缓存名,并且用花括号括起来.例如:<code>@Cacheable(cacheNames={&quot;cache1&quot;,&quot;cache2&quot;}</code>  </p><h5 id="键生成器"><a href="#键生成器" class="headerlink" title="键生成器"></a>键生成器</h5><p>缓存的本质就是键值对集合.Spring提供了默认的SimpleKeyGenerator,使用一个符合键SimpleKey.规则为:  </p><ul><li>如果方法没有入参,使用SimpleKey.EMPTY为key</li><li>如果方法只有一个入参,则使用该入参作为key</li><li>如果方法有多个入参,则返回包含所有入参的一个SimpleKey<br>此外可以使用SpEL来指定自定义键,如:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Cacheable(cacheNames=&quot;users&quot; key=&quot;#user.getCode&quot;)</span><br><span class="line">public User GetUser(User user,boolean checkLogout)</span><br></pre></td></tr></table></figure></li></ul><p>上述函数有一个checkLogout用于区分用户是都注销,而我们不想使用其作为key的一部分,可以根据key属性指定为userCode.</p><h5 id="带条件的缓存"><a href="#带条件的缓存" class="headerlink" title="带条件的缓存"></a>带条件的缓存</h5><p>使用@Cacheable注解的Condition属性可以按条件来缓存.condition属性使用了SpEL表达式动态评估方法入参是否满足条件.<br>例如使用了@Cacheable声明的方法getUser(),我们启用一个条件:仅仅对年龄小于35的用户缓存<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class UserService &#123;</span><br><span class="line">    private Map&lt;Integer, User&gt; users = new HashMap&lt;Integer, User&gt;();</span><br><span class="line">    &#123;</span><br><span class="line">        users.put(1, new User(&quot;1&quot;, &quot;w1&quot;,37));</span><br><span class="line">        users.put(2, new User(&quot;2&quot;, &quot;w2&quot;, 34));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Cacheable(value = &quot;users&quot;, condition = &quot;#user.age &lt; 35&quot;)</span><br><span class="line">    public User getUser(User user) &#123;</span><br><span class="line">        System.out.println(&quot;User with id &quot; + user.getUserId() + &quot; requested.&quot;);</span><br><span class="line">        return users.get(Integer.valueOf(user.getUserId()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h4><p>@CachePut与@Cacheable效果几乎一样,他首先执行方法,然后将返回值放入缓存.当希望更新数据,以方法返回值来更新缓存就可以使用该注解.@CachePut注解会强制执行方法而更新缓存,而@Cacheable会直接跳过方法从直接获取缓存,所以两者不可以同时使用.如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@CachePut(cacheNames=&quot;book&quot;, key=&quot;#isbn&quot;)</span><br><span class="line">public Book updateBook(ISBN isbn, BookDescriptor descriptor)</span><br></pre></td></tr></table></figure></p><p>在更新操作后,缓存中的book对应的BookDescriptor为更新之后的值.</p><h4 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h4><p>@CacheEvict是@Cacheable的反向操作,负责从缓存中删除一个数据.@CacheEvict要求指定一个或多个缓存，使之都受影响。如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@CacheEvict(cacheNames=&quot;users&quot;)</span><br><span class="line">public void removeUser(int id)&#123;</span><br><span class="line">    usersremove(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>使用@CacheEvict即可从缓存中删除一个用户.同样的,@CacheEvict也提供了Condition和key属性.此外，还提供了两个额外的参数allEntries和beforeInvocation。allEntries表示是否需要清除缓存中的所有元素。默认为false，表示不需要。当指定了allEntries为true时，Spring Cache将忽略指定的key。而beforeInvocation可以改变清除操作的时间.平时都是方法执行完毕后清除缓存,如果方法抛出异常,则不会清除缓存.而指定beforeInvocation为true,则会在方法调用前清除缓存.</p><h4 id="Caching"><a href="#Caching" class="headerlink" title="@Caching"></a>@Caching</h4><p>@Caching是一个组注解,可以为一个方法定义提供基于@Cacheable,@CacheEvict,@CachePut的数组.假设我们定义了一个User,Member,Visitor三个实体类,User为抽象类,而member和Visitor为继承他的子类.<br>我们可以使用@Caching声明两个@Cacheable注解,使其指向不同的两个缓存:member和Visitor.然后根据两个@Cacheable注解定义的条件对方法中的参数进行检查,将对象存储在对应的缓存.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.cache.caching;</span><br><span class="line"></span><br><span class="line">import com.cache.domain.User;</span><br><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.cache.annotation.Caching;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@Service(value = &quot;cacheGroupUserService&quot;)</span><br><span class="line">public class UserService &#123;</span><br><span class="line">    private Map&lt;Integer,User&gt; map=new HashMap&lt;Integer, User&gt;();</span><br><span class="line">    &#123;</span><br><span class="line">        map.put(1,new Member(&quot;1&quot;,&quot;member1&quot;));</span><br><span class="line">        map.put(2,new Visitor(&quot;2&quot;,&quot;visitor1&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Caching(cacheable = &#123;</span><br><span class="line">            @Cacheable(value = &quot;members&quot;,condition = &quot;#obj instanceof T(com.domain.Mamber)&quot;),</span><br><span class="line">            @Cacheable(value = &quot;visitor&quot;,condition = &quot;#obj instanceof T(com.domain.Visitor)&quot;),</span><br><span class="line">    &#125;)</span><br><span class="line">    public User getUser(User obj)&#123;</span><br><span class="line">        return map.get(Integer.valueOf(obj.getUserId()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="CacheConfig"><a href="#CacheConfig" class="headerlink" title="@CacheConfig"></a>@CacheConfig</h4><p>前面的注解都是基于方法的,假如我们在一个类中需要的缓存的方法注解属性一致,则需要一个个重复的添加.我们可以使用@CacheConfig来配置.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@CacheConfig(cacheNames=&quot;users&quot;,keyGenerator=&quot;MyKeyGenerator&quot;)</span><br><span class="line">public class UserService&#123;</span><br><span class="line">    @Cacheable</span><br><span class="line">    public User findA(User user)&#123;</span><br><span class="line">    ....</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Cacheable</span><br><span class="line">    public User findB(User user)&#123;</span><br><span class="line">    ....</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;缓存&quot;&gt;&lt;a href=&quot;#缓存&quot; class=&quot;headerlink&quot; title=&quot;缓存&quot;&gt;&lt;/a&gt;缓存&lt;/h1&gt;&lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;p&gt;可以将缓存定义为一种存储机制,他将数据保存在某个地方,以一种更快的方式提供服务&lt;/p&gt;
&lt;h3 id=&quot;缓存命中率&quot;&gt;&lt;a href=&quot;#缓存命中率&quot; class=&quot;headerlink&quot; title=&quot;缓存命中率&quot;&gt;&lt;/a&gt;缓存命中率&lt;/h3&gt;&lt;p&gt;命中率=从缓存中读取的次数/(总读取次数{从缓存读取的次数+从慢速设备上读取的次数}),缓存策略一般命中率越高越好&lt;/p&gt;
&lt;h3 id=&quot;过期策略&quot;&gt;&lt;a href=&quot;#过期策略&quot; class=&quot;headerlink&quot; title=&quot;过期策略&quot;&gt;&lt;/a&gt;过期策略&lt;/h3&gt;&lt;p&gt;如果缓存满了,从缓存中移除数据的策略.常见的有LFU,LRU,FIFO  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FIFO(first in first out):先进先出,先放入缓存的数据先移除&lt;/li&gt;
&lt;li&gt;LRU(least recently used):最久未使用策略,即使用时间距离现在最久的那个数据被移除&lt;/li&gt;
&lt;li&gt;LFU(least frequently used):最久最少使用策略,一定时间段内使用次数最少的那个数据被移除&lt;/li&gt;
&lt;li&gt;TTL(time to live):存活期,即从缓存中创建时间点开始知道到期的一个时间点(不管在存活期内是否被访问过)&lt;/li&gt;
&lt;li&gt;TTI(time ti idle):空闲期,数据多久没被访问就从缓存中移除
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Spring" scheme="https://watermelon-lee.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring-ORM框架</title>
    <link href="https://watermelon-lee.github.io/2018/04/21/Spring-ORM/"/>
    <id>https://watermelon-lee.github.io/2018/04/21/Spring-ORM/</id>
    <published>2018-04-21T14:32:28.000Z</published>
    <updated>2018-04-30T14:37:30.200Z</updated>
    
    <content type="html"><![CDATA[<p>非常简单学习了一下Hibernate与Mybatis,两者给我的感受是Hibernate对于初学者上手很快,不需要自己写Sql语句,相比于Mybatis对于每一个实体类需要一个映射文件来说,它的使用十分快捷方便.但是在使用过程中出现的问题也更多,Hql语句定义问题啊,使用泛型BaseDao问题什么,自己对于Hibernate也完全不了解,出了Bug需要查阅许多博客.而使用Mybatis可以不用自己写Dao实现类,可以使用Mybatis的提供的MapperScannerConfigurer直接将映射接口转换为Spring容器的Bean.<br><a id="more"></a></p><h1 id="使用Hibernate"><a href="#使用Hibernate" class="headerlink" title="使用Hibernate"></a>使用Hibernate</h1><h2 id="使用注解配置"><a href="#使用注解配置" class="headerlink" title="使用注解配置"></a>使用注解配置</h2><p>使用配置注解的话就可以不用编写Hibernate映射文件,我认为注解更为便捷<br>配置文件如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC &quot;-//Hibernate/Hibernate Mapping DTD//EN&quot;</span><br><span class="line">&quot;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&quot;&gt;</span><br><span class="line">&lt;hibernate-mapping auto-import=&quot;true&quot; default-lazy=&quot;false&quot;&gt;</span><br><span class="line">&lt;class name=&quot;com.smart.domain.Forum&quot; table=&quot;t_forum&quot;&gt;</span><br><span class="line">&lt;id name=&quot;forumId&quot; column=&quot;forum_id&quot;&gt;</span><br><span class="line">&lt;generator class=&quot;assigned&quot; /&gt;</span><br><span class="line">&lt;/id&gt;</span><br><span class="line">&lt;property name=&quot;forumName&quot; column=&quot;forum_name&quot; /&gt;</span><br><span class="line">&lt;property name=&quot;forumDesc&quot; column=&quot;forum_desc&quot; /&gt;</span><br><span class="line">&lt;/class&gt;</span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure></p><p>该Forum实体类的映射文件等价于下面注解.<br>对Forum和Post两个实体类标记注解:<br>Forum:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">:@Entity</span><br><span class="line">@Table(name=&quot;t_forum&quot;)</span><br><span class="line">public class Forum implements Serializable&#123;</span><br><span class="line">@Id</span><br><span class="line">@Column(name = &quot;forum_id&quot;, nullable = true)</span><br><span class="line">private int forumId;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;forum_name&quot; ,nullable = true)</span><br><span class="line">private String forumName;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;forum_desc&quot; ,nullable = true)</span><br><span class="line">private String forumDesc;</span><br><span class="line"></span><br><span class="line">public String getForumDesc() &#123;</span><br><span class="line">return forumDesc;</span><br><span class="line">&#125;</span><br><span class="line">public void setForumDesc(String forumDesc) &#123;</span><br><span class="line">this.forumDesc = forumDesc;</span><br><span class="line">&#125;</span><br><span class="line">public int getForumId() &#123;</span><br><span class="line">return forumId;</span><br><span class="line">&#125;</span><br><span class="line">public void setForumId(int forumId) &#123;</span><br><span class="line">this.forumId = forumId;</span><br><span class="line">&#125;</span><br><span class="line">public String getForumName() &#123;</span><br><span class="line">return forumName;</span><br><span class="line">&#125;</span><br><span class="line">public void setForumName(String forumName) &#123;</span><br><span class="line">this.forumName = forumName;</span><br><span class="line">&#125;</span><br><span class="line">public String toString()&#123;</span><br><span class="line">return ToStringBuilder.reflectionToString(this);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Post:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">@Table(name=&quot;t_post&quot;)</span><br><span class="line">public class Post implements Serializable &#123;</span><br><span class="line">@Id</span><br><span class="line">@Column(name = &quot;post_id&quot;)</span><br><span class="line">private int postId;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;user_id&quot;)</span><br><span class="line">private int userId;</span><br><span class="line"></span><br><span class="line">@ManyToOne</span><br><span class="line">    @JoinColumn(name = &quot;topic_id&quot;)</span><br><span class="line">private Topic topic;</span><br><span class="line"></span><br><span class="line">@Lob</span><br><span class="line">@Basic(fetch = FetchType.LAZY)</span><br><span class="line">@Column(name = &quot;post_text&quot;,columnDefinition = &quot;CLOB&quot;)</span><br><span class="line">//@Type(type=&quot;org.springframework.orm.hibernate4.support.ClobStringType&quot;)</span><br><span class="line">private String postText;</span><br><span class="line"></span><br><span class="line">@Lob</span><br><span class="line">@Basic(fetch = FetchType.LAZY)</span><br><span class="line">@Column(name = &quot;post_attach&quot;,columnDefinition = &quot;BLOB&quot;)</span><br><span class="line">//@Type(type=&quot;org.springframework.orm.hibernate4.support.BlobByteArrayType&quot;)</span><br><span class="line">private byte[] postAttach;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;post_time&quot;)</span><br><span class="line">private Date postTime;</span><br><span class="line"></span><br><span class="line">public int getPostId() &#123;</span><br><span class="line">return postId;</span><br><span class="line">&#125;</span><br><span class="line">public void setPostId(int postId) &#123;</span><br><span class="line">this.postId = postId;</span><br><span class="line">&#125;</span><br><span class="line">public String getPostText() &#123;</span><br><span class="line">return postText;</span><br><span class="line">&#125;</span><br><span class="line">public void setPostText(String postText) &#123;</span><br><span class="line">this.postText = postText;</span><br><span class="line">&#125;</span><br><span class="line">public Date getPostTime() &#123;</span><br><span class="line">return postTime;</span><br><span class="line">&#125;</span><br><span class="line">public void setPostTime(Date postTime) &#123;</span><br><span class="line">this.postTime = postTime;</span><br><span class="line">&#125;</span><br><span class="line">public int getUserId() &#123;</span><br><span class="line">return userId;</span><br><span class="line">&#125;</span><br><span class="line">public void setUserId(int userId) &#123;</span><br><span class="line">this.userId = userId;</span><br><span class="line">&#125;</span><br><span class="line">public byte[] getPostAttach() &#123;</span><br><span class="line">return postAttach;</span><br><span class="line">&#125;</span><br><span class="line">public void setPostAttach(byte[] postAttach) &#123;</span><br><span class="line">this.postAttach = postAttach;</span><br><span class="line">&#125;</span><br><span class="line">public Topic getTopic() &#123;</span><br><span class="line">return topic;</span><br><span class="line">&#125;</span><br><span class="line">public void setTopic(Topic topic) &#123;</span><br><span class="line">this.topic = topic;</span><br><span class="line">&#125;</span><br><span class="line">public String toString()&#123;</span><br><span class="line">return ToStringBuilder.reflectionToString(this);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Topic:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">package com.domain;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.lang.builder.ToStringBuilder;</span><br><span class="line"></span><br><span class="line">import javax.persistence.*;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">@Table(name=&quot;t_topic&quot;)</span><br><span class="line">public class Topic implements Serializable &#123;</span><br><span class="line">private static final long serialVersionUID = 1L; </span><br><span class="line">@Id</span><br><span class="line">@Column(name = &quot;topic_id&quot;)</span><br><span class="line">private int topicId;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;user_id&quot;)</span><br><span class="line">private int userId;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;topic_title&quot;)</span><br><span class="line">private String topicTitle;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;topic_time&quot;)</span><br><span class="line">private Date topicTime;</span><br><span class="line"></span><br><span class="line">@ManyToOne</span><br><span class="line">    @JoinColumn(name = &quot;forum_id&quot;)</span><br><span class="line">private Forum forum;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Column(name = &quot;topic_views&quot;)</span><br><span class="line">private int topicViews;</span><br><span class="line"></span><br><span class="line">@OneToMany(mappedBy = &quot;topic&quot;, cascade = CascadeType.ALL)</span><br><span class="line">private List&lt;Post&gt; posts;</span><br><span class="line"></span><br><span class="line">@Column(name = &quot;topic_replies&quot;)</span><br><span class="line">    private int topicReplies;</span><br><span class="line"></span><br><span class="line">public int getTopicId() &#123;</span><br><span class="line">return topicId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setTopicId(int topicId) &#123;</span><br><span class="line">this.topicId = topicId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public Date getTopicTime() &#123;</span><br><span class="line">return topicTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setTopicTime(Date topicTime) &#123;</span><br><span class="line">this.topicTime = topicTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public String getTopicTitle() &#123;</span><br><span class="line">return topicTitle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setTopicTitle(String topicTitle) &#123;</span><br><span class="line">this.topicTitle = topicTitle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public int getTopicViews() &#123;</span><br><span class="line">return topicViews;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setTopicViews(int topicViews) &#123;</span><br><span class="line">this.topicViews = topicViews;</span><br><span class="line">&#125;</span><br><span class="line">public String toString()&#123;</span><br><span class="line">return ToStringBuilder.reflectionToString(this);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public Forum getForum() &#123;</span><br><span class="line">return forum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setForum(Forum forum) &#123;</span><br><span class="line">this.forum = forum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public int getUserId() &#123;</span><br><span class="line">return userId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setUserId(int userId) &#123;</span><br><span class="line">this.userId = userId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public List&lt;Post&gt; getPosts() &#123;</span><br><span class="line">return posts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setPosts(List&lt;Post&gt; posts) &#123;</span><br><span class="line">this.posts = posts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public int getTopicReplies() &#123;</span><br><span class="line">return topicReplies;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setTopicReplies(int topicReplies) &#123;</span><br><span class="line">this.topicReplies = topicReplies;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后XML配置文件中使用packagesToScan来让Spring扫描加载带注释的实体类,可以使用逗号分隔,制定一系列的包名:<code>&lt;property name=&quot;packagesToScan&quot; value=&quot;com.domain&quot;/&gt;</code></p><h2 id="配置SessionFactory"><a href="#配置SessionFactory" class="headerlink" title="配置SessionFactory"></a>配置SessionFactory</h2><p>配置文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--制定Hibernate实体类映射,以及制定Hibernate配置属性--&gt;</span><br><span class="line">   &lt;bean id=&quot;sessionFactory&quot; class=&quot;org.springframework.orm.hibernate4.LocalSessionFactoryBean&quot; p:dataSource-ref=&quot;dataSource&quot; &gt;</span><br><span class="line">       &lt;property name=&quot;packagesToScan&quot; value=&quot;com.domain&quot;/&gt;</span><br><span class="line">       &lt;property name=&quot;hibernateProperties&quot;&gt;</span><br><span class="line">           &lt;props&gt;</span><br><span class="line">               &lt;prop key=&quot;hibernate.dialect&quot;&gt;</span><br><span class="line">                   org.hibernate.dialect.MySQLDialect</span><br><span class="line">               &lt;/prop&gt;</span><br><span class="line">               &lt;prop key=&quot;hibernate.show_sql&quot;&gt;</span><br><span class="line">                   true</span><br><span class="line">               &lt;/prop&gt;</span><br><span class="line">           &lt;/props&gt;</span><br><span class="line">       &lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure></p><h2 id="使用HibernateTemplate"><a href="#使用HibernateTemplate" class="headerlink" title="使用HibernateTemplate"></a>使用HibernateTemplate</h2><p>基于模板类使用Hibernate是最简单的方式,按照Spring的风格,它提供了模板的支持类HibernateDaoSupport,并且通过getHibernateTemplate()方法像子类开放模板类实例的调用.配置如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;hibernateTemplate&quot;</span><br><span class="line">          class=&quot;org.springframework.orm.hibernate4.HibernateTemplate&quot;</span><br><span class="line">          p:sessionFactory-ref=&quot;sessionFactory&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>在实际开发中,开发者一般会在Spring支持类的基础上编写自己的Dao基类,进行自己的封装,以获得泛型的支持,并提供自己的代理方法.Dao基类并不需要对模板类的所有方法进行代理,只需代理一些常用的方法(如CRUD),不常用的方法可在子模板类中实现.<br>一般实体类对应的Dao都必须有自己的CRUD操作,与其在每个实体Dao接口中重复定义这些方法,不如提供一个通用的Dao接口.<br>BaseDao:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">package com;</span><br><span class="line"></span><br><span class="line">import com.domain.Forum;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.orm.hibernate4.HibernateTemplate;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.lang.reflect.ParameterizedType;</span><br><span class="line">import java.lang.reflect.Type;</span><br><span class="line"></span><br><span class="line">public class BaseDao&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private HibernateTemplate hibernateTemplate;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    public void setHibernateTemplate(HibernateTemplate hibernateTemplate) &#123;</span><br><span class="line">        this.hibernateTemplate = hibernateTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    private Class entityClass;</span><br><span class="line"></span><br><span class="line">    public BaseDao()&#123;</span><br><span class="line">//        Type genType = getClass().getGenericSuperclass();</span><br><span class="line">//        Type[] params = ((ParameterizedType) genType).getActualTypeArguments();</span><br><span class="line">//        entityClass = (Class) params[0];</span><br><span class="line"></span><br><span class="line">        //返回表示此 Class 所表示的实体类的 直接父类 的 Type。注意，是直接父类</span><br><span class="line">        //这里type结果是 com.dfsj.generic.GetInstanceUtil&lt;com.dfsj.generic.User&gt;</span><br><span class="line">            Type type = getClass().getGenericSuperclass();</span><br><span class="line">        // 判断 是否泛型</span><br><span class="line">            if( type instanceof ParameterizedType )&#123;</span><br><span class="line">                //getActualTypeArguments()返回表示此类型实际类型参数的Type对象的数组,这里我们只有一个泛型类.</span><br><span class="line">                // 当有多个泛型类时，数组的长度就不是1了</span><br><span class="line">                ParameterizedType pType = (ParameterizedType)type;</span><br><span class="line">                Type claz =  ((ParameterizedType) type).getActualTypeArguments()[0];</span><br><span class="line">                if( claz instanceof Class )&#123;</span><br><span class="line">                    this.entityClass = (Class&lt;T&gt;) claz;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public T get(int id)&#123;</span><br><span class="line">        return (T)hibernateTemplate.get(entityClass, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void save(T entity)&#123;</span><br><span class="line">        hibernateTemplate.save(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void update(T entity)&#123;</span><br><span class="line">        hibernateTemplate.update(entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public HibernateTemplate getHibernateTemplate() &#123;</span><br><span class="line">        return hibernateTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ForumHibernateDao:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.HibrenateDao;</span><br><span class="line"></span><br><span class="line">import com.BaseDao;</span><br><span class="line">import com.domain.Forum;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.orm.hibernate4.HibernateTemplate;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.ParameterizedType;</span><br><span class="line">import java.lang.reflect.Type;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public class ForumHibernateDao extends BaseDao&lt;Forum&gt; &#123;//使用HQL查询</span><br><span class="line">    private HibernateTemplate hibernateTemplate;</span><br><span class="line"></span><br><span class="line">    public long getForumNum()&#123;</span><br><span class="line">        Object object=getHibernateTemplate().iterate(&quot;select count(forum.forumId) from Forum  forum&quot;).next();</span><br><span class="line">        return (Long)object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Forum&gt; findForumByName(String forumName) &#123;</span><br><span class="line">        return (List&lt;Forum&gt;) getHibernateTemplate().find(</span><br><span class="line">                &quot;from Forum f where f.forumName like ?&quot;, forumName + &quot;%&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>PostHibernateDao:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.HibrenateDao;</span><br><span class="line"></span><br><span class="line">import com.BaseDao;</span><br><span class="line">import com.domain.Forum;</span><br><span class="line">import com.domain.Post;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public class PostHibernateDao extends BaseDao&lt;Post&gt; &#123;</span><br><span class="line"></span><br><span class="line">public void addPost(Post post) &#123;</span><br><span class="line">getHibernateTemplate().save(post);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public Post getPost(int postId) &#123;</span><br><span class="line">// TODO Auto-generated method stub</span><br><span class="line">return null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在PostHibernateDao中addPost()中包含了Lob数据处理,需要在配置文件中定义LobHandler的Bean:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;lobHandler&quot; class=&quot;org.springframework.jdbc.support.lob.DefaultLobHandler&quot;</span><br><span class="line">          lazy-init=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>TopicHibernateDao:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.HibrenateDao;</span><br><span class="line"></span><br><span class="line">import com.BaseDao;</span><br><span class="line">import com.domain.Topic;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public class TopicHibernateDao extends BaseDao&lt;Topic&gt; &#123;</span><br><span class="line">public void addTopic(Topic topic) &#123;</span><br><span class="line">getHibernateTemplate().save(topic);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public Topic getTopicById(int topicId)&#123;</span><br><span class="line">return getHibernateTemplate().get(Topic.class, topicId);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="事务处理"><a href="#事务处理" class="headerlink" title="事务处理"></a>事务处理</h3><p>Spring的通用事务处理对于Hibernate完全通用,代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">@Transactional</span><br><span class="line">@Service(&quot;forumService&quot;)</span><br><span class="line">public class ForumHibernateService &#123;</span><br><span class="line">    private ForumHibernateDao forumHibernateDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private PostHibernateDao postHibernateDao;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    public void setForumHibernateDao(ForumHibernateDao forumHibernateDao) &#123;</span><br><span class="line">        this.forumHibernateDao = forumHibernateDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void addForum(Forum forum)&#123;</span><br><span class="line">        forumHibernateDao.save(forum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void updateForum(Forum forum)&#123;</span><br><span class="line">        forumHibernateDao.update(forum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Forum getForum(int id)&#123;</span><br><span class="line">        return (Forum)forumHibernateDao.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public long getForumNum()&#123;</span><br><span class="line">       return forumHibernateDao.getForumNum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Forum&gt; findForumByName(String name)&#123;</span><br><span class="line">        return forumHibernateDao.findForumByName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addPost(Post post)&#123;</span><br><span class="line">        postHibernateDao.addPost(post);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在配置文件需要如下声明:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--事务处理--&gt;</span><br><span class="line">    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.hibernate4.HibernateTransactionManager&quot;</span><br><span class="line">          p:sessionFactory-ref=&quot;sessionFactory&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;tx:annotation-driven/&gt;</span><br></pre></td></tr></table></figure></p><p>测试类编写:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@Transactional</span><br><span class="line">public class HibernateTest  &#123;</span><br><span class="line">    ApplicationContext context=new ClassPathXmlApplicationContext(&quot;com/Hibernate/Hibernate.xml&quot;);</span><br><span class="line">    ForumHibernateService service=(ForumHibernateService)context.getBean(&quot;forumService&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        Forum forum=new Forum();</span><br><span class="line">        forum.setForumId(54);</span><br><span class="line">        forum.setForumName(&quot;watermelon&quot;);</span><br><span class="line">        forum.setForumDesc(&quot;my cute wife&quot;);</span><br><span class="line"></span><br><span class="line">        service.addForum(forum);</span><br><span class="line">        Forum forum2=service.getForum(11);</span><br><span class="line">        System.out.println(forum2);</span><br><span class="line">        long num=service.getForumNum();</span><br><span class="line">        forum.setForumDesc(&quot;my beautiful wife&quot;);</span><br><span class="line">        service.updateForum(forum);</span><br><span class="line"></span><br><span class="line">        List&lt;Forum&gt;forums=new ArrayList&lt;Forum&gt;();</span><br><span class="line">        forums=service.findForumByName(&quot;watermlon&quot;);</span><br><span class="line">        System.out.println(forums);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAddPost() throws Throwable&#123;</span><br><span class="line"></span><br><span class="line">        Topic topic = new Topic();</span><br><span class="line">        topic.setTopicId(2);</span><br><span class="line">        Post post = new Post();</span><br><span class="line">        post.setPostId(17);</span><br><span class="line">        post.setPostText(&quot;post text...&quot;);</span><br><span class="line"></span><br><span class="line">        Resource resource = new ClassPathResource(&quot;temp.jpg&quot;);</span><br><span class="line">        byte[] imgFile = FileCopyUtils.copyToByteArray(resource.getFile());</span><br><span class="line">        post.setPostAttach(imgFile);</span><br><span class="line">        post.setTopic(topic);</span><br><span class="line">        service.addPost(post);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过测试类便可发现已经在数据库中完成了以上操作.</p><h1 id="使用Mybatis"><a href="#使用Mybatis" class="headerlink" title="使用Mybatis"></a>使用Mybatis</h1><h2 id="配置SQLMapClient"><a href="#配置SQLMapClient" class="headerlink" title="配置SQLMapClient"></a>配置SQLMapClient</h2><p>每个Mybatis应用程序都以一个SqlSessionFactory对象的实例为核心.Mybatis同样也需要构建对个SQL映射文件,并通过一个配置文件对这些映射文件来进行装配,同时在该装配文件中进行控制属性的信息.<br>下面是一个简单的Mybatis配置文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">    &lt;typeAliases&gt;</span><br><span class="line">        &lt;typeAlias alias=&quot;Forum&quot; type=&quot;com.domain.Forum&quot;/&gt;</span><br><span class="line">        &lt;typeAlias alias=&quot;Topic&quot; type=&quot;com.domain.Topic&quot;/&gt;</span><br><span class="line">        &lt;typeAlias alias=&quot;Post&quot; type=&quot;com.domain.Post&quot;/&gt;</span><br><span class="line">    &lt;/typeAliases&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p><p>上述定义了Mybatis框架运行行为的属性信息,typeAlias为全限定类的别名,在映射文件中可以通过别名代替具体的类名,简化配置.<br>映射文件如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.MybatisDao.ForumMybatisDao&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;get&quot; resultType=&quot;Forum&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        SELECT</span><br><span class="line">        forum_id forumId,</span><br><span class="line">        forum_name forumName,</span><br><span class="line">        forum_desc forumDesc</span><br><span class="line">        FROM t_forum</span><br><span class="line">        WHERE forum_id = #&#123;forumId&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;select id=&quot;getNum&quot; resultType=&quot;int&quot;&gt;</span><br><span class="line">        SELECT COUNT(forum_id) FROM t_forum f</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;select id=&quot;findForumByName&quot; resultType=&quot;Forum&quot; parameterType=&quot;string&quot;&gt;</span><br><span class="line">        SELECT</span><br><span class="line">        forum_id forumId,</span><br><span class="line">        forum_name forumName,</span><br><span class="line">        forum_desc forumDesc</span><br><span class="line">        FROM t_forum f</span><br><span class="line">        WHERE f.forum_name LIKE #&#123;forumName&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;insert id=&quot;save&quot; parameterType=&quot;Forum&quot;&gt;</span><br><span class="line">        INSERT INTO t_forum(forum_id,forum_name,forum_desc)</span><br><span class="line">        VALUES(#&#123;forumId&#125;,#&#123;forumName&#125;, #&#123;forumDesc&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">    &lt;update id=&quot;update&quot; parameterType=&quot;Forum&quot;&gt;</span><br><span class="line">        UPDATE t_forum f</span><br><span class="line">        SET forum_name=#&#123;forumName&#125;,forum_desc=#&#123;forumDesc&#125;</span><br><span class="line">        WHERE f.forum_id = #&#123;forumId&#125;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line">    &lt;delete id=&quot;delete&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        DELETE FROM t_forum</span><br><span class="line">        WHERE forum_id=#&#123;forumIf&#125;</span><br><span class="line">    &lt;/delete&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure></p><p>该映射文件定义了对Forum实体类进行数据库操作是所需要的SQL语句,同时还定义了查询结果和对象属性的映射关系.namespace指定了映射所在的命名空间,每个具体的映射项都有一个id,可以通过命名空间和映射项的id定位到具体的映射项.映射项的parameterType指定传入参数对象,可以使全名限定类,也可以是类的别名,类的别名定义在Mybatis的配置文件中的typeAlias.如果映射项的参数是String等基本类型,可以使用int,long,string等基础类名.返回类型通过resultType指定,在映射项中通过#{xxx}绑定parameterType指定的参数类的属性,支持级联属性,如#{topic.forumId}.</p><h2 id="在Spring中配置Mybatis"><a href="#在Spring中配置Mybatis" class="headerlink" title="在Spring中配置Mybatis"></a>在Spring中配置Mybatis</h2><p>在其中可以使用mapperLocations指定配置文件.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;context:component-scan base-package=&quot;com.MybatisDao&quot;/&gt;</span><br><span class="line">&lt;context:component-scan base-package=&quot;com.MybatisService&quot;/&gt;</span><br><span class="line">&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span><br><span class="line">      destroy-method=&quot;close&quot;</span><br><span class="line">      p:driverClassName=&quot;$&#123;jdbc.driverClassName&#125;&quot;</span><br><span class="line">      p:url=&quot;$&#123;jdbc.url&#125;&quot;</span><br><span class="line">      p:username=&quot;$&#123;jdbc.username&#125;&quot;</span><br><span class="line">      p:password=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><br><span class="line">      p:dataSource-ref=&quot;dataSource&quot;</span><br><span class="line">      p:configLocation=&quot;classpath:com/Mybatis/Mybatis.xml&quot;</span><br><span class="line">      p:mapperLocations=&quot;classpath:com/mybatis/*.xml&quot;/&gt;</span><br></pre></td></tr></table></figure></p><h2 id="使用映射接口编写Mybatis的Dao"><a href="#使用映射接口编写Mybatis的Dao" class="headerlink" title="使用映射接口编写Mybatis的Dao"></a>使用映射接口编写Mybatis的Dao</h2><p>下面是Forum,xml文件的映射项定义一个调用接口:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package com.MybatisDao;</span><br><span class="line"></span><br><span class="line">import com.domain.Forum;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface ForumMybatisDao&lt;Forum&gt; extends BaseDao&lt;Forum&gt; &#123;</span><br><span class="line"></span><br><span class="line">     List&lt;Forum&gt; findForumByName(String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>该接口继承至BaseDao:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.MybatisDao;</span><br><span class="line"></span><br><span class="line">import com.domain.Forum;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface BaseDao&lt;T&gt; &#123;</span><br><span class="line">    void save(T entity);</span><br><span class="line">    void update(T entity);</span><br><span class="line">    Forum get(int id);</span><br><span class="line">    void delete(int id);</span><br><span class="line">    int getNum();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Mybatis-spring有一个神奇的转换器:MapperScannerConfigurer,可以将映射接口直接转换为Spring容器中的Bean,这样就可以在Service中注入接口映射的Bean:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span><br><span class="line">          p:sqlSessionFactory-ref=&quot;sqlSessionFactory&quot;</span><br><span class="line">          p:basePackage=&quot;com.MybatisDao&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>MapperScannerConfigurer将扫描basepackage所指定包下的所有接口类(包括子包),如果他们在SQL映射文件中定义过,则动态的为他们生成一个bean,就可以直接在Service中注入接口映射的Bean,如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package com.MybatisService;</span><br><span class="line"></span><br><span class="line">import com.HibrenateDao.PostHibernateDao;</span><br><span class="line">import com.MybatisDao.ForumMybatisDao;</span><br><span class="line">import com.domain.Forum;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Service(&quot;forumMybatisService&quot;)</span><br><span class="line">public class ForumMybatisService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ForumMybatisDao forumMybatisDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void addForum(Forum forum)&#123;</span><br><span class="line">        forumMybatisDao.save(forum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void updateForum(Forum forum)&#123;</span><br><span class="line">        forumMybatisDao.update(forum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Forum getForum(int id)&#123;</span><br><span class="line">        return forumMybatisDao.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getForumNum()&#123;</span><br><span class="line">        return forumMybatisDao.getNum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Forum&gt; findForumByName(String name)&#123;</span><br><span class="line">        return forumMybatisDao.findForumByName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void deleteForum(int id)&#123;</span><br><span class="line">        forumMybatisDao.delete(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>下面是测试代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package com;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.MybatisService.ForumMybatisService;</span><br><span class="line">import com.domain.Forum;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.test.annotation.Rollback;</span><br><span class="line">import org.springframework.test.context.ContextConfiguration;</span><br><span class="line">import org.springframework.test.context.testng.AbstractTransactionalTestNGSpringContextTests;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import org.testng.Assert;</span><br><span class="line">import org.testng.annotations.Test;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@ContextConfiguration(locations = &#123;&quot;classpath:com/Mybatis/applicationContext-mbatis.xml&quot;&#125;)</span><br><span class="line">@Rollback</span><br><span class="line">@Transactional</span><br><span class="line">public class MybatisTest extends AbstractTransactionalTestNGSpringContextTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ForumMybatisService forumMybatisService;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testForumMethod() &#123;</span><br><span class="line">        Forum forum = new Forum();</span><br><span class="line">        forum.setForumId(99);</span><br><span class="line">        forum.setForumName(&quot;name_99&quot;);</span><br><span class="line">        forum.setForumDesc(&quot;desc&quot;);</span><br><span class="line">        forumMybatisService.addForum(forum);</span><br><span class="line"></span><br><span class="line">        Forum forum1 = forumMybatisService.getForum(99);</span><br><span class="line">        Assert.assertEquals(&quot;name_99&quot;, forum1.getForumName());</span><br><span class="line">        forum1.setForumName(&quot;forum99&quot;);</span><br><span class="line">        forumMybatisService.updateForum(forum1);</span><br><span class="line"></span><br><span class="line">        forumMybatisService.deleteForum(123);</span><br><span class="line"></span><br><span class="line">        int count=forumMybatisService.getForumNum();</span><br><span class="line"></span><br><span class="line">        List&lt;Forum&gt; forums=new ArrayList&lt;Forum&gt;();</span><br><span class="line">        forums=forumMybatisService.findForumByName(&quot;watermelon&quot;);</span><br><span class="line">        System.out.println(forums);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;非常简单学习了一下Hibernate与Mybatis,两者给我的感受是Hibernate对于初学者上手很快,不需要自己写Sql语句,相比于Mybatis对于每一个实体类需要一个映射文件来说,它的使用十分快捷方便.但是在使用过程中出现的问题也更多,Hql语句定义问题啊,使用泛型BaseDao问题什么,自己对于Hibernate也完全不了解,出了Bug需要查阅许多博客.而使用Mybatis可以不用自己写Dao实现类,可以使用Mybatis的提供的MapperScannerConfigurer直接将映射接口转换为Spring容器的Bean.&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Spring" scheme="https://watermelon-lee.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring-JDBC</title>
    <link href="https://watermelon-lee.github.io/2018/04/17/Spring-JDBC/"/>
    <id>https://watermelon-lee.github.io/2018/04/17/Spring-JDBC/</id>
    <published>2018-04-17T14:09:29.000Z</published>
    <updated>2018-04-22T03:18:27.720Z</updated>
    
    <content type="html"><![CDATA[<p>Spring JDBC是Spring所提供的持久层技术.在Spring JDBC里面只需要做那些与业务相关的事情DML操作,而将资源获取,statement创建,资源释放,异常处理的等繁杂的工作交给Spring JDBC.<br><a id="more"></a></p><h1 id="使用Spring-JDBC访问数据库"><a href="#使用Spring-JDBC访问数据库" class="headerlink" title="使用Spring JDBC访问数据库"></a>使用Spring JDBC访问数据库</h1><h2 id="JdbcTemplate尝试"><a href="#JdbcTemplate尝试" class="headerlink" title="JdbcTemplate尝试"></a>JdbcTemplate尝试</h2><p>在使用JSP/servlet时,使用JDBC连接数据库需要自己手动获取JDBC连接,处理异常,关闭连接等.而使用Spring JDBC通过模板与回调机制降低了使用JDBC的复杂性,借助JdbcTemplate,只需要一些”必不可少”的步骤就可以操作数据库.<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DriverManagerDataSource ds=new DriverManagerDataSource();</span><br><span class="line">        ds.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">        ds.setUrl(&quot;jdbc:mysql://localhost:3306/sampledb&quot;);</span><br><span class="line">        ds.setUsername(&quot;root&quot;);</span><br><span class="line">        ds.setPassword(&quot;19970901&quot;);</span><br><span class="line">        </span><br><span class="line">        JdbcTemplate jdbcTemplate=new JdbcTemplate();</span><br><span class="line">        jdbcTemplate.setDataSource(ds);</span><br><span class="line">        </span><br><span class="line">        String sql=&quot;create table user(user_id int primary key,user_name varchar(60))&quot;;</span><br><span class="line">        jdbcTemplate.execute(sql);</span><br></pre></td></tr></table></figure></p><h2 id="在dao中使用JdbcTemplate"><a href="#在dao中使用JdbcTemplate" class="headerlink" title="在dao中使用JdbcTemplate"></a>在dao中使用JdbcTemplate</h2><p>在Dao类中可以直接使用JdbcTemplate,在XML文件中配置好后,直接在DAO中注入即可.<br>DAO类代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class ForumDao &#123;</span><br><span class="line">    private JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    @Autowired//自动注入JdbcTemplate实例</span><br><span class="line">    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</span><br><span class="line">        this.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //创建表格</span><br><span class="line">    public void initDb() &#123;</span><br><span class="line">        //在实际项目中,sql如果不是动态组装,需要将其定义为类级final常量</span><br><span class="line">        String sql = &quot;create table t_user(user_id int primary key,user_name varchar(60))&quot;;</span><br><span class="line">        jdbcTemplate.execute(sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>XML配置文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--扫描包以注册申明的bean--&gt;</span><br><span class="line">  &lt;context:component-scan base-package=&quot;com.dao&quot;/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 配置数据源--&gt;</span><br><span class="line">  &lt;context:property-placeholder location=&quot;jdbc.properties&quot;/&gt;</span><br><span class="line">  &lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span><br><span class="line">        destroy-method=&quot;close&quot;</span><br><span class="line">        p:driverClassName=&quot;$&#123;jdbc.driverClassName&#125;&quot;</span><br><span class="line">        p:url=&quot;$&#123;jdbc.url&#125;&quot;</span><br><span class="line">        p:username=&quot;$&#123;jdbc.username&#125;&quot;</span><br><span class="line">        p:password=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">  &lt;!--声明Jdbcemplate Bean--&gt;</span><br><span class="line">  &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; p:dataSource-ref=&quot;dataSource&quot;/&gt;</span><br></pre></td></tr></table></figure></p><p>在Spring配置文件中,配置DAO一般有4个步骤:</p><ol><li>定义DataSource  </li><li>定义JdbcTemplate  </li><li>声明一个抽象的Bean,以便所有的Dao复用配置JdbcTamplate配置的属性  </li><li>配置具体的Dao</li></ol><h2 id="基本数据库操作"><a href="#基本数据库操作" class="headerlink" title="基本数据库操作"></a>基本数据库操作</h2><h3 id="更改数据"><a href="#更改数据" class="headerlink" title="更改数据"></a>更改数据</h3><p>JdbcTemplate提供了若干个Update()方法,来对数据表进行更改和删除<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//更改数据</span><br><span class="line">    public  void addForum(Forum forum) &#123;</span><br><span class="line">        String sql = &quot;insert into t_forum(forum_name,forum_desc) values(?,?)&quot;;</span><br><span class="line">        Object[] params = &#123;forum.getForumName(), forum.getForumDesc()&#125;;</span><br><span class="line">        //jdbcTemplate.update(sql,params);</span><br><span class="line">        jdbcTemplate.update(sql, params, new int[]&#123;Types.VARCHAR, Types.VARCHAR&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>JdbcTemplate在内部使用PreparedStatement执行SQL语句,可以使用绑定参数的SQL语句,使用占位符?.用Object[]args数组来定义填充占位符的参数,使用JdbcTemplate的int update(String sql,Object[] args,int[] argsTypes),int[] argsTypes数组来显式制定每个占位符对应的数据类型,以保证类型的安全.</p><h3 id="返回数据库表自增的主键"><a href="#返回数据库表自增的主键" class="headerlink" title="返回数据库表自增的主键"></a>返回数据库表自增的主键</h3><p>在开发时,我们有时候使用数据库自增字段为表的主键,主键不在应用层产生,而是在新增数据记录时产生.这样在应用层保存对象前我们不知道对象的主键值,在JDBC中,允许将数据库主键值绑定到Statement或者PrepareStatement上,利用这个技术,Spring提供了一个可以返回新增记录主键值的方法:<code>int update(PrepareStatementCreator osc,KeyHolder generatedKeyHolder)</code>.<br>代码如下:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">       在t_forum中使用了自增主键,则主键值不会再应用层,需要我们自己获取.</span><br><span class="line">       Spring jdbc3.0添加可回去住建的KeyHolder接口,通用实现类为GeneratedKeyHolder</span><br><span class="line">        */</span><br><span class="line">   public void addForumAndGetMainValue(final Forum forum)&#123;</span><br><span class="line"></span><br><span class="line">   KeyHolder keyHolder = new GeneratedKeyHolder();//创建一个主键持有者</span><br><span class="line">       final String  sql = &quot;insert into t_forum(forum_name,forum_desc) values(?,?)&quot;;</span><br><span class="line">       jdbcTemplate.update(new PreparedStatementCreator() &#123;</span><br><span class="line">       public PreparedStatement createPreparedStatement (Connection connection) throws SQLException &#123;</span><br><span class="line">           PreparedStatement preparedStatement=connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">           preparedStatement.setString(1,forum.getForumName());</span><br><span class="line">           preparedStatement.setString(2,forum.getForumDesc());</span><br><span class="line">           return  preparedStatement;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,keyHolder);</span><br><span class="line">       forum.setForumId(keyHolder.getKey().intValue());//从主键持有者中获取主键</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>这样在调用addForum后新增forum领域对象后,forum将拥有对应的主键,方便以后使用.</p><h3 id="批量更改数据"><a href="#批量更改数据" class="headerlink" title="批量更改数据"></a>批量更改数据</h3><p>JdbcTemplate有两个批量操作数据的方法:  </p><ul><li>public int[] batchUpdate(String[] sql):多条sql语句组成一个数组,这些sql语句不带参数,该方法以批量方式执行这些操作.</li><li>int[] batchUpdate(String sql,BatchPrepareStatementSetter pss):该方法对于同一结构带参SQL语句多次进行数据更新.通过BatchPrepareStatementSetter回调接口进行批量绑定参数.BatchPrepareStatementSetter定义了两个方法:<ol><li>int getBatchSize():指定本批次的大小</li><li>void setValues(PrepareStatement ps,int i):为给定的PrepareStatement指定参数.</li></ol></li></ul><p>加入论坛一次性新增多个板块,可如下编写:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 批量更改</span><br><span class="line">  public void addForums(final List&lt;Forum&gt; forums)&#123;</span><br><span class="line">      final String sql=&quot;insert into t_forum(forum_name,forum_desc) values(?,?)&quot;;</span><br><span class="line"></span><br><span class="line">      jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() &#123;</span><br><span class="line">          public void setValues(PreparedStatement preparedStatement, int i) throws SQLException &#123;</span><br><span class="line">              Forum forum=forums.get(i);</span><br><span class="line">              preparedStatement.setString(1,forum.getForumName());</span><br><span class="line">              preparedStatement.setString(2,forum.getForumDesc());</span><br><span class="line">          &#125;</span><br><span class="line">          //指定该批记录的记录数</span><br><span class="line">          public int getBatchSize() &#123;</span><br><span class="line">              return forums.size();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      addForum(forums.get(10));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><h4 id="使用RowCallbackHandler"><a href="#使用RowCallbackHandler" class="headerlink" title="使用RowCallbackHandler"></a>使用RowCallbackHandler</h4><p>RowCallbackHandler接口与很简单,只有一个方法:`void processRow(ResultSet rs) throws SQLException.<br>ForumDao需要提供一个根据forumId来获取Forum对象的方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> // 单次查询数据</span><br><span class="line">    public Forum getForum(final int id)&#123;</span><br><span class="line">        final String sql=&quot;select forum_name,forum_desc from t_forum where forum_id=?&quot;;</span><br><span class="line">        final Forum forum=new Forum();</span><br><span class="line">        jdbcTemplate.query(sql, new Object[]&#123;id&#125;, new RowCallbackHandler() &#123;</span><br><span class="line">            public void processRow(ResultSet resultSet) throws SQLException &#123;</span><br><span class="line">                forum.setForumId(id);</span><br><span class="line">                forum.setForumName(resultSet.getString(&quot;forum_name&quot;));</span><br><span class="line">                forum.setForumDesc(resultSet.getString(&quot;forum_desc&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return forum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">//批量查询</span><br><span class="line">    public List&lt;Forum&gt; getForums(final int id,final int toId)&#123;</span><br><span class="line">        String sql=&quot;select forum_name,forum_desc form t_forum where forum_id between ? and ?&quot;;</span><br><span class="line">        final List&lt;Forum&gt; forums=new ArrayList&lt;Forum&gt;();</span><br><span class="line"></span><br><span class="line">        jdbcTemplate.query(sql, new Object[]&#123;id, toId&#125;, new RowCallbackHandler() &#123;</span><br><span class="line">            public void processRow(ResultSet resultSet) throws SQLException &#123;</span><br><span class="line">                Forum forum=new Forum();</span><br><span class="line">                forum.setForumId(resultSet.getInt(&quot;forum_id&quot;));</span><br><span class="line">                forum.setForumName(resultSet.getString(&quot;forum_name&quot;));</span><br><span class="line">                forum.setForumDesc(resultSet.getString(&quot;forum_desc&quot;));</span><br><span class="line">                forums.add(forum);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return forums;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h4 id="使用RowMapper"><a href="#使用RowMapper" class="headerlink" title="使用RowMapper"></a>使用RowMapper<t></t></h4><p>RowMapper<t>接口只有一个方法:T mapRow(ResultSet rs,int rowNum).JJdbcTemplate提供了许多个使用RowMapper<t>的查询方法,这些方法返回List.下面使用JdbcTemplate的List query(String sql,Object[] args,RowMapper<t> rowMapper)方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public List&lt;Forum&gt; getForums(final int fromId, final int toId) &#123;</span><br><span class="line">String sql = &quot;SELECT forum_id,forum_name,forum_desc FROM t_forum WHERE forum_id between ? and ?&quot;;</span><br><span class="line">// 方法1：使用RowCallbackHandler接口</span><br><span class="line">/*</span><br><span class="line"> * final List&lt;Forum&gt; forums = new ArrayList&lt;Forum&gt;();</span><br><span class="line"> * jdbcTemplate.query(sql,new Object[]&#123;fromId,toId&#125;,new</span><br><span class="line"> * RowCallbackHandler()&#123; public void processRow(ResultSet rs) throws</span><br><span class="line"> * SQLException &#123; Forum forum = new Forum();</span><br><span class="line"> * forum.setForumId(rs.getInt(&quot;forum_id&quot;));</span><br><span class="line"> * forum.setForumName(rs.getString(&quot;forum_name&quot;));</span><br><span class="line"> * forum.setForumDesc(rs.getString(&quot;forum_desc&quot;)); forums.add(forum);</span><br><span class="line"> * &#125;&#125;); return forums;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">return jdbcTemplate.query(sql, new Object[] &#123; fromId, toId &#125;,</span><br><span class="line">new RowMapper&lt;Forum&gt;() &#123;</span><br><span class="line">public Forum mapRow(ResultSet rs, int index)</span><br><span class="line">throws SQLException &#123;</span><br><span class="line">Forum forum = new Forum();</span><br><span class="line">forum.setForumId(rs.getInt(&quot;forum_id&quot;));</span><br><span class="line">forum.setForumName(rs.getString(&quot;forum_name&quot;));</span><br><span class="line">forum.setForumDesc(rs.getString(&quot;forum_desc&quot;));</span><br><span class="line">return forum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></t></t></t></p><p>可以看到使用RowCallbackHandler的void processRow(ResultSet rs)方法,需要自己将行数据映射到对象Forum手动添加的外部定义forums列表中,而RowMapper<t>的 T mapROw(ResultSet rs,int index)方法中,只需要简单的定义结果集和对象的映射关系,创建List,映射对象添加到List都有JdbcTemplate完成.</t></p><h4 id="RowCallbackHandler与RowMapper区别"><a href="#RowCallbackHandler与RowMapper区别" class="headerlink" title="RowCallbackHandler与RowMapper区别"></a>RowCallbackHandler与RowMapper区别</h4><p>可以看到使用RowCallbackHandler的void processRow(ResultSet rs)方法,需要自己将行数据映射到对象Forum手动添加的外部定义forums列表中,而RowMapper<t>的 T mapROw(ResultSet rs,int index)方法中,只需要简单的定义结果集和对象的映射关系,创建List,映射对象添加到List都有JdbcTemplate完成.<br>当处理大结果数据集时,使用RowMapper,采用的方式是将所有的数据集放到一个List<t>对象中,这样将占用JVM大量内存,而使用RowCallbackHandler()的 public void processRow(ResultSet resultSet)将会一边获取数据,一边完成处理,这样数据不会大量堆积在JVM中,造成大量内存占用.  </t></t></p><h3 id="调用存储过程"><a href="#调用存储过程" class="headerlink" title="调用存储过程"></a>调用存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@Repository(value = &quot;topic&quot;)</span><br><span class="line">public class TopicDao &#123;</span><br><span class="line">    private JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</span><br><span class="line">        this.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    //调用存储过程</span><br><span class="line">    /*存储过程如下:</span><br><span class="line">    CREATE PROCEDURE P_GET_TOPIC_NUM(IN in_user_id INT,OUT out_num INT)</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT COUNT(*) INTO out_num  FROM t_topic WHERE user_id = in_user_id;</span><br><span class="line">END</span><br><span class="line">     */</span><br><span class="line">    public int getUserTopicNum(final int userId)&#123;</span><br><span class="line">        String sql=&quot;&#123;call P_GET_TOPIC_NUM(?,?)&#125;&quot;;</span><br><span class="line">        Integer num=jdbcTemplate.execute(sql, new CallableStatementCallback&lt;Integer&gt;() &#123;</span><br><span class="line">            public Integer doInCallableStatement(CallableStatement callableStatement) throws SQLException, DataAccessException &#123;</span><br><span class="line">                callableStatement.setInt(1,userId);//绑定入参</span><br><span class="line">                callableStatement.registerOutParameter(2, Types.INTEGER);//注册输出参数</span><br><span class="line">                callableStatement.execute();//执行</span><br><span class="line">                return callableStatement.getInt(2);//获取输出参数值</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BLOB-CLOB类型数据操作"><a href="#BLOB-CLOB类型数据操作" class="headerlink" title="BLOB/ CLOB类型数据操作"></a>BLOB/ CLOB类型数据操作</h2><p>前面使用了JdbcTemplate的CRUD(create retrieve Update delete),现在了解如何对BLOB/ CLOB类型进行数据操作<br>LOB代表大对象数据,包括BLOB和CLOB.前者用于存储大块的二进制数据,如图片,视频(一般不宜存到数据库中,存至文件服务器中),后者存储长文本数据,如论坛帖子,产品详细描述.</p><h3 id="LobCreator"><a href="#LobCreator" class="headerlink" title="LobCreator"></a>LobCreator</h3><p>为了方便在 PreparedStatement 中使用 LobCreator，可以直接使用 JdbcTemplate#execute(String sql,AbstractLobCreatingPreparedStatementCallback lcpsc) 方法。下面对 LobCreator 接口中的方法进行简要说明：</p><ul><li>void close():关闭会话，并释放 LOB 资源</li><li>void setBlobAsBinaryStream(PreparedStatement ps, int paramIndex, InputStream contentStream, int contentLength) :通过流填充 BLOB 数据</li><li>void setBlobAsBytes(PreparedStatement ps, int paramIndex, byte[] content): 通过二进制数据填充 BLOB 数据</li><li>void setClobAsAsciiStream(PreparedStatement ps, int paramIndex, InputStream asciiStream, int contentLength): 通过 Ascii 字符流填充 CLOB 数据</li><li>void setClobAsCharacterStream(PreparedStatement ps, int paramIndex, Reader characterStream, int contentLength) :通过 Unicode 字符流填充 CLOB 数据</li><li>void setClobAsString(PreparedStatement ps, int paramIndex, String content):</li></ul><h3 id="LobHandler"><a href="#LobHandler" class="headerlink" title="LobHandler"></a>LobHandler</h3><p>LobHandler 接口为操作 BLOB/CLOB 提供了统一访问接口，而不管底层数据库究竟是以大对象的方式还是以一般数据类型的方式进行操作。此外，LobHandler 还充当了 LobCreator 的工厂类。实现类使用DefualtLobHandler.看一下 LobHandler 接口的几个重要方法：  </p><ul><li>InputStream getBlobAsBinaryStream(ResultSet rs, int columnIndex)    从结果集中返回 InputStream，通过 InputStream 读取 BLOB 数据</li><li>byte[] getBlobAsBytes(ResultSet rs, int columnIndex)    以二进制数据的方式获取结果集中的 BLOB 数据；</li><li>InputStream getClobAsAsciiStream(ResultSet rs, int columnIndex)    从结果集中返回 InputStream，通过 <em> </em> InputStreamn 以 Ascii 字符流方式读取 BLOB 数据</li><li>Reader getClobAsCharacterStream(ResultSet rs, int columnIndex)    从结果集中获取 Unicode 字符流 Reader，并通过 Reader以Unicode 字符流方式读取 CLOB 数据</li><li>String getClobAsString(ResultSet rs, int columnIndex)    从结果集中以字符串的方式获取 CLOB 数据</li><li>LobCreator getLobCreator()    生成一个会话相关的 LobCreator 对象</li></ul><h3 id="插入LOB类型数据"><a href="#插入LOB类型数据" class="headerlink" title="插入LOB类型数据"></a>插入LOB类型数据</h3><p>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void addPost(final Post post)&#123;</span><br><span class="line">      String sql=&quot;insert into t_post(post_id,user_id,post_text,post_attach) values(?,?,?,?)&quot;;</span><br><span class="line">      jdbcTemplate.execute(sql, new AbstractLobCreatingPreparedStatementCallback(this.lobHandler) &#123;</span><br><span class="line">          @Override</span><br><span class="line">          protected void setValues(PreparedStatement preparedStatement, LobCreator lobCreator) throws SQLException, DataAccessException &#123;</span><br><span class="line">             // preparedStatement.setInt(1,1);</span><br><span class="line">              preparedStatement.setInt(1,incrementer.nextIntValue());//获取下一个主键值</span><br><span class="line">              preparedStatement.setInt(2,post.getUserId());</span><br><span class="line"></span><br><span class="line">              //设置CLOB字段</span><br><span class="line">              lobCreator.setClobAsString(preparedStatement,3,post.getPostText());</span><br><span class="line"></span><br><span class="line">              //设置BLOB字段</span><br><span class="line">              lobCreator.setBlobAsBytes(preparedStatement,4,post.getPostAttach());</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>在PostDao中引入一个LobHandler属性,通过<code>jdbcTemplate.execute(sql,  AbstractLobCreatingPreparedStatementCallback lcpsc)</code>方法插入LOB数据,然后通过匿名内部类方式定义LobCreatingPreparedStatementCallback的抽象子类,其构造函数需要一个LobHandler的入参,最后在匿名内部类中实现父类抽象方法setValues(PrepareStatement ps,LobCreator lobCreator),在该方法中通过lOBCreator操作LOB对象,分别通过字符串,二进制数组填充BLOB和CLOB.<br>使用MySQL数据库,我们可以在配置文件中如下配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;lobHandler&quot; class=&quot;org.springframework.jdbc.support.lob.DefaultLobHandler&quot; lazy-init=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure></p><h3 id="以块数据方式读取LOB数据"><a href="#以块数据方式读取LOB数据" class="headerlink" title="以块数据方式读取LOB数据"></a>以块数据方式读取LOB数据</h3><p>可以直接以数据块方式读取LOB数据:以String读取CLOB数据,以byte[]读取BLOB数据.<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public List getAttachs(final int userId)&#123;</span><br><span class="line">        String sql=&quot;select post_id,post_attachs from t_user where user_id=? and post_attach is not null&quot;;</span><br><span class="line">        return jdbcTemplate.query(sql, new Object[]&#123;userId&#125;, new RowMapper() &#123;</span><br><span class="line">            public Object mapRow(ResultSet resultSet, int i) throws SQLException &#123;</span><br><span class="line">                int postId=resultSet.getInt(1);</span><br><span class="line">                 // 以二进制的方式获取BLOB数据</span><br><span class="line">                byte[] attach=lobHandler.getBlobAsBytes(resultSet,2);</span><br><span class="line">                Post post=new Post();</span><br><span class="line">                post.setPostId(postId);</span><br><span class="line">                post.setPostAttach(attach);</span><br><span class="line">                return post;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>通过JdbcTemplate的List<t>query(String sql,Object[] args,RowMapper rowMapper)接口处理行数据的映射.在ROwMapper回调的mapRow()接口方法中,通过LOBHandler以byte[]获取BLOB数据.</t></p><h2 id="自增键"><a href="#自增键" class="headerlink" title="自增键"></a>自增键</h2><p>数据库都会提供自增键,如MySQL的auto_increment,Spring允许在应用层产生主键,需要使用DataFieldMaxValueIncrementer接口<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private DataFieldMaxValueIncrementer incrementer;//主键值产生器</span><br><span class="line"></span><br><span class="line">   @Autowired</span><br><span class="line">   public void setIncrementer(DataFieldMaxValueIncrementer incrementer)&#123;</span><br><span class="line">       this.incrementer=incrementer;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public void addPost(final Post post)&#123;</span><br><span class="line">       String sql=&quot;insert into t_post(post_id,user_id,post_text,post_attach) values(?,?,?,?)&quot;;</span><br><span class="line">       jdbcTemplate.execute(sql, new AbstractLobCreatingPreparedStatementCallback(this.lobHandler) &#123;</span><br><span class="line">           @Override</span><br><span class="line">           protected void setValues(PreparedStatement preparedStatement, LobCreator lobCreator) throws SQLException, DataAccessException &#123;</span><br><span class="line">              // preparedStatement.setInt(1,1);</span><br><span class="line">               preparedStatement.setInt(1,incrementer.nextIntValue());//获取下一个主键值</span><br><span class="line">               preparedStatement.setInt(2,post.getUserId());</span><br><span class="line"></span><br><span class="line">               //设置CLOB字段</span><br><span class="line">               lobCreator.setClobAsString(preparedStatement,3,post.getPostText());</span><br><span class="line"></span><br><span class="line">               //设置BLOB字段</span><br><span class="line">               lobCreator.setBlobAsBytes(preparedStatement,4,post.getPostAttach());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>在MySql中创建一张用于维护他_post主键的他_post_id表:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">   sequence_id  int</span><br><span class="line">)</span><br><span class="line"> ENGINE = MYISAM;</span><br><span class="line"> insert into t_post_id values(0);</span><br></pre></td></tr></table></figure></p><p>主键维护表的并发访问量很大,最好将其声明为<a href="https://blog.csdn.net/hu2010shuai/article/details/54907363" target="_blank" rel="noopener">MYISAM</a>类型,此外,需要为该表提供初始值,一边后续主建值在上面递增.<br>在Spirng配置文件中需要如下配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;increment&quot; class=&quot;org.springframework.jdbc.support.incrementer.MySQLMaxValueIncrementer&quot;</span><br><span class="line">          p:incrementerName=&quot;t_post_id&quot;</span><br><span class="line">          p:columnName=&quot;sequence_id&quot;</span><br><span class="line">          p:cacheSize=&quot;1&quot;</span><br><span class="line">          p:dataSource-ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">    &lt;!-- 属性依次为 维护主键的表名,用于生成主键值的列名,缓存大小--&gt;</span><br></pre></td></tr></table></figure></p><p>CacheSize决定一次返回的主键数,这里设置为10,第一次获取主键后,他_post_id中的Sequence_id递增10,然后后面9次都在在缓存中获取,之后在返回他_post_id获取.  </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Spring JDBC是Spring所提供的持久层技术.在Spring JDBC里面只需要做那些与业务相关的事情DML操作,而将资源获取,statement创建,资源释放,异常处理的等繁杂的工作交给Spring JDBC.&lt;br&gt;
    
    </summary>
    
      <category term="study" scheme="https://watermelon-lee.github.io/categories/study/"/>
    
    
      <category term="Spring" scheme="https://watermelon-lee.github.io/tags/Spring/"/>
    
  </entry>
  
</feed>
